# 材价文件采集规范 (Material Price Spec)

> 版本：V1.0  
> 更新日期：2026-01-18  
> 所属模块：03_Data_Collection

---

## 1. 概述

### 1.1 功能定位

材价文件采集负责收集和管理材料价格数据，支持：
- 上传各类材价文件（供应商报价、网站询价、合同价、财评价等）
- 标准化处理（材料名称 → SMLCode + ParamMap）
- 推送到"我的材价"，与造价文件解析出的材价**汇聚合并**

### 1.2 数据来源

| 来源类型 | 说明 | 典型场景 |
|----------|------|----------|
| 供应商报价 | 供应商提供的材料报价单 | 招标采购、询价比选 |
| 网站询价 | 造价信息网、材料网等平台价格 | 市场价格调研 |
| 合同价 | 已签订合同中的材料价格 | 合同履约、结算参考 |
| 财评价 | 财政评审认定的材料价格 | 政府项目、审计参考 |

### 1.3 支持的文件格式

| 格式 | 说明 |
|------|------|
| .xlsx | Excel 材价表 |
| .xls | Excel 97-2003 材价表 |
| .csv | CSV 格式材价数据 |
| .pdf | PDF 格式报价单（需OCR解析） |

---

## 2. 页面结构

### 2.1 材价文件列表页（主页面）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  数据采集 > 材价文件                                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 操作栏 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  [+ 上传文件]     [批量删除]                    🔍 搜索文件名        │   │
│  │                                                                      │   │
│  │  筛选：材价来源 [全部 ▼]  地点 [全部 ▼]  材价时间 [全部 ▼]          │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 文件列表 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  □  文件名            上传时间      材价时间    地点    材价来源  操作│   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │  □  2026年1月钢材报价  2026-01-18   2026-01    北京   供应商报价 ··· │   │
│  │  □  混凝土询价单       2026-01-17   2026-01    上海   网站询价   ··· │   │
│  │  □  XX项目合同材料价   2026-01-16   2025-12    广州   合同价     ··· │   │
│  │  □  财评材料价格表     2026-01-15   2025-11    深圳   财评价     ··· │   │
│  │  □  装饰材料报价汇总   2026-01-14   2026-01    杭州   供应商报价 ··· │   │
│  │                                                                      │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │                                          共 86 条   < 1 2 3 ... 9 >  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 列表字段定义

| 字段 | 说明 | 宽度 | 排序 |
|------|------|------|------|
| 复选框 | 批量操作选择 | 40px | - |
| 文件名 | 材价文件名称 | 自适应 | 支持 |
| 上传时间 | 文件上传时间 | 120px | 支持（默认降序） |
| 材价时间 | 材料价格的时间基准（年月） | 100px | 支持 |
| 地点 | 材价适用地区（省/市） | 100px | 支持 |
| 材价来源 | 供应商报价/网站询价/合同价/财评价 | 100px | 支持 |
| 操作 | 操作按钮组 | 160px | - |

### 2.3 操作按钮

| 按钮 | 图标 | 说明 | 触发弹窗 |
|------|------|------|----------|
| 查看 | 👁 | 预览材价文件内容 | 查看弹窗（只读） |
| 补录 | ✏️ | 补充元数据信息 | 补录弹窗 |
| 推送 | 📤 | 推送到我的材价 | 推送确认弹窗 |
| 删除 | 🗑 | 删除文件 | 删除确认弹窗 |

**按钮状态规则：**

| 文件状态 | 查看 | 补录 | 推送 | 删除 |
|----------|:----:|:----:|:----:|:----:|
| 待补录 | ✓ | ✓ | ✗ | ✓ |
| 已补录 | ✓ | ✓ | ✓ | ✓ |
| 已推送 | ✓ | ✗ | ✗ | ✓ |

---

## 3. 上传文件弹窗

### 3.1 上传文件弹窗界面

点击 **[+ 上传文件]** 按钮，打开上传弹窗：

```
┌─────────────────────────────────────────────────────────────────┐
│  上传材价文件                                            [×]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │           📁                                            │   │
│  │                                                         │   │
│  │     将文件拖到此处，或 [点击选择文件]                    │   │
│  │                                                         │   │
│  │     支持格式：.xlsx .xls .csv .pdf                      │   │
│  │     单个文件最大：50MB                                  │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 基本信息（必填）───────────────────────────────────────┐   │
│  │                                                         │   │
│  │  材价来源：○ 供应商报价  ○ 网站询价  ○ 合同价  ○ 财评价 │   │
│  │                                                         │   │
│  │  材价时间：[2026 ▼] 年 [01 ▼] 月                        │   │
│  │                                                         │   │
│  │  地点：[请选择省份 ▼] [请选择城市 ▼]                    │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 可选信息 ──────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  供应商/来源名称：[                                   ] │   │
│  │                                                         │   │
│  │  备注：[                                               ]│   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─ 已选文件 ──────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  📄 2026年1月钢材报价.xlsx          2.3 MB    [×]       │   │
│  │  📄 混凝土询价单.xlsx               1.1 MB    [×]       │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                    [取消]    [开始上传]         │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 上传流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 选择文件  │ →  │ 填写信息  │ →  │ 上传解析  │ →  │ 入库完成  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                                    │
                                    ▼
                              自动标准化
                           材料→SMLCode
                           属性→ParamMap
```

---

## 4. 查看弹窗

### 4.1 查看弹窗界面

点击 **[查看]** 按钮，打开预览弹窗：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  查看材价文件 - 2026年1月钢材报价                                    [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 文件信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  材价来源：供应商报价    材价时间：2026年01月    地点：北京市        │   │
│  │  供应商：XX钢铁有限公司  上传时间：2026-01-18    状态：已补录        │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 材料清单 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  🔍 搜索材料名称            分类筛选 [全部 ▼]   标准化状态 [全部 ▼] │   │
│  │                                                                      │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │序号│材料名称      │规格型号    │单位│单价    │SMLCode  │状态  │ │   │
│  │  │───│────────────│──────────│───│───────│────────│─────│ │   │
│  │  │ 1 │HRB400钢筋   │Φ12       │t  │4,250.00│SML00123│✓ 已匹配│ │   │
│  │  │ 2 │HRB400钢筋   │Φ16       │t  │4,180.00│SML00124│✓ 已匹配│ │   │
│  │  │ 3 │HRB400钢筋   │Φ20       │t  │4,150.00│SML00125│✓ 已匹配│ │   │
│  │  │ 4 │HRB400钢筋   │Φ25       │t  │4,120.00│SML00126│✓ 已匹配│ │   │
│  │  │ 5 │HPB300钢筋   │Φ8        │t  │4,380.00│SML00131│✓ 已匹配│ │   │
│  │  │ 6 │镀锌钢管     │DN100     │m  │  125.00│SML00256│✓ 已匹配│ │   │
│  │  │ 7 │特种钢材A    │非标      │t  │5,600.00│   -    │⚠ 待确认│ │   │
│  │  │...│    ...     │   ...    │...│  ...   │  ...   │ ...  │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                      │   │
│  │  共 156 条材料    已匹配：149 (96%)    待确认：7 (4%)                │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                         [关闭]              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 材料清单字段

| 字段 | 说明 |
|------|------|
| 序号 | 行号 |
| 材料名称 | 原始材料名称 |
| 规格型号 | 材料规格 |
| 单位 | 计量单位 |
| 单价 | 材料单价（元） |
| SMLCode | 标准材料编码（自动匹配） |
| 状态 | 已匹配/待确认 |

---

## 5. 补录弹窗

### 5.1 补录弹窗界面

点击 **[补录]** 按钮，打开补录弹窗：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  补录材价信息 - 2026年1月钢材报价                                    [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 基本信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  文件名称：2026年1月钢材报价.xlsx                    （不可修改）    │   │
│  │                                                                      │   │
│  │  材价来源：[供应商报价 ▼]                            *必填          │   │
│  │            ○ 供应商报价  ○ 网站询价  ○ 合同价  ○ 财评价            │   │
│  │                                                                      │   │
│  │  材价时间：[2026 ▼] 年 [01 ▼] 月                     *必填          │   │
│  │                                                                      │   │
│  │  地点：[北京市 ▼] [海淀区 ▼]                         *必填          │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 来源信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  供应商名称：[XX钢铁有限公司                       ]                 │   │
│  │                                                                      │   │
│  │  联系人：[张三          ]   联系电话：[138****1234     ]             │   │
│  │                                                                      │   │
│  │  报价有效期：[2026-01-01] 至 [2026-03-31]                            │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 待确认材料（7条）────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  以下材料未能自动匹配标准编码，请手工确认：                          │   │
│  │                                                                      │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │ 原始名称      │ 规格   │ 匹配标准材料              │ 操作     │ │   │
│  │  │──────────────│───────│─────────────────────────│─────────│ │   │
│  │  │ 特种钢材A     │ 非标   │ [请选择 ▼]               │ [跳过]  │ │   │
│  │  │ 异形钢板      │ 定制   │ [请选择 ▼]               │ [跳过]  │ │   │
│  │  │ ...          │ ...   │ ...                     │ ...     │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 备注 ──────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  [                                                                 ] │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                    [取消]    [保存]                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 补录字段说明

| 分组 | 字段 | 必填 | 说明 |
|------|------|:----:|------|
| 基本信息 | 文件名称 | - | 只读，来自上传 |
| 基本信息 | 材价来源 | 是 | 枚举选择 |
| 基本信息 | 材价时间 | 是 | 年/月选择 |
| 基本信息 | 地点 | 是 | 省/市二级联动 |
| 来源信息 | 供应商名称 | 否 | 文本输入 |
| 来源信息 | 联系人 | 否 | 文本输入 |
| 来源信息 | 联系电话 | 否 | 文本输入 |
| 来源信息 | 报价有效期 | 否 | 日期范围 |
| 待确认材料 | 标准材料匹配 | 否 | 下拉选择/跳过 |
| 备注 | 备注 | 否 | 多行文本 |

---

## 6. 推送弹窗

### 6.1 推送弹窗界面

点击 **[推送]** 按钮，打开推送确认弹窗：

```
┌─────────────────────────────────────────────────────────────────┐
│  推送到我的材价 - 2026年1月钢材报价                       [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─ 推送内容预览 ──────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  将推送以下数据到"我的材价"：                           │   │
│  │                                                         │   │
│  │  ┌───────────────────────────────────────────────────┐ │   │
│  │  │                                                   │ │   │
│  │  │  📦 材料价格数据：156 条                          │ │   │
│  │  │     ├─ 已标准化：149 条                           │ │   │
│  │  │     └─ 未标准化：7 条（跳过的材料）               │ │   │
│  │  │                                                   │ │   │
│  │  │  📋 数据属性：                                    │ │   │
│  │  │     ├─ 材价时间：2026年01月                       │ │   │
│  │  │     ├─ 地点：北京市                               │ │   │
│  │  │     ├─ 来源：供应商报价                           │ │   │
│  │  │     └─ 供应商：XX钢铁有限公司                     │ │   │
│  │  │                                                   │ │   │
│  │  └───────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ☑ 仅推送已标准化的材料（推荐）                                │
│  ○ 推送全部材料（包含未标准化的）                              │
│                                                                 │
│  ⚠️ 推送后，此文件状态将变为"已推送"，不可再次补录。          │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [确认推送]             │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 推送结果

推送成功后提示：

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  ✓ 推送成功！                                           │
│                                                         │
│  已推送到"我的材价"：                                   │
│  • 材料价格：149 条                                     │
│  • 材价时间：2026年01月                                 │
│  • 来源：供应商报价 - XX钢铁有限公司                    │
│                                                         │
│  [去查看我的材价]                   [留在当前页面]       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 7. 数据汇聚

### 7.1 汇聚逻辑

材价文件推送到"我的材价"后，与造价文件解析出的材价**汇聚合并**：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   材价数据来源                                     我的材价                  │
│                                                                             │
│   ┌─────────────────┐                                                      │
│   │  造价文件解析    │ ──────────┐                                         │
│   │  (材料明细)      │           │                                         │
│   └─────────────────┘           │         ┌─────────────────────────┐     │
│                                 ├────────▶│                         │     │
│   ┌─────────────────┐           │         │       我的材价          │     │
│   │  材价文件上传    │ ──────────┘         │                         │     │
│   │  (独立材价)      │                     │  • 来源：造价文件解析   │     │
│   └─────────────────┘                     │  • 来源：材价文件上传   │     │
│                                           │                         │     │
│                                           │  统一标准化（SMLCode）  │     │
│                                           │  统一属性（ParamMap）   │     │
│                                           │                         │     │
│                                           └─────────────────────────┘     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 数据来源标识

| 来源 | source字段值 | 说明 |
|------|--------------|------|
| 造价文件解析 | cost_file | 从造价文件分析提取 |
| 材价文件上传 | material_file | 独立上传的材价文件 |

---

## 8. 数据模型

### 8.1 材价文件表 (material_price_file)

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | VARCHAR(36) | 是 | 主键 |
| file_name | VARCHAR(200) | 是 | 文件名 |
| file_path | VARCHAR(500) | 是 | 存储路径 |
| file_size | BIGINT | 是 | 文件大小(字节) |
| file_format | VARCHAR(20) | 是 | 文件格式 |
| status | VARCHAR(20) | 是 | 状态(pending/completed/pushed) |
| price_source | VARCHAR(20) | 是 | 材价来源(supplier/website/contract/review) |
| price_date | DATE | 是 | 材价时间（年月） |
| province | VARCHAR(50) | 是 | 省份 |
| city | VARCHAR(50) | 否 | 城市 |
| supplier_name | VARCHAR(200) | 否 | 供应商名称 |
| contact_name | VARCHAR(50) | 否 | 联系人 |
| contact_phone | VARCHAR(20) | 否 | 联系电话 |
| valid_from | DATE | 否 | 报价有效期开始 |
| valid_to | DATE | 否 | 报价有效期结束 |
| material_count | INT | 否 | 材料条数 |
| matched_count | INT | 否 | 已匹配条数 |
| remark | TEXT | 否 | 备注 |
| created_at | TIMESTAMP | 是 | 上传时间 |
| created_by | VARCHAR(36) | 是 | 上传人 |
| pushed_at | TIMESTAMP | 否 | 推送时间 |

### 8.2 材价来源枚举

| 值 | 显示名称 |
|------|----------|
| supplier | 供应商报价 |
| website | 网站询价 |
| contract | 合同价 |
| review | 财评价 |

### 8.3 状态枚举

| 状态 | 说明 | 可执行操作 |
|------|------|------------|
| pending | 待补录 | 查看、补录、删除 |
| completed | 已补录 | 查看、补录、推送、删除 |
| pushed | 已推送 | 查看、删除 |

---

## 9. 接口设计

### 9.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取列表 | GET | /api/v1/material-price-files | 分页查询列表 |
| 上传文件 | POST | /api/v1/material-price-files/upload | 上传材价文件 |
| 获取详情 | GET | /api/v1/material-price-files/{id} | 获取文件详情 |
| 获取预览 | GET | /api/v1/material-price-files/{id}/preview | 获取材料清单 |
| 补录信息 | PUT | /api/v1/material-price-files/{id}/metadata | 更新元数据 |
| 推送数据 | POST | /api/v1/material-price-files/{id}/push | 推送到我的材价 |
| 删除文件 | DELETE | /api/v1/material-price-files/{id} | 删除文件 |
| 批量删除 | DELETE | /api/v1/material-price-files/batch | 批量删除 |

### 9.2 获取列表接口

**请求：**
```
GET /api/v1/material-price-files?page=1&pageSize=20&priceSource=supplier
```

**响应：**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "mpf-001",
        "fileName": "2026年1月钢材报价.xlsx",
        "status": "completed",
        "statusName": "已补录",
        "priceSource": "supplier",
        "priceSourceName": "供应商报价",
        "priceDate": "2026-01",
        "province": "北京市",
        "city": "海淀区",
        "supplierName": "XX钢铁有限公司",
        "materialCount": 156,
        "matchedCount": 149,
        "createdAt": "2026-01-18T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 86,
      "totalPages": 5
    }
  }
}
```

---

## 10. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-18 | 初版 | - |