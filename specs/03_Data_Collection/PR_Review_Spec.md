# PR审核流程规范 (PR Review Spec)

> 版本：V1.0  
> 更新日期：2026-01-18  
> 所属模块：03_Data_Collection（通用能力）

---

## 1. 概述

### 1.1 功能定位

PR（Push Request）审核是数据从"我的数据"推送到"企业库"的质量把关环节，确保：
- 数据质量符合企业标准
- 标准化映射准确
- 元数据完整

### 1.2 适用范围

| 数据类型 | 推送来源 | 推送目标 |
|----------|----------|----------|
| 项目数据 | 我的项目 | 企业库-案例库 |
| 指标数据 | 我的指标 | 企业库-指标库 |
| 材价数据 | 我的材价 | 企业库-材价库 |
| 综价数据 | 我的综价 | 企业库-综价库 |

### 1.3 审核流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  我的数据 │ ─▶ │  提交推送 │ ─▶ │  待审核   │ ─▶ │  审核中   │
└──────────┘    └──────────┘    └──────────┘    └────┬─────┘
                                                     │
                                    ┌────────────────┼────────────────┐
                                    ▼                                 ▼
                              ┌──────────┐                      ┌──────────┐
                              │ 审核通过  │                      │ 审核驳回  │
                              └────┬─────┘                      └────┬─────┘
                                   │                                 │
                                   ▼                                 ▼
                              ┌──────────┐                      ┌──────────┐
                              │ 进入企业库│                      │ 退回修改  │
                              └──────────┘                      └──────────┘
```

---

## 2. 状态定义

### 2.1 PR状态枚举

| 状态值 | 显示名称 | 说明 | 可执行操作 |
|--------|----------|------|------------|
| pending | 待审核 | 已提交，等待审核员处理 | 撤回 |
| reviewing | 审核中 | 审核员已认领，正在审核 | - |
| approved | 已通过 | 审核通过，数据已入库 | - |
| rejected | 已驳回 | 审核驳回，需修改后重新提交 | 修改、重新提交 |
| withdrawn | 已撤回 | 提交人主动撤回 | 重新提交 |

### 2.2 状态流转图

```
                    ┌─────────┐
                    │  草稿    │ （我的数据中的状态）
                    └────┬────┘
                         │ 提交推送
                         ▼
                    ┌─────────┐
            ┌───── │  待审核  │ ─────┐
            │       └────┬────┘       │
            │ 撤回       │ 认领       │
            ▼            ▼            │
      ┌─────────┐  ┌─────────┐       │
      │  已撤回  │  │  审核中  │       │
      └────┬────┘  └────┬────┘       │
           │            │             │
           │     ┌──────┴──────┐     │
           │     ▼             ▼     │
           │ ┌─────────┐ ┌─────────┐ │
           │ │  已通过  │ │  已驳回  │ │
           │ └────┬────┘ └────┬────┘ │
           │      │           │      │
           │      ▼           │      │
           │ ┌─────────┐      │      │
           │ │ 已入企业库│      │      │
           │ └─────────┘      │      │
           │                  │      │
           └──────────────────┴──────┘
                    重新提交
```

---

## 3. 角色与权限

### 3.1 角色定义

| 角色 | 说明 | 权限 |
|------|------|------|
| 提交人 | 提交PR的用户 | 提交、撤回、修改、重新提交 |
| 审核员 | 负责审核的用户 | 认领、通过、驳回 |
| 管理员 | 系统管理员 | 全部权限 + 指派审核员 |

### 3.2 权限矩阵

| 操作 | 提交人 | 审核员 | 管理员 |
|------|:------:|:------:|:------:|
| 提交PR | ✓ | ✓ | ✓ |
| 撤回PR | ✓（仅自己的） | - | ✓ |
| 认领PR | - | ✓ | ✓ |
| 审核通过 | - | ✓（仅已认领的） | ✓ |
| 审核驳回 | - | ✓（仅已认领的） | ✓ |
| 指派审核员 | - | - | ✓ |

---

## 4. 页面设计

### 4.1 我的PR列表（提交人视角）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  数据采集 > PR管理 > 我提交的                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 统计卡片 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐    │   │
│  │  │   全部     │  │   待审核   │  │   已通过    │  │   已驳回    │    │   │
│  │  │    56     │  │    12     │  │    38      │  │     6      │    │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 操作栏 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  筛选：状态 [全部 ▼]  数据类型 [全部 ▼]  提交时间 [全部 ▼]          │   │
│  │                                                        🔍 搜索       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ PR列表 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  PR编号         数据类型  数据名称        提交时间      状态    操作 │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │  PR-2026011801  项目     XX医院门诊楼    01-18 10:30   待审核   ···  │   │
│  │  PR-2026011802  指标     XX医院门诊楼    01-18 10:35   审核中   ···  │   │
│  │  PR-2026011803  材价     HRB400钢筋(25条)01-18 11:00   已通过   ···  │   │
│  │  PR-2026011804  综价     土建清单(30条)  01-18 11:20   已驳回   ···  │   │
│  │                                                                      │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │                                          共 56 条   < 1 2 3 ... 6 >  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 待审核列表（审核员视角）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  数据采集 > PR管理 > 待我审核                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 统计卡片 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐    │   │
│  │  │  待认领    │  │  我认领的   │  │  今日已审   │  │  本周已审   │    │   │
│  │  │    23     │  │     5      │  │    12      │  │    68      │    │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 操作栏 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  筛选：状态 [待认领 ▼]  数据类型 [全部 ▼]  提交人 [全部 ▼]          │   │
│  │                                                        🔍 搜索       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ PR列表 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  PR编号         数据类型  数据名称        提交人   提交时间    操作  │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │  PR-2026011801  项目     XX医院门诊楼    张三    01-18 10:30  [认领] │   │
│  │  PR-2026011805  材价     水泥(15条)      李四    01-18 11:45  [认领] │   │
│  │  PR-2026011806  综价     装饰清单(20条)  王五    01-18 12:00  [认领] │   │
│  │                                                                      │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │                                          共 23 条   < 1 2 ... >      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 列表字段定义

| 字段 | 说明 | 提交人视角 | 审核员视角 |
|------|------|:----------:|:----------:|
| PR编号 | 唯一标识 | ✓ | ✓ |
| 数据类型 | 项目/指标/材价/综价 | ✓ | ✓ |
| 数据名称 | 数据摘要 | ✓ | ✓ |
| 数据条数 | 批量提交时显示 | ✓ | ✓ |
| 提交人 | 提交PR的用户 | - | ✓ |
| 提交时间 | PR提交时间 | ✓ | ✓ |
| 审核员 | 认领/处理的审核员 | ✓ | - |
| 状态 | PR当前状态 | ✓ | ✓ |
| 操作 | 可执行操作 | ✓ | ✓ |

### 4.4 操作按钮

**提交人可用操作：**

| 状态 | 可用操作 |
|------|----------|
| 待审核 | 查看、撤回 |
| 审核中 | 查看 |
| 已通过 | 查看 |
| 已驳回 | 查看、修改、重新提交 |
| 已撤回 | 查看、重新提交 |

**审核员可用操作：**

| 状态 | 可用操作 |
|------|----------|
| 待认领 | 查看、认领 |
| 我认领的 | 查看、通过、驳回 |

---

## 5. 审核弹窗

### 5.1 审核详情弹窗

审核员点击 **[认领]** 或查看已认领的PR：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  审核PR - PR-2026011801                                              [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ PR信息 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  PR编号：PR-2026011801           数据类型：项目                      │   │
│  │  提交人：张三                     提交时间：2026-01-18 10:30         │   │
│  │  状态：待审核                                                        │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 数据预览 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  项目名称：XX医院门诊楼项目                                          │   │
│  │  功能标签：综合医院              规模档：大型                        │   │
│  │  地点：北京市海淀区              计价阶段：招标控制价                 │   │
│  │  材价基准期：2026年01月          总建筑面积：25,000 m²               │   │
│  │  工程总造价：85,000,000 元       单方造价：3,400 元/m²               │   │
│  │                                                                      │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │                                                                      │   │
│  │  包含数据：                                                          │   │
│  │  • 单位工程：6 个                                                    │   │
│  │  • 指标数据：7 条（1项目级 + 6单位工程级）                           │   │
│  │                                                                      │   │
│  │  [查看完整详情]                                                      │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 审核操作 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  审核意见：                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │                                                             │    │   │
│  │  │                                                             │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  │  快捷意见：[数据完整，同意入库]  [标签需调整]  [信息不完整]          │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                              [驳回]    [通过并入库]                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 驳回弹窗

点击 **[驳回]** 后：

```
┌─────────────────────────────────────────────────────────────────┐
│  驳回PR - PR-2026011801                                   [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  确定要驳回此PR吗？                                             │
│                                                                 │
│  驳回原因：（必填）                                             │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  快捷原因：                                                     │
│  [功能标签不准确]  [规模档错误]  [元数据不完整]  [数据质量问题]  │
│                                                                 │
│  ⚠️ 驳回后，提交人可修改后重新提交。                            │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [确认驳回]             │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 批量审核

审核员可批量处理多个PR：

```
┌─────────────────────────────────────────────────────────────────┐
│  批量审核                                                 [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  已选择 5 个PR：                                                │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ PR编号         │ 数据类型 │ 数据名称       │ 提交人      │ │
│  │───────────────│─────────│───────────────│────────────│ │
│  │ PR-2026011801  │ 材价    │ 钢筋(12条)     │ 张三        │ │
│  │ PR-2026011802  │ 材价    │ 水泥(8条)      │ 张三        │ │
│  │ PR-2026011803  │ 材价    │ 混凝土(15条)   │ 李四        │ │
│  │ PR-2026011804  │ 综价    │ 土建清单(20条) │ 李四        │ │
│  │ PR-2026011805  │ 综价    │ 装饰清单(18条) │ 王五        │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  批量操作：                                                     │
│  ○ 全部通过                                                     │
│  ○ 全部驳回                                                     │
│                                                                 │
│  审核意见：                                                     │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │  批量审核通过                                              │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [确认]                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 驳回后修改

### 6.1 驳回详情查看

提交人查看被驳回的PR：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  PR详情 - PR-2026011804（已驳回）                                    [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 驳回信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ⚠️ 此PR已被驳回                                                     │   │
│  │                                                                      │   │
│  │  审核员：王审核              驳回时间：2026-01-18 14:30              │   │
│  │                                                                      │   │
│  │  驳回原因：                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  功能标签不准确，该项目应归类为"专科医院-妇幼保健院"，         │    │   │
│  │  │  而非"综合医院"。请修改后重新提交。                           │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 数据预览 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  （数据内容...）                                                     │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                              [去修改]    [关闭]                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 修改后重新提交

点击 **[去修改]** 跳转到对应的数据补录页面，修改完成后可重新提交。

---

## 7. 消息通知

### 7.1 通知场景

| 事件 | 通知对象 | 通知内容 |
|------|----------|----------|
| 提交PR | 审核员 | "有新的PR待审核：{数据类型} - {数据名称}" |
| 认领PR | 提交人 | "您的PR已被{审核员}认领" |
| 审核通过 | 提交人 | "您的PR已审核通过，数据已入库" |
| 审核驳回 | 提交人 | "您的PR已被驳回，原因：{驳回原因}" |
| PR撤回 | 审核员（已认领时） | "PR已被提交人撤回" |

### 7.2 通知方式

| 方式 | 说明 | 默认开启 |
|------|------|:--------:|
| 站内消息 | 系统内消息中心 | ✓ |
| 邮件通知 | 发送邮件 | 可选 |
| 钉钉/企微 | 推送到IM | 可选 |

---

## 8. 数据模型

### 8.1 PR记录表 (pr_record)

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | VARCHAR(36) | 是 | 主键 |
| pr_no | VARCHAR(20) | 是 | PR编号（唯一） |
| data_type | VARCHAR(20) | 是 | 数据类型(project/index/material/composite) |
| data_id | VARCHAR(36) | 是 | 关联数据ID |
| data_name | VARCHAR(200) | 是 | 数据名称/摘要 |
| data_count | INT | 否 | 数据条数（批量提交时） |
| status | VARCHAR(20) | 是 | PR状态 |
| submitter_id | VARCHAR(36) | 是 | 提交人ID |
| submitter_name | VARCHAR(50) | 是 | 提交人姓名 |
| submitted_at | TIMESTAMP | 是 | 提交时间 |
| reviewer_id | VARCHAR(36) | 否 | 审核员ID |
| reviewer_name | VARCHAR(50) | 否 | 审核员姓名 |
| claimed_at | TIMESTAMP | 否 | 认领时间 |
| reviewed_at | TIMESTAMP | 否 | 审核时间 |
| review_comment | TEXT | 否 | 审核意见 |
| reject_reason | TEXT | 否 | 驳回原因 |
| created_at | TIMESTAMP | 是 | 创建时间 |
| updated_at | TIMESTAMP | 是 | 更新时间 |

### 8.2 PR数据关联表 (pr_data_item)

用于批量提交时关联多条数据：

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | VARCHAR(36) | 是 | 主键 |
| pr_id | VARCHAR(36) | 是 | PR记录ID |
| data_type | VARCHAR(20) | 是 | 数据类型 |
| data_id | VARCHAR(36) | 是 | 数据ID |
| data_name | VARCHAR(200) | 是 | 数据名称 |
| created_at | TIMESTAMP | 是 | 创建时间 |

### 8.3 PR编号生成规则

```
PR-{年月日}{4位序号}
例：PR-2026011800001
```

---

## 9. 接口设计

### 9.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 提交PR | POST | /api/v1/pr/submit | 提交PR |
| 批量提交PR | POST | /api/v1/pr/batch-submit | 批量提交 |
| 我提交的PR | GET | /api/v1/pr/my-submitted | 提交人查看列表 |
| 待审核PR | GET | /api/v1/pr/pending-review | 审核员查看列表 |
| 获取PR详情 | GET | /api/v1/pr/{id} | 获取详情 |
| 撤回PR | POST | /api/v1/pr/{id}/withdraw | 撤回 |
| 认领PR | POST | /api/v1/pr/{id}/claim | 认领 |
| 审核通过 | POST | /api/v1/pr/{id}/approve | 通过 |
| 审核驳回 | POST | /api/v1/pr/{id}/reject | 驳回 |
| 批量审核 | POST | /api/v1/pr/batch-review | 批量审核 |
| 重新提交 | POST | /api/v1/pr/{id}/resubmit | 重新提交 |

### 9.2 提交PR接口

**请求：**
```json
POST /api/v1/pr/submit
{
  "dataType": "project",
  "dataId": "mp-001",
  "dataName": "XX医院门诊楼项目",
  "submitComment": "请审核该项目数据"
}
```

**响应：**
```json
{
  "code": 0,
  "message": "提交成功",
  "data": {
    "prId": "pr-001",
    "prNo": "PR-2026011800001",
    "status": "pending"
  }
}
```

### 9.3 审核接口

**通过：**
```json
POST /api/v1/pr/{id}/approve
{
  "reviewComment": "数据完整，同意入库"
}
```

**驳回：**
```json
POST /api/v1/pr/{id}/reject
{
  "rejectReason": "功能标签不准确，请修改后重新提交"
}
```

---

## 10. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-18 | 初版 | - |