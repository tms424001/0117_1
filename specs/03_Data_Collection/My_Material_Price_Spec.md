# 我的材价规范 (My Material Price Spec)

> 版本：V1.0  
> 更新日期：2026-01-18  
> 所属模块：03_Data_Collection

---

## 1. 概述

### 1.1 功能定位

"我的材价"是个人数据仓库中的材料价格管理中心，负责：
- **汇聚**两个来源的材价数据（造价文件解析 + 材价文件上传）
- 提供材价数据的查看、筛选、分析
- 支持材价数据的PR补录（补充信息、调整标准化映射）
- **推送到企业库**（材价库）

### 1.2 数据来源与汇聚

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   数据来源1：造价文件                      我的材价                          │
│   ┌─────────────────┐                                                      │
│   │                 │                     ┌───────────────────────────────┐ │
│   │  造价文件采集    │                     │                               │ │
│   │       ↓         │                     │  材料价格数据汇聚              │ │
│   │  分析（标准化）  │ ─── 推送 ──────────▶│                               │ │
│   │       ↓         │   材价数据           │  ┌───────────────────────┐   │ │
│   │  我的项目       │                     │  │ 来源      │ 数量       │   │ │
│   │                 │                     │  │───────────│───────────│   │ │
│   └─────────────────┘                     │  │ 造价文件   │ 1,256 条  │   │ │
│                                           │  │ 材价文件   │ 486 条    │   │ │
│   数据来源2：材价文件                      │  │───────────│───────────│   │ │
│   ┌─────────────────┐                     │  │ 合计      │ 1,742 条  │   │ │
│   │                 │                     │  └───────────────────────┘   │ │
│   │  材价文件采集    │ ─── 推送 ──────────▶│                               │ │
│   │  （独立上传）    │   材价数据           │  统一标准化：SMLCode          │ │
│   │                 │                     │  统一属性：ParamMap           │ │
│   └─────────────────┘                     │                               │ │
│                                           └───────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 状态流转

```
┌──────────┐                  ┌──────────┐                  ┌──────────┐
│  待补录   │ ── PR补录 ────▶ │  已补录   │ ── 推送PR ────▶ │  已推送   │
└──────────┘                  └──────────┘                  └──────────┘
      │                             │
      └─────── 直接推送 ────────────┘
```

| 状态 | 说明 | 可执行操作 |
|------|------|------------|
| pending | 待补录 | 查看、PR补录、推送、删除 |
| completed | 已补录 | 查看、PR补录、推送、删除 |
| pushed | 已推送 | 查看、删除 |

---

## 2. 页面结构

### 2.1 我的材价列表页

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  数据采集 > 我的数据 > 我的材价                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 统计卡片 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐    │   │
│  │  │  材料总数   │  │ 造价文件来源│  │ 材价文件来源│  │   已推送    │    │   │
│  │  │   1,742    │  │   1,256    │  │    486     │  │    892     │    │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 操作栏 ────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  [批量推送]  [批量删除]  [导出Excel]            🔍 搜索材料名称      │   │
│  │                                                                      │   │
│  │  筛选：状态 [全部 ▼]  数据来源 [全部 ▼]  材料分类 [全部 ▼]          │   │
│  │        地点 [全部 ▼]  材价时间 [全部 ▼]  标准化状态 [全部 ▼]        │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 材价列表 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  □  材料名称      规格型号   单位 单价    地点  材价时间 来源   状态 │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │  □  HRB400钢筋    Φ12       t   4,250   北京  2026-01  造价文件 已补录│   │
│  │  □  HRB400钢筋    Φ16       t   4,180   北京  2026-01  材价文件 待补录│   │
│  │  □  C30商品混凝土 泵送      m³  485     上海  2026-01  造价文件 已推送│   │
│  │  □  普通硅酸盐水泥 P.O42.5  t   380     广州  2025-12  材价文件 已补录│   │
│  │  □  镀锌钢管      DN100    m   125     深圳  2026-01  造价文件 待补录│   │
│  │                                                                      │   │
│  │  ─────────────────────────────────────────────────────────────────── │   │
│  │                                        共 1,742 条  < 1 2 3 ... 88 > │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 列表字段定义

| 字段 | 说明 | 宽度 | 排序 |
|------|------|------|------|
| 复选框 | 批量操作选择 | 40px | - |
| 材料名称 | 材料名称 | 自适应 | 支持 |
| 规格型号 | 材料规格 | 120px | 支持 |
| 单位 | 计量单位 | 60px | - |
| 单价 | 材料单价（元） | 80px | 支持 |
| 地点 | 价格适用地区 | 80px | 支持 |
| 材价时间 | 价格时间基准 | 80px | 支持 |
| 来源 | 造价文件/材价文件 | 80px | 支持 |
| 状态 | 当前状态 | 80px | 支持 |
| 操作 | 操作按钮组 | 160px | - |

### 2.3 操作按钮

| 按钮 | 图标 | 说明 | 适用状态 |
|------|------|------|----------|
| 查看 | 👁 | 查看材价详情 | 全部 |
| PR补录 | ✏️ | 补录材价信息 | 待补录、已补录 |
| 推送 | 📤 | 推送到材价库 | 待补录、已补录 |
| 删除 | 🗑 | 删除材价 | 待补录、已补录 |

**按钮状态规则：**

| 状态 | 查看 | PR补录 | 推送 | 删除 |
|------|:----:|:------:|:----:|:----:|
| 待补录 | ✓ | ✓ | ✓ | ✓ |
| 已补录 | ✓ | ✓ | ✓ | ✓ |
| 已推送 | ✓ | ✗ | ✗ | ✓ |

---

## 3. 查看弹窗

### 3.1 查看弹窗界面

点击 **[查看]** 按钮，打开材价详情弹窗：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  查看材价 - HRB400钢筋 Φ12                                           [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 基本信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  材料名称    │ HRB400钢筋                                    │    │   │
│  │  │  规格型号    │ Φ12                                          │    │   │
│  │  │  单位        │ t                                            │    │   │
│  │  │  单价        │ 4,250.00 元                                  │    │   │
│  │  │  地点        │ 北京市                                        │    │   │
│  │  │  材价时间    │ 2026年01月                                    │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 标准化信息 ────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  SMLCode     │ SML00123                                     │    │   │
│  │  │  标准名称    │ 热轧带肋钢筋                                  │    │   │
│  │  │  材料分类    │ 金属材料 > 钢材 > 钢筋                        │    │   │
│  │  │  匹配状态    │ ✓ 已匹配                                      │    │   │
│  │  │  匹配置信度  │ 95%                                          │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  │  参数映射（ParamMap）：                                              │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  牌号        │ HRB400                                       │    │   │
│  │  │  直径        │ 12mm                                         │    │   │
│  │  │  长度        │ 9m（标准）                                    │    │   │
│  │  │  执行标准    │ GB/T 1499.2-2018                             │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 来源信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │  数据来源    │ 造价文件                                      │    │   │
│  │  │  来源文件    │ XX医院项目.gbq                                │    │   │
│  │  │  来源项目    │ XX医院门诊楼项目                              │    │   │
│  │  │  入库时间    │ 2026-01-18 10:30:00                          │    │   │
│  │  │  当前状态    │ 已补录                                        │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                         [关闭]              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. PR补录弹窗

### 4.1 PR补录弹窗界面

点击 **[PR补录]** 按钮，打开补录弹窗：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  PR补录 - HRB400钢筋 Φ12                                             [×]    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─ 基本信息确认 ──────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  材料名称：[HRB400钢筋                                   ]          │   │
│  │  规格型号：[Φ12                                         ]          │   │
│  │  单位：    [t ▼]                                                    │   │
│  │  单价：    [4250.00         ] 元                                    │   │
│  │                                                                      │   │
│  │  地点：    [北京市 ▼] [        ▼]                                   │   │
│  │  材价时间：[2026 ▼] 年 [01 ▼] 月                                    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 标准化映射 ────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  当前映射：SML00123 - 热轧带肋钢筋                                   │   │
│  │  匹配置信度：95%                                                     │   │
│  │                                                                      │   │
│  │  ○ 确认当前映射                                                      │   │
│  │  ○ 修改映射：[请选择标准材料 ▼]                                      │   │
│  │                                                                      │   │
│  │  参数映射（ParamMap）：                                              │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │ 参数名      │ 当前值        │ 修改                              │ │   │
│  │  │────────────│──────────────│─────────────────────────────────│ │   │
│  │  │ 牌号        │ HRB400       │ [HRB400 ▼]                       │ │   │
│  │  │ 直径        │ 12mm         │ [12 ▼] mm                        │ │   │
│  │  │ 长度        │ 9m           │ [9m（标准）▼]                    │ │   │
│  │  │ 执行标准    │ GB/T 1499.2  │ [GB/T 1499.2-2018 ▼]            │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─ 补充信息 ──────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  价格类型：○ 市场价  ○ 信息价  ○ 合同价  ○ 财评价                   │   │
│  │                                                                      │   │
│  │  供应商：  [                                              ]          │   │
│  │  品牌：    [                                              ]          │   │
│  │                                                                      │   │
│  │  是否含税：☑ 含税    税率：[13 ▼] %                                  │   │
│  │  是否含运：☑ 含运费                                                  │   │
│  │                                                                      │   │
│  │  备注：                                                              │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │                                                             │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                    [取消]    [保存]                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 PR补录字段说明

| 分组 | 字段 | 必填 | 说明 |
|------|------|:----:|------|
| **基本信息** | | | |
| | 材料名称 | 是 | 可修改 |
| | 规格型号 | 是 | 可修改 |
| | 单位 | 是 | 下拉选择 |
| | 单价 | 是 | 数值 |
| | 地点 | 是 | 省/市选择 |
| | 材价时间 | 是 | 年/月选择 |
| **标准化映射** | | | |
| | SMLCode | 是 | 确认或修改映射 |
| | ParamMap参数 | 否 | 各参数可调整 |
| **补充信息** | | | |
| | 价格类型 | 否 | 单选 |
| | 供应商 | 否 | 文本输入 |
| | 品牌 | 否 | 文本输入 |
| | 是否含税 | 否 | 复选框 + 税率 |
| | 是否含运 | 否 | 复选框 |
| | 备注 | 否 | 多行文本 |

---

## 5. 推送弹窗

### 5.1 单条推送

点击 **[推送]** 按钮，打开推送确认弹窗：

```
┌─────────────────────────────────────────────────────────────────┐
│  推送到企业库 - HRB400钢筋 Φ12                            [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─ 推送内容预览 ──────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  将推送以下材价数据到企业库-材价库：                     │   │
│  │                                                         │   │
│  │  ┌───────────────────────────────────────────────────┐ │   │
│  │  │                                                   │ │   │
│  │  │  📦 材料信息：                                    │ │   │
│  │  │     ├─ 材料名称：HRB400钢筋                       │ │   │
│  │  │     ├─ 规格型号：Φ12                             │ │   │
│  │  │     ├─ 单价：4,250.00 元/t                       │ │   │
│  │  │     ├─ 地点：北京市                               │ │   │
│  │  │     └─ 材价时间：2026年01月                       │ │   │
│  │  │                                                   │ │   │
│  │  │  🏷️ 标准化信息：                                  │ │   │
│  │  │     ├─ SMLCode：SML00123                         │ │   │
│  │  │     └─ 标准名称：热轧带肋钢筋                     │ │   │
│  │  │                                                   │ │   │
│  │  └───────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  审核说明：[请审核该材料价格数据                              ] │
│                                                                 │
│  ⚠️ 推送后将提交PR审核，审核通过后进入企业材价库。             │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [提交PR]               │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 批量推送

选择多条材价后点击 **[批量推送]**：

```
┌─────────────────────────────────────────────────────────────────┐
│  批量推送到企业库                                         [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  已选择 25 条材价数据：                                         │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ 材料分类      │ 数量    │ 已标准化 │ 状态分布             │ │
│  │──────────────│────────│─────────│────────────────────│ │
│  │ 钢材          │ 12 条  │ 12 条   │ 已补录:8 待补录:4    │ │
│  │ 水泥          │ 5 条   │ 5 条    │ 已补录:5             │ │
│  │ 混凝土        │ 8 条   │ 7 条    │ 已补录:6 待补录:2    │ │
│  │──────────────│────────│─────────│────────────────────│ │
│  │ 合计          │ 25 条  │ 24 条   │ 已补录:19 待补录:6   │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ⚠️ 其中 1 条材料未完成标准化映射，将跳过推送。                 │
│  ⚠️ 其中 6 条材料状态为"待补录"，建议先完成PR补录。             │
│                                                                 │
│  ○ 仅推送已标准化且已补录的材料（18条）                         │
│  ○ 推送已标准化的全部材料（24条）                               │
│  ☑ 推送全部材料（25条，1条将跳过）                              │
│                                                                 │
│  审核说明：[批量推送材价数据                                  ] │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [提交PR]               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 批量操作

### 6.1 导出Excel

点击 **[导出Excel]** 可导出材价数据：

```
┌─────────────────────────────────────────────────────────────────┐
│  导出材价数据                                             [×]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  导出范围：                                                     │
│  ○ 当前筛选结果（1,742 条）                                     │
│  ○ 选中的材料（25 条）                                          │
│  ☑ 全部材料                                                     │
│                                                                 │
│  导出内容：                                                     │
│  ☑ 基本信息（材料名称、规格型号、单位、单价等）                 │
│  ☑ 标准化信息（SMLCode、标准名称、材料分类）                    │
│  ☑ 参数映射（ParamMap各参数）                                   │
│  □ 来源信息（来源文件、来源项目）                               │
│                                                                 │
│  文件格式：                                                     │
│  ☑ Excel (.xlsx)                                                │
│  ○ CSV (.csv)                                                   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                [取消]    [导出]                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 数据模型

### 7.1 我的材价表 (my_material_price)

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | VARCHAR(36) | 是 | 主键 |
| source_type | VARCHAR(20) | 是 | 来源类型(cost_file/material_file) |
| source_file_id | VARCHAR(36) | 是 | 来源文件ID |
| source_project_id | VARCHAR(36) | 否 | 来源项目ID（造价文件来源时） |
| status | VARCHAR(20) | 是 | 状态 |
| material_name | VARCHAR(200) | 是 | 材料名称 |
| specification | VARCHAR(200) | 否 | 规格型号 |
| unit | VARCHAR(20) | 是 | 计量单位 |
| price | DECIMAL(18,2) | 是 | 单价 |
| province | VARCHAR(50) | 是 | 省份 |
| city | VARCHAR(50) | 否 | 城市 |
| price_date | DATE | 是 | 材价时间 |
| sml_code | VARCHAR(50) | 否 | 标准材料编码 |
| sml_name | VARCHAR(200) | 否 | 标准材料名称 |
| material_category | VARCHAR(200) | 否 | 材料分类路径 |
| match_status | VARCHAR(20) | 是 | 匹配状态(matched/pending/skipped) |
| match_confidence | DECIMAL(5,2) | 否 | 匹配置信度 |
| param_map | JSONB | 否 | 参数映射 |
| price_type | VARCHAR(20) | 否 | 价格类型 |
| supplier | VARCHAR(200) | 否 | 供应商 |
| brand | VARCHAR(100) | 否 | 品牌 |
| is_tax_included | BOOLEAN | 否 | 是否含税 |
| tax_rate | DECIMAL(5,2) | 否 | 税率 |
| is_freight_included | BOOLEAN | 否 | 是否含运费 |
| remark | TEXT | 否 | 备注 |
| created_at | TIMESTAMP | 是 | 创建时间 |
| created_by | VARCHAR(36) | 是 | 创建人 |
| completed_at | TIMESTAMP | 否 | 补录完成时间 |
| pushed_at | TIMESTAMP | 否 | 推送时间 |

### 7.2 来源类型枚举

| 值 | 显示名称 | 说明 |
|------|----------|------|
| cost_file | 造价文件 | 从造价文件分析提取 |
| material_file | 材价文件 | 独立上传的材价文件 |

### 7.3 状态枚举

| 状态值 | 显示名称 | 说明 |
|--------|----------|------|
| pending | 待补录 | 刚推送过来 |
| completed | 已补录 | 已完成PR补录 |
| pushed | 已推送 | 已提交PR到企业库 |

### 7.4 匹配状态枚举

| 状态值 | 显示名称 | 说明 |
|--------|----------|------|
| matched | 已匹配 | 已匹配到标准材料 |
| pending | 待确认 | 匹配置信度低，需人工确认 |
| skipped | 已跳过 | 用户选择跳过标准化 |

---

## 8. 接口设计

### 8.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取列表 | GET | /api/v1/my-material-prices | 分页查询列表 |
| 获取详情 | GET | /api/v1/my-material-prices/{id} | 获取材价详情 |
| PR补录 | PUT | /api/v1/my-material-prices/{id}/pr-info | 更新PR补录信息 |
| 批量PR补录 | PUT | /api/v1/my-material-prices/batch-pr-info | 批量更新 |
| 推送到企业库 | POST | /api/v1/my-material-prices/{id}/push | 提交PR |
| 批量推送 | POST | /api/v1/my-material-prices/batch-push | 批量提交PR |
| 删除材价 | DELETE | /api/v1/my-material-prices/{id} | 删除 |
| 批量删除 | DELETE | /api/v1/my-material-prices/batch | 批量删除 |
| 导出Excel | GET | /api/v1/my-material-prices/export | 导出数据 |
| 统计概览 | GET | /api/v1/my-material-prices/statistics | 获取统计 |

### 8.2 获取列表接口

**请求：**
```
GET /api/v1/my-material-prices?page=1&pageSize=20&sourceType=cost_file&status=completed
```

**响应：**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "mmp-001",
        "materialName": "HRB400钢筋",
        "specification": "Φ12",
        "unit": "t",
        "price": 4250.00,
        "province": "北京市",
        "priceDate": "2026-01",
        "sourceType": "cost_file",
        "sourceTypeName": "造价文件",
        "sourceFileName": "XX医院项目.gbq",
        "status": "completed",
        "statusName": "已补录",
        "smlCode": "SML00123",
        "smlName": "热轧带肋钢筋",
        "materialCategory": "金属材料 > 钢材 > 钢筋",
        "matchStatus": "matched",
        "matchConfidence": 95,
        "createdAt": "2026-01-18T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 1742,
      "totalPages": 88
    },
    "statistics": {
      "totalCount": 1742,
      "costFileCount": 1256,
      "materialFileCount": 486,
      "pushedCount": 892
    }
  }
}
```

---

## 9. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-18 | 初版 | - |