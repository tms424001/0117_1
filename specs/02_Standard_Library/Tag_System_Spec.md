# 功能标签体系规范 (Tag System Spec)

> 版本：V1.0  
> 更新日期：2026-01-17  
> 所属模块：02_Standard_Library

---

## 1. 概述

### 1.1 目的
功能标签是连接设计维度与造价维度的桥梁，通过给单体工程打上标准化的功能标签，实现：
- 历史造价数据按功能归集
- 生成可指导设计的造价指标
- 支持限额设计和设计优化

### 1.2 设计原则
- **标准化**：标签名称、编码、层级结构统一规范
- **完备性**：覆盖常见建筑类型，支持扩展
- **易用性**：支持搜索、筛选、智能推荐
- **可维护**：支持标签的增删改，版本管理

### 1.3 术语定义

| 术语 | 定义 |
|------|------|
| 功能标签 | 描述单体工程功能用途的标准化标识 |
| 标签大类 | 功能标签的一级分类，如"医疗卫生"、"教育"等 |
| 标签编码 | 功能标签的唯一标识符，如"YI-01" |
| 单体 | 具有独立设计文件、能独立施工的建筑物或构筑物 |

---

## 2. 标签体系结构

### 2.1 层级结构

```
标签大类 (Category)
  └── 功能标签 (Tag)
        └── 适用项目类型 (Applicable Project Types)
```

### 2.2 标签大类清单

| 序号 | 大类编码 | 大类名称 | 标签数量 | 说明 |
|------|----------|----------|----------|------|
| 1 | YI | 医疗卫生 | 30 | 各类医疗机构的功能单元 |
| 2 | JY | 教育 | 30 | 各级各类学校的功能单元 |
| 3 | BG | 办公 | 15 | 办公类建筑的功能单元 |
| 4 | SY | 商业 | 16 | 商业类建筑的功能单元 |
| 5 | JD | 酒店 | 17 | 酒店类建筑的功能单元 |
| 6 | WH | 文化 | 17 | 文化类建筑的功能单元 |
| 7 | TI | 体育 | 16 | 体育类建筑的功能单元 |
| 8 | JZ | 居住 | 20 | 居住类建筑的功能单元 |
| 9 | YA | 养老 | 10 | 养老类建筑的功能单元 |
| 10 | SF | 司法 | 11 | 司法类建筑的功能单元 |
| 11 | JT | 交通 | 11 | 交通类建筑的功能单元 |
| 12 | GY | 工业 | 16 | 工业类建筑的功能单元 |
| 13 | TG | 通用 | 15 | 各类项目通用的功能单元 |
| 14 | SW | 室外/总平 | 15 | 室外工程的功能单元 |
| **合计** | | | **239** | |

---

## 3. 数据模型

### 3.1 标签大类表 (tag_category)

```typescript
interface TagCategory {
  id: string;                    // 主键UUID
  code: string;                  // 大类编码，如 "YI"
  name: string;                  // 大类名称，如 "医疗卫生"
  description: string;           // 描述说明
  icon: string;                  // 图标标识
  color: string;                 // 主题色，用于UI展示
  sortOrder: number;             // 排序号
  status: 'active' | 'inactive'; // 状态
  createdAt: Date;
  updatedAt: Date;
}
```

**字段说明：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | string | 是 | UUID主键 |
| code | string | 是 | 大类编码，2位大写字母，唯一 |
| name | string | 是 | 大类名称，最长20字符 |
| description | string | 否 | 描述说明，最长200字符 |
| icon | string | 否 | 图标名称，用于UI展示 |
| color | string | 否 | HEX颜色值，如 "#1890FF" |
| sortOrder | number | 是 | 排序号，用于列表展示顺序 |
| status | enum | 是 | 状态：active-启用，inactive-停用 |

### 3.2 功能标签表 (function_tag)

```typescript
interface FunctionTag {
  id: string;                    // 主键UUID
  categoryId: string;            // 所属大类ID
  categoryCode: string;          // 所属大类编码（冗余）
  code: string;                  // 标签编码，如 "YI-01"
  name: string;                  // 标签名称，如 "门诊"
  fullName: string;              // 完整名称，如 "医疗卫生-门诊"
  description: string;           // 描述说明
  
  // 适用范围
  applicableProjectTypes: string[]; // 适用项目类型编码数组
  
  // 默认配置
  defaultSpaces: string[];       // 默认空间，如 ["DS", "DX"]
  defaultUnit: string;           // 默认计量单位，如 "m²"
  functionalUnit: string;        // 功能单位，如 "床位"、"班级"
  functionalUnitName: string;    // 功能单位名称
  
  // 智能匹配
  keywords: string[];            // 匹配关键字，用于智能推荐
  synonyms: string[];            // 同义词
  
  // 系统字段
  sortOrder: number;             // 排序号
  status: 'active' | 'inactive'; // 状态
  version: number;               // 版本号
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}
```

**字段说明：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | string | 是 | UUID主键 |
| categoryId | string | 是 | 外键，关联tag_category.id |
| categoryCode | string | 是 | 大类编码，冗余字段便于查询 |
| code | string | 是 | 标签编码，格式：大类编码-序号，如"YI-01" |
| name | string | 是 | 标签名称，最长50字符 |
| fullName | string | 是 | 完整名称，格式：大类名称-标签名称 |
| description | string | 否 | 描述说明，最长500字符 |
| applicableProjectTypes | array | 否 | 适用项目类型编码数组 |
| defaultSpaces | array | 是 | 默认空间编码数组 |
| defaultUnit | string | 是 | 默认计量单位 |
| functionalUnit | string | 否 | 功能规模单位，如"床"、"班" |
| functionalUnitName | string | 否 | 功能单位中文名 |
| keywords | array | 否 | 关键字数组，用于智能匹配 |
| synonyms | array | 否 | 同义词数组 |
| sortOrder | number | 是 | 排序号 |
| status | enum | 是 | 状态 |
| version | number | 是 | 版本号，每次修改+1 |

### 3.3 标签映射规则表 (tag_mapping_rule)

用于智能推荐标签。

```typescript
interface TagMappingRule {
  id: string;
  tagId: string;                 // 关联的功能标签ID
  tagCode: string;               // 功能标签编码（冗余）
  
  // 匹配规则
  keyword: string;               // 匹配关键字
  matchType: 'exact' | 'contains' | 'startsWith' | 'endsWith' | 'regex';
  caseSensitive: boolean;        // 是否区分大小写
  
  // 匹配结果
  confidence: number;            // 置信度 0-1
  priority: number;              // 优先级，数值越大优先级越高
  
  // 系统字段
  status: 'active' | 'inactive';
  createdAt: Date;
  updatedAt: Date;
}
```

**匹配类型说明：**

| matchType | 说明 | 示例 |
|-----------|------|------|
| exact | 精确匹配 | "门诊楼" 匹配 "门诊楼" |
| contains | 包含匹配 | "门诊" 匹配 "门诊医技楼" |
| startsWith | 前缀匹配 | "住院" 匹配 "住院楼1#" |
| endsWith | 后缀匹配 | "车库" 匹配 "地下车库" |
| regex | 正则匹配 | "住院楼\d+#" 匹配 "住院楼1#" |

---

## 4. 功能标签明细

### 4.1 医疗卫生类 (YI)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| YI-01 | 门诊 | 普通门诊、专家门诊 | - | 门诊,门诊楼,门诊部 |
| YI-02 | 急诊 | 急诊、急救 | - | 急诊,急诊楼,急诊部,急救 |
| YI-03 | 发热门诊 | 独立发热门诊 | - | 发热,发热门诊 |
| YI-04 | 住院-普通 | 普通病房 | 床位 | 住院,住院楼,病房楼,住院部 |
| YI-05 | 住院-重症 | ICU、CCU等重症监护 | 床位 | ICU,CCU,重症,监护 |
| YI-06 | 住院-产科 | 产房、产科病房 | 床位 | 产科,产房,分娩 |
| YI-07 | 住院-儿科 | 儿科病房、NICU | 床位 | 儿科,NICU,新生儿 |
| YI-08 | 医技 | 检验、影像、功能检查 | - | 医技,医技楼,检验,影像,放射 |
| YI-09 | 手术中心 | 手术室、麻醉 | - | 手术,手术室,手术中心 |
| YI-10 | 感染-负压 | 负压病房、感染楼 | 床位 | 感染,负压,传染,隔离 |
| YI-11 | 康复 | 康复治疗、理疗 | 床位 | 康复,理疗,康复中心 |
| YI-12 | 体检 | 健康体检中心 | - | 体检,体检中心,健康管理 |
| YI-13 | 血透中心 | 血液透析 | - | 血透,透析,血液透析 |
| YI-14 | 制剂 | 中药/西药制剂 | - | 制剂,制剂楼,药房 |
| YI-15 | 保健 | 妇幼保健、儿童保健 | - | 保健,妇幼,儿保 |
| YI-16 | 行政办公 | 医院行政管理 | - | 行政,办公,行政楼 |
| YI-17 | 后勤服务 | 后勤综合楼 | - | 后勤,后勤楼,总务 |
| YI-18 | 餐饮 | 食堂、营养餐厅 | - | 食堂,餐厅,营养,职工食堂 |
| YI-19 | 宿舍-职工 | 职工宿舍、值班用房 | - | 宿舍,值班,职工宿舍 |
| YI-20 | 科研教学 | 教学楼、科研楼 | - | 教学,科研,培训 |
| YI-21 | 污水处理 | 医疗污水处理站 | - | 污水,污水处理,废水 |
| YI-22 | 液氧站 | 医用气体供应 | - | 液氧,氧气,气体站 |
| YI-23 | 高压氧 | 高压氧舱 | - | 高压氧,氧舱 |
| YI-24 | 太平间 | 太平间、告别厅 | - | 太平间,告别 |
| YI-25 | 医废暂存 | 医疗废物暂存间 | - | 医废,医疗废物,垃圾 |
| YI-26 | 地下车库 | 地下停车 | 车位 | 地下车库,地下室,停车 |
| YI-27 | 地下室-设备 | 设备层、人防 | - | 设备层,人防,地下设备 |
| YI-28 | 连廊 | 建筑连接体 | - | 连廊,廊道,通道 |
| YI-29 | 社区卫生 | 社区卫生服务综合 | - | 社区卫生,卫生服务中心 |
| YI-30 | 乡镇卫生 | 乡镇卫生院综合 | - | 乡镇卫生院,卫生院 |

### 4.2 教育类 (JY)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| JY-01 | 教学-普通 | 普通教室、阶梯教室 | 班 | 教学楼,教室,普通教室 |
| JY-02 | 教学-专用 | 音乐、美术、计算机教室 | - | 专用教室,音乐,美术,计算机 |
| JY-03 | 实验-理化生 | 理化生实验室 | - | 实验楼,实验室,理化生 |
| JY-04 | 实验-专业 | 专业实验室 | - | 专业实验,实验中心 |
| JY-05 | 实训车间 | 实习实训 | - | 实训,实训楼,车间,实习 |
| JY-06 | 图书馆 | 图书、阅览 | - | 图书馆,图书,阅览 |
| JY-07 | 报告厅 | 学术报告、礼堂 | 座 | 报告厅,礼堂,学术报告 |
| JY-08 | 行政办公 | 学校行政管理 | - | 行政楼,办公楼,行政 |
| JY-09 | 体育馆 | 室内体育 | - | 体育馆,室内体育,球馆 |
| JY-10 | 风雨操场 | 风雨操场、室内跑道 | - | 风雨操场,室内操场 |
| JY-11 | 游泳馆 | 游泳教学 | - | 游泳馆,游泳池,泳池 |
| JY-12 | 运动场 | 田径场、足球场 | - | 运动场,田径场,足球场,操场 |
| JY-13 | 篮球场 | 室外篮球场 | - | 篮球场,球场 |
| JY-14 | 看台 | 运动场看台 | 座 | 看台,观众席 |
| JY-15 | 食堂 | 学生食堂 | - | 食堂,餐厅,学生食堂 |
| JY-16 | 宿舍-学生 | 学生公寓、宿舍 | 床位 | 学生宿舍,宿舍,学生公寓 |
| JY-17 | 宿舍-教师 | 教师公寓 | - | 教师宿舍,教师公寓 |
| JY-18 | 活动-幼儿 | 幼儿活动室、寝室 | 班 | 幼儿园,活动室,幼儿 |
| JY-19 | 医务室 | 学校医务、心理咨询 | - | 医务室,卫生室,心理 |
| JY-20 | 艺术楼 | 艺术教育综合 | - | 艺术楼,艺术中心 |
| JY-21 | 综合楼 | 多功能综合 | - | 综合楼,多功能 |
| JY-22 | 门卫室 | 学校门卫 | - | 门卫,门房,传达室 |
| JY-23 | 垃圾站 | 学校垃圾收集 | - | 垃圾站,垃圾房 |
| JY-24 | 配电房 | 供电设施 | - | 配电房,配电室,变配电 |
| JY-25 | 地下车库 | 地下停车 | 车位 | 地下车库,停车库 |
| JY-26 | 地下室-设备 | 设备层 | - | 地下设备,设备层 |
| JY-27 | 学生活动中心 | 学生活动、社团 | - | 学生活动中心,活动中心 |
| JY-28 | 校史馆 | 校史展览 | - | 校史馆,校史 |
| JY-29 | 科研楼 | 科研用房 | - | 科研楼,科研中心 |
| JY-30 | 院系楼 | 学院办公教学 | - | 院系楼,学院楼 |

### 4.3 办公类 (BG)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| BG-01 | 办公-普通 | 普通办公用房 | - | 办公楼,办公,行政办公 |
| BG-02 | 办公-高端 | 高标准办公 | - | 总部,高端办公,甲级写字楼 |
| BG-03 | 会议-小型 | 小会议室 | - | 小会议室,会议 |
| BG-04 | 会议-大型 | 大会议室、报告厅 | 座 | 大会议室,报告厅,会议中心 |
| BG-05 | 多功能厅 | 多功能会议、宴会 | - | 多功能厅,宴会厅 |
| BG-06 | 档案 | 档案室、档案库 | - | 档案室,档案馆,档案 |
| BG-07 | 展厅 | 展示大厅 | - | 展厅,展示厅,展览 |
| BG-08 | 餐饮 | 机关食堂、员工餐厅 | - | 食堂,餐厅,员工餐厅 |
| BG-09 | 健身 | 职工健身 | - | 健身房,健身中心 |
| BG-10 | 接待 | 贵宾接待 | - | 接待,贵宾室,VIP |
| BG-11 | 门卫 | 门卫值班 | - | 门卫,门房 |
| BG-12 | 配电房 | 供电设施 | - | 配电房,变配电 |
| BG-13 | 地下车库 | 地下停车 | 车位 | 地下车库,地下室 |
| BG-14 | 地下室-设备 | 设备层、人防 | - | 设备层,人防 |
| BG-15 | 裙楼商业 | 底商、配套商业 | - | 裙楼,底商,商业配套 |

### 4.4 商业类 (SY)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| SY-01 | 商业-百货 | 百货、购物中心 | - | 百货,购物中心,商场 |
| SY-02 | 商业-超市 | 大型超市 | - | 超市,卖场 |
| SY-03 | 商业-专卖 | 专卖店、品牌店 | - | 专卖店,品牌店 |
| SY-04 | 商业-餐饮 | 餐饮区、美食广场 | - | 餐饮,美食广场,餐饮街 |
| SY-05 | 商业-影院 | 电影院 | - | 影院,电影院,影城 |
| SY-06 | 商业-娱乐 | KTV、电玩、健身 | - | KTV,娱乐,电玩,健身 |
| SY-07 | 商业-儿童 | 儿童业态、游乐 | - | 儿童,游乐,亲子 |
| SY-08 | 农贸市场 | 菜市场、农产品 | - | 农贸市场,菜市场 |
| SY-09 | 冷库 | 生鲜冷藏 | - | 冷库,冷藏 |
| SY-10 | 办公塔楼 | 综合体办公 | - | 办公塔楼,写字楼 |
| SY-11 | 酒店塔楼 | 综合体酒店 | 间 | 酒店塔楼 |
| SY-12 | 公寓塔楼 | 综合体公寓 | 套 | 公寓塔楼 |
| SY-13 | 地下商业 | 地下商业街 | - | 地下商业,地下街 |
| SY-14 | 地下车库 | 地下停车 | 车位 | 地下车库 |
| SY-15 | 地下室-设备 | 设备层 | - | 设备层 |
| SY-16 | 管理用房 | 物业、管理 | - | 物业,管理用房 |

### 4.5 酒店类 (JD)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| JD-01 | 客房-标准 | 标准客房 | 间 | 客房,标准间,客房楼 |
| JD-02 | 客房-套房 | 套房、行政楼层 | 间 | 套房,行政楼层,豪华 |
| JD-03 | 客房-公寓 | 酒店式公寓 | 套 | 酒店公寓,公寓 |
| JD-04 | 大堂 | 酒店大堂、前台 | - | 大堂,前台,接待 |
| JD-05 | 餐饮-中餐 | 中餐厅 | - | 中餐厅,中餐 |
| JD-06 | 餐饮-西餐 | 西餐厅、全日餐厅 | - | 西餐厅,全日餐厅 |
| JD-07 | 餐饮-宴会 | 宴会厅 | - | 宴会厅,宴会 |
| JD-08 | 会议中心 | 会议室群 | - | 会议中心,会议室 |
| JD-09 | 康体-泳池 | 游泳池 | - | 泳池,游泳池 |
| JD-10 | 康体-健身 | 健身房 | - | 健身房,健身中心 |
| JD-11 | 康体-SPA | SPA、桑拿 | - | SPA,桑拿,水疗 |
| JD-12 | 后勤-厨房 | 中央厨房 | - | 厨房,中央厨房 |
| JD-13 | 后勤-洗衣 | 洗衣房 | - | 洗衣房,洗衣 |
| JD-14 | 后勤-员工 | 员工餐厅、更衣 | - | 员工餐厅,员工区 |
| JD-15 | 行政办公 | 酒店行政 | - | 行政,办公 |
| JD-16 | 地下车库 | 地下停车 | 车位 | 地下车库 |
| JD-17 | 地下室-设备 | 设备层 | - | 设备层 |

### 4.6 文化类 (WH)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| WH-01 | 展厅-常设 | 常设展览 | - | 常设展厅,固定展览 |
| WH-02 | 展厅-临时 | 临时展览 | - | 临时展厅,临展 |
| WH-03 | 藏品库房 | 文物库房（恒温恒湿） | - | 库房,藏品库,文物库 |
| WH-04 | 阅览-开架 | 开架阅览 | - | 开架,阅览室 |
| WH-05 | 阅览-闭架 | 闭架借阅 | - | 闭架,借阅 |
| WH-06 | 书库 | 图书存储 | - | 书库,藏书 |
| WH-07 | 演出-剧场 | 剧场、音乐厅 | 座 | 剧场,音乐厅,歌剧院 |
| WH-08 | 演出-小剧场 | 小型演出 | 座 | 小剧场,排练厅 |
| WH-09 | 排练厅 | 排练、彩排 | - | 排练厅,排练 |
| WH-10 | 培训教室 | 文化培训 | - | 培训教室,培训 |
| WH-11 | 活动室 | 群众活动 | - | 活动室,活动中心 |
| WH-12 | 报告厅 | 学术报告 | 座 | 报告厅,学术报告 |
| WH-13 | 文创商店 | 文创、纪念品 | - | 文创,纪念品,商店 |
| WH-14 | 餐饮 | 餐厅、咖啡 | - | 餐厅,咖啡,休息区 |
| WH-15 | 行政办公 | 行政管理 | - | 行政,办公 |
| WH-16 | 地下车库 | 地下停车 | 车位 | 地下车库 |
| WH-17 | 地下室-设备 | 设备层 | - | 设备层 |

### 4.7 体育类 (TI)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| TI-01 | 比赛场-综合 | 综合体育馆比赛场 | 座 | 比赛馆,主馆,综合馆 |
| TI-02 | 比赛场-专项 | 专项比赛（游泳、篮球等） | 座 | 游泳馆,篮球馆,专项馆 |
| TI-03 | 训练馆 | 训练用馆 | - | 训练馆,训练场 |
| TI-04 | 游泳池-比赛 | 比赛游泳池 | - | 比赛池,标准池 |
| TI-05 | 游泳池-训练 | 训练游泳池 | - | 训练池,热身池 |
| TI-06 | 游泳池-跳水 | 跳水池 | - | 跳水池,跳水 |
| TI-07 | 田径场 | 体育场跑道+草坪 | - | 田径场,体育场,跑道 |
| TI-08 | 看台 | 观众看台 | 座 | 看台,观众席 |
| TI-09 | 运动员服务 | 更衣、休息、医疗 | - | 运动员,更衣室 |
| TI-10 | 观众服务 | 观众休息、商业 | - | 观众服务,商业 |
| TI-11 | 新闻中心 | 媒体、新闻发布 | - | 新闻中心,媒体中心 |
| TI-12 | 贵宾区 | VIP包厢、贵宾室 | - | VIP,贵宾,包厢 |
| TI-13 | 行政办公 | 场馆管理 | - | 行政,办公 |
| TI-14 | 设备用房 | 机电设备 | - | 设备用房,机房 |
| TI-15 | 地下车库 | 地下停车 | 车位 | 地下车库 |
| TI-16 | 地下室-设备 | 设备层 | - | 设备层 |

### 4.8 居住类 (JZ)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| JZ-01 | 住宅-多层 | 多层住宅（≤6层） | 户 | 多层,多层住宅 |
| JZ-02 | 住宅-小高层 | 小高层（7-11层） | 户 | 小高层 |
| JZ-03 | 住宅-高层 | 高层住宅（12-33层） | 户 | 高层,高层住宅 |
| JZ-04 | 住宅-超高层 | 超高层住宅（>100m） | 户 | 超高层 |
| JZ-05 | 住宅-别墅 | 独栋、联排、叠拼 | 户 | 别墅,独栋,联排,叠拼 |
| JZ-06 | 住宅-洋房 | 花园洋房 | 户 | 洋房,花园洋房 |
| JZ-07 | 公寓 | 酒店式公寓、SOHO | 套 | 公寓,SOHO |
| JZ-08 | 宿舍-普通 | 普通宿舍 | 床位 | 宿舍 |
| JZ-09 | 宿舍-人才 | 人才公寓 | 套 | 人才公寓,人才 |
| JZ-10 | 保障房 | 公租房、廉租房 | 套 | 保障房,公租房,廉租房 |
| JZ-11 | 配套商业 | 底商、社区商业 | - | 底商,社区商业,商业 |
| JZ-12 | 物业用房 | 物业管理 | - | 物业,管理用房 |
| JZ-13 | 社区服务 | 社区服务中心 | - | 社区服务,服务中心 |
| JZ-14 | 幼儿园 | 配套幼儿园 | 班 | 幼儿园 |
| JZ-15 | 垃圾站 | 垃圾收集点 | - | 垃圾站,垃圾房 |
| JZ-16 | 配电房 | 配电设施 | - | 配电房 |
| JZ-17 | 门卫室 | 门卫值班 | - | 门卫,门房 |
| JZ-18 | 地下车库 | 地下停车 | 车位 | 地下车库,地下室 |
| JZ-19 | 地下室-设备 | 设备层、人防 | - | 设备层,人防 |
| JZ-20 | 地下室-储藏 | 储藏室 | - | 储藏室,储物 |

### 4.9 养老类 (YA)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| YA-01 | 居住-自理 | 自理老人居住 | 床位 | 自理,自理区 |
| YA-02 | 居住-介护 | 介护老人居住 | 床位 | 介护,护理 |
| YA-03 | 居住-失智 | 失智老人专区 | 床位 | 失智,认知症 |
| YA-04 | 医疗护理 | 医务、护理站 | - | 医疗,护理站,医务室 |
| YA-05 | 康复 | 康复治疗 | - | 康复,理疗 |
| YA-06 | 餐饮 | 老人餐厅 | - | 餐厅,食堂 |
| YA-07 | 活动 | 文娱活动 | - | 活动室,文娱 |
| YA-08 | 行政办公 | 行政管理 | - | 行政,办公 |
| YA-09 | 后勤服务 | 后勤综合 | - | 后勤,洗衣 |
| YA-10 | 地下车库 | 地下停车 | 车位 | 地下车库 |

### 4.10 司法类 (SF)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| SF-01 | 审判 | 法庭、审判区 | - | 法庭,审判,审判楼 |
| SF-02 | 羁押 | 羁押室 | - | 羁押,羁押室 |
| SF-03 | 办公-审判 | 审判人员办公 | - | 审判办公 |
| SF-04 | 办公-行政 | 行政办公 | - | 行政,办公 |
| SF-05 | 监室 | 监房 | - | 监室,监房 |
| SF-06 | 管教 | 管教用房 | - | 管教,教育 |
| SF-07 | 收押 | 收押区 | - | 收押 |
| SF-08 | 武警营房 | 武警营区 | - | 武警,营房 |
| SF-09 | 生活服务 | 食堂、浴室 | - | 食堂,浴室,生活 |
| SF-10 | 档案 | 档案室 | - | 档案 |
| SF-11 | 地下车库 | 地下停车 | 车位 | 地下车库 |

### 4.11 交通类 (JT)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| JT-01 | 候车 | 候车大厅 | - | 候车,候车厅,候机 |
| JT-02 | 售票 | 售票厅 | - | 售票,票务 |
| JT-03 | 站务办公 | 站务管理 | - | 站务,管理 |
| JT-04 | 站场 | 发车场、站台 | - | 站场,站台,发车 |
| JT-05 | 停车-地面 | 地面停车场 | 车位 | 地面停车,停车场 |
| JT-06 | 停车-地下 | 地下停车库 | 车位 | 地下停车,地下车库 |
| JT-07 | 停车-立体 | 立体停车楼 | 车位 | 立体停车,停车楼 |
| JT-08 | 充电站 | 充电桩设施 | - | 充电,充电站 |
| JT-09 | 加油站 | 加油服务 | - | 加油站 |
| JT-10 | 维修车间 | 车辆维修 | - | 维修,车间 |
| JT-11 | 洗车场 | 车辆清洗 | - | 洗车 |

### 4.12 工业类 (GY)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| GY-01 | 生产-单层 | 单层生产厂房 | - | 单层厂房,单层 |
| GY-02 | 生产-多层 | 多层生产厂房 | - | 多层厂房,多层 |
| GY-03 | 生产-洁净 | 洁净厂房 | - | 洁净,无尘,净化 |
| GY-04 | 生产-防爆 | 防爆厂房 | - | 防爆 |
| GY-05 | 仓库-普通 | 普通仓库 | - | 仓库,普通仓库 |
| GY-06 | 仓库-恒温 | 恒温仓库 | - | 恒温,恒温恒湿 |
| GY-07 | 仓库-冷库 | 冷藏库 | - | 冷库,冷藏 |
| GY-08 | 仓库-危险品 | 危险品库 | - | 危险品,危化品 |
| GY-09 | 研发 | 研发用房 | - | 研发,研发中心 |
| GY-10 | 办公 | 综合办公楼 | - | 办公,综合楼 |
| GY-11 | 食堂 | 职工食堂 | - | 食堂 |
| GY-12 | 宿舍 | 职工宿舍 | 床位 | 宿舍,倒班 |
| GY-13 | 门卫 | 门卫室 | - | 门卫,门房 |
| GY-14 | 配电站 | 供电设施 | - | 配电,变电 |
| GY-15 | 消防泵房 | 消防设施 | - | 消防泵房,消防水池 |
| GY-16 | 污水处理 | 工业污水处理 | - | 污水处理 |

### 4.13 通用类 (TG)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| TG-01 | 地下车库 | 地下停车 | 车位 | 地下车库,地下停车 |
| TG-02 | 地下室-设备 | 设备层 | - | 设备层,设备用房 |
| TG-03 | 地下室-人防 | 人防工程 | - | 人防,防空 |
| TG-04 | 地下室-储藏 | 储藏空间 | - | 储藏,储物 |
| TG-05 | 配电房 | 配电设施 | - | 配电房,配电室 |
| TG-06 | 开闭所 | 高压配电 | - | 开闭所,高压 |
| TG-07 | 门卫室 | 门卫值班 | - | 门卫,门房,传达室 |
| TG-08 | 垃圾站 | 垃圾收集 | - | 垃圾站,垃圾房 |
| TG-09 | 公共厕所 | 室外厕所 | - | 公厕,厕所,卫生间 |
| TG-10 | 消防水池 | 消防水池及泵房 | - | 消防水池,消防泵房 |
| TG-11 | 连廊 | 建筑连接 | - | 连廊,廊道 |
| TG-12 | 雨棚 | 入口雨棚 | - | 雨棚,雨篷 |
| TG-13 | 围墙 | 院墙 | - | 围墙,院墙 |
| TG-14 | 大门 | 出入口大门 | - | 大门,门楼 |
| TG-15 | 旗台 | 升旗台 | - | 旗台,旗杆 |

### 4.14 室外/总平类 (SW)

| 编码 | 名称 | 说明 | 功能单位 | 关键字 |
|------|------|------|----------|--------|
| SW-01 | 道路-车行 | 场内车行道路 | - | 车行道,道路 |
| SW-02 | 道路-人行 | 人行道、广场铺装 | - | 人行道,广场,铺装 |
| SW-03 | 绿化-乔木 | 乔木种植 | - | 乔木,行道树 |
| SW-04 | 绿化-灌木 | 灌木、地被 | - | 灌木,地被 |
| SW-05 | 绿化-草坪 | 草坪 | - | 草坪,草皮 |
| SW-06 | 景观-水景 | 水景、喷泉 | - | 水景,喷泉,水池 |
| SW-07 | 景观-小品 | 景观小品、雕塑 | - | 景观小品,雕塑,花坛 |
| SW-08 | 管网-给水 | 室外给水管网 | - | 室外给水,给水管网 |
| SW-09 | 管网-雨水 | 室外雨水管网 | - | 室外雨水,雨水管网 |
| SW-10 | 管网-污水 | 室外污水管网 | - | 室外污水,污水管网 |
| SW-11 | 管网-电力 | 室外电力管线 | - | 室外电力,电力管线 |
| SW-12 | 管网-弱电 | 室外弱电管线 | - | 室外弱电,弱电管线 |
| SW-13 | 管网-燃气 | 室外燃气管线 | - | 室外燃气,燃气管线 |
| SW-14 | 照明 | 室外照明 | - | 室外照明,路灯,庭院灯 |
| SW-15 | 监控 | 室外安防监控 | - | 室外监控,安防 |

---

## 5. UI组件规范

### 5.1 标签选择器 (TagSelector)

#### 5.1.1 组件描述
用于在标签化处理时选择功能标签的下拉选择器。

#### 5.1.2 组件属性

```typescript
interface TagSelectorProps {
  value?: string;                // 当前选中的标签ID
  onChange?: (tagId: string, tag: FunctionTag) => void; // 选中回调
  categoryFilter?: string[];     // 限制可选的大类
  placeholder?: string;          // 占位文本
  disabled?: boolean;            // 是否禁用
  showSearch?: boolean;          // 是否显示搜索框，默认true
  showCategory?: boolean;        // 是否显示大类分组，默认true
  size?: 'small' | 'middle' | 'large'; // 尺寸
  style?: React.CSSProperties;   // 自定义样式
}
```

#### 5.1.3 交互行为

1. **展开下拉**：点击选择器展开下拉面板
2. **搜索过滤**：输入关键字实时过滤标签列表
3. **分类展示**：按大类分组显示，可折叠展开
4. **选中反馈**：选中后显示完整标签名（大类-标签名）
5. **快捷清除**：支持清除已选标签

#### 5.1.4 视觉规范

```
┌─────────────────────────────────────┐
│ 🔍 搜索功能标签...                    │
├─────────────────────────────────────┤
│ ▼ 医疗卫生                           │
│   ○ 门诊                             │
│   ○ 急诊                             │
│   ○ 住院-普通                         │
│   ○ 住院-重症                         │
│   ...                               │
├─────────────────────────────────────┤
│ ▶ 教育                              │
├─────────────────────────────────────┤
│ ▶ 办公                              │
└─────────────────────────────────────┘
```

### 5.2 标签徽章 (TagBadge)

#### 5.2.1 组件描述
用于显示已选中标签的徽章组件。

#### 5.2.2 组件属性

```typescript
interface TagBadgeProps {
  tag: FunctionTag;              // 标签数据
  closable?: boolean;            // 是否可关闭
  onClose?: () => void;          // 关闭回调
  size?: 'small' | 'middle';     // 尺寸
  showCategory?: boolean;        // 是否显示大类前缀
}
```

#### 5.2.3 视觉规范

- 背景色：使用标签大类的主题色（浅色）
- 文字色：使用标签大类的主题色（深色）
- 圆角：4px
- 内边距：4px 8px

```
┌────────────────┐
│ 医疗卫生-门诊 ✕ │
└────────────────┘
```

### 5.3 智能推荐提示 (TagRecommendation)

#### 5.3.1 组件描述
根据单体名称智能推荐可能的功能标签。

#### 5.3.2 组件属性

```typescript
interface TagRecommendationProps {
  keyword: string;               // 输入的关键字（单体名称）
  onSelect?: (tag: FunctionTag) => void; // 选中推荐标签回调
  maxCount?: number;             // 最多显示推荐数量，默认5
}
```

#### 5.3.3 视觉规范

```
💡 推荐标签：
┌─────────────────────────────────────┐
│ 门诊 (98%置信度)              [使用] │
│ 医技 (65%置信度)              [使用] │
└─────────────────────────────────────┘
```

---

## 6. API接口

### 6.1 获取标签大类列表

```
GET /api/v1/tags/categories
```

**响应示例：**
```json
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "id": "cat-001",
      "code": "YI",
      "name": "医疗卫生",
      "description": "各类医疗机构的功能单元",
      "icon": "medicine",
      "color": "#1890FF",
      "sortOrder": 1,
      "status": "active",
      "tagCount": 30
    }
  ]
}
```

### 6.2 获取功能标签列表

```
GET /api/v1/tags
```

**请求参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| categoryCode | string | 否 | 按大类筛选 |
| keyword | string | 否 | 关键字搜索 |
| status | string | 否 | 状态筛选 |
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认50 |

**响应示例：**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "total": 239,
    "list": [
      {
        "id": "tag-001",
        "categoryId": "cat-001",
        "categoryCode": "YI",
        "code": "YI-01",
        "name": "门诊",
        "fullName": "医疗卫生-门诊",
        "description": "普通门诊、专家门诊",
        "defaultSpaces": ["DS", "DX"],
        "defaultUnit": "m²",
        "functionalUnit": null,
        "keywords": ["门诊", "门诊楼", "门诊部"],
        "sortOrder": 1,
        "status": "active"
      }
    ]
  }
}
```

### 6.3 获取单个标签详情

```
GET /api/v1/tags/{tagId}
```

### 6.4 智能推荐标签

```
GET /api/v1/tags/recommend
```

**请求参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| keyword | string | 是 | 单体名称关键字 |
| maxCount | number | 否 | 最大返回数量，默认5 |

**响应示例：**
```json
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "tagId": "tag-001",
      "tagCode": "YI-01",
      "tagName": "门诊",
      "categoryName": "医疗卫生",
      "confidence": 0.98,
      "matchedKeyword": "门诊",
      "matchType": "contains"
    },
    {
      "tagId": "tag-008",
      "tagCode": "YI-08",
      "tagName": "医技",
      "categoryName": "医疗卫生",
      "confidence": 0.65,
      "matchedKeyword": "医技",
      "matchType": "contains"
    }
  ]
}
```

### 6.5 创建功能标签（管理员）

```
POST /api/v1/tags
```

**请求体：**
```json
{
  "categoryId": "cat-001",
  "code": "YI-31",
  "name": "新增标签",
  "description": "标签说明",
  "defaultSpaces": ["DS"],
  "defaultUnit": "m²",
  "keywords": ["关键字1", "关键字2"]
}
```

### 6.6 更新功能标签（管理员）

```
PUT /api/v1/tags/{tagId}
```

### 6.7 停用/启用标签（管理员）

```
PUT /api/v1/tags/{tagId}/status
```

**请求体：**
```json
{
  "status": "inactive"
}
```

---

## 7. 业务规则

### 7.1 标签编码规则

- 格式：`{大类编码}-{序号}`
- 大类编码：2位大写字母
- 序号：2位数字，从01开始
- 示例：YI-01, JY-15, TG-07

### 7.2 智能匹配规则

1. **精确匹配**优先级最高
2. **包含匹配**次之
3. 多个匹配结果按**置信度**降序排列
4. 置信度相同时按**优先级**排序

### 7.3 标签使用规则

1. 一个单体只能关联**一个**主要功能标签
2. 特殊情况下可关联多个标签（如"门诊医技综合楼"可同时关联门诊和医技）
3. 室外工程统一使用**SW**类标签
4. 找不到精确匹配时使用**TG**通用类标签

### 7.4 标签维护规则

1. 标签新增需经过审核
2. 标签停用不影响历史数据
3. 标签编码一经分配不可修改
4. 标签名称修改需记录变更历史

---

## 8. 初始化数据

系统初始化时需导入以下标签数据：
- 14个标签大类
- 239个功能标签
- 约500条映射规则

数据文件位置：`/data/init/tags.json`

---

## 9. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-17 | 初版 | - |

## V1.1 补丁章节（Patch Addendum）

> **适用文档**：功能标签体系规范 (Tag System Spec) V1.0
> **目标**：补齐“单体绑定落库、通用功能唯一归属、规则适用范围（scope）、推荐冲突处理”四个关键缺口
> **版本**：V1.1（Patch）
> **日期**：2026-01-17

---

# 10. V1.1 补丁：单体绑定、通用归属、规则 Scope、冲突处理

## 10.1 新增：单体-功能标签绑定表（building_function_tag_binding）

> 说明：实现“一单体一主标签 + 可选辅标签 + 可分摊 + 可追溯 + 防止自动覆盖”。

### 10.1.1 数据模型

```typescript
interface BuildingFunctionTagBinding {
  id: string;                     // UUID
  buildingId: string;             // 单体ID（来自项目/单体库）
  tagId: string;                  // 功能标签ID
  tagCode: string;                // 冗余：功能标签编码
  role: 'PRIMARY' | 'SECONDARY';  // 主/辅
  weight: number;                 // 权重 0-1（综合楼/分摊场景），默认：PRIMARY=1，SECONDARY=0
  source: 'AUTO' | 'MANUAL';      // 来源：自动推荐/人工确认
  locked: boolean;                // 锁定：true 表示后续自动规则不得覆盖
  confidence?: number;            // 自动推荐置信度（MANUAL 可为空）
  matchedRuleId?: string;         // 命中的规则ID（AUTO时必填）
  matchedKeyword?: string;        // 命中的关键词（AUTO时必填）
  snapshotVersion: number;        // 绑定时的标签版本快照（function_tag.version）
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}
```

### 10.1.2 业务约束（MUST）

1. **主标签唯一**：同一 `buildingId` 必须且只能存在 1 条 `role=PRIMARY` 且 `status=active` 的绑定记录。
2. **辅标签可选**：允许 0..N 条 `role=SECONDARY`。
3. **锁定优先**：`locked=true` 的绑定记录不可被自动推荐结果覆盖；自动推荐只能新增“候选”，不得直接写入绑定表。
4. **权重策略**（默认建议）

   * 默认：`PRIMARY.weight = 1`；`SECONDARY.weight = 0`
   * 当用户启用“综合楼分摊模式”时：允许 SECONDARY 输入权重，且需要满足 10.4 的归一化规则。
5. **版本快照**：绑定记录必须写入 `snapshotVersion=function_tag.version`，确保历史口径可追溯。

> 注：若你已有“单体表 building”，这里不重复定义外键，仅在数据库层保证 `buildingId` 引用一致即可。

---

## 10.2 新增：通用功能唯一归属原则（TG / SW 归属策略）

> 说明：解决“车库/设备层/配电/垃圾站”等在多个大类重复定义导致的推荐冲突与指标不可比问题。

### 10.2.1 原则（MUST）

1. **跨行业通用功能单元，统一归入 TG**

   * 例如：地下车库、人防、设备层、配电房、开闭所、门卫室、垃圾站、连廊、消防水池/泵房、围墙/大门等。
2. **室外/总平类功能，统一归入 SW**

   * 例如：道路铺装、绿化、水景、室外管网、电力/弱电/燃气管线、照明、监控等。
3. **行业大类（YI/JY/BG/…）仅保留“行业特有功能单元”**

   * 医疗：门诊、医技、手术中心、血透、高压氧、感染负压…
   * 教育：教学、实验、实训、图书馆、院系楼…
   * 酒店：客房、大堂、会议中心、后勤洗衣…

### 10.2.2 兼容处理（SHOULD）

为兼容旧数据或既有习惯，允许在行业大类中保留“展示别名”，但**不得新增重复编码**：

* 行业大类中的“地下车库/配电房”等如需展示，应以 **Alias 映射**指向 TG 对应标签（见 10.3.3）。

---

## 10.3 变更：映射规则表新增 Scope 与排除规则（tag_mapping_rule）

> 说明：让推荐规则更可控，避免“关键词一碰就误标”。

### 10.3.1 新增字段（MUST）

在 `TagMappingRule` 中新增：

```typescript
interface TagMappingRule {
  id: string;
  tagId: string;
  tagCode: string;

  keyword: string;
  matchType: 'exact' | 'contains' | 'startsWith' | 'endsWith' | 'regex';
  caseSensitive: boolean;

  // NEW: 规则适用范围
  scope: 'BUILDING_NAME' | 'DOC_TEXT' | 'ROOM_NAME' | 'BOQ_ITEM' | 'MATERIAL' | 'ANY';

  // NEW: 排除与过滤
  negativeKeywords?: string[];     // 命中任一排除词 -> 该规则失效
  categoryFilter?: string[];       // 限制仅在某些大类下生效（如仅YI/JY），可为空
  projectTypeFilter?: string[];    // 限制适用项目类型，可为空

  confidence: number;             // 0-1
  priority: number;               // 数值越大优先
  status: 'active' | 'inactive';
  createdAt: Date;
  updatedAt: Date;
}
```

### 10.3.2 Scope 解释（建议默认策略）

* `BUILDING_NAME`：单体名称（如“门诊医技综合楼”）
* `DOC_TEXT`：设计说明/方案文本
* `ROOM_NAME`：房间/功能用房名称（BIM/房间表）
* `BOQ_ITEM`：清单项名称/特征（用于反推功能）
* `MATERIAL`：材料/设备名称（用于反推功能）
* `ANY`：不限制来源字段

### 10.3.3 新增：别名映射（可选但强烈建议）

若采用 10.2.2 的“展示别名”，建议新增 `tag_alias`（或在 rules 中用特殊规则实现）：

```typescript
interface TagAlias {
  id: string;
  aliasName: string;            // 别名，如 "医疗-地下车库"
  aliasKeyword: string;         // 触发词，如 "地下车库"
  targetTagId: string;          // 指向 TG-01
  targetTagCode: string;        // TG-01
  scope: 'BUILDING_NAME' | 'DOC_TEXT' | 'ROOM_NAME' | 'ANY';
  priority: number;
  status: 'active' | 'inactive';
  createdAt: Date;
  updatedAt: Date;
}
```

> 规则执行时：Alias 命中应直接转换为 targetTag。

---

## 10.4 新增：推荐冲突处理规则（Conflict Resolution）

> 说明：定义“多规则命中、多标签候选、主/辅选择、以及 TG/SW 优先归属”的统一裁决逻辑。

### 10.4.1 推荐输出结构（MUST）

`/api/v1/tags/recommend` 返回建议统一为：

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "keyword": "门诊医技综合楼",
    "candidates": [
      {
        "tagId": "tag-001",
        "tagCode": "YI-01",
        "tagName": "门诊",
        "categoryCode": "YI",
        "categoryName": "医疗卫生",
        "confidence": 0.98,
        "priority": 100,
        "matchedRuleId": "rule-101",
        "matchedKeyword": "门诊",
        "scope": "BUILDING_NAME",
        "reason": "contains + rule-101"
      }
    ],
    "conflicts": [
      {
        "dimension": "FUNCTION",
        "type": "MULTI_HIT",
        "message": "命中多个候选标签，需要人工确认主/辅"
      }
    ]
  }
}
```

### 10.4.2 冲突类型定义（MUST）

* `MULTI_HIT`：同一输入命中多个候选标签
* `DUPLICATE_SEMANTIC`：语义重复（例如“地下车库”同时命中 TG 与行业大类重复项）
* `LOW_CONFIDENCE`：最高置信度仍低于阈值
* `SCOPE_MISMATCH`：规则 scope 与输入来源字段不匹配（一般不返回，仅记录日志）

### 10.4.3 排序与裁决（MUST）

对候选标签进行排序与裁决：

1. **先过滤**：`status=inactive`、命中 `negativeKeywords` 的规则全部剔除
2. **再排序**：按 `confidence DESC`，若相同按 `priority DESC`
3. **再裁决**：

   * 若 Top1 `confidence >= 0.85` 且 Top1 与 Top2 差值 ≥ 0.15 → **自动建议为 PRIMARY**
   * 若命中多个且差距不明显 → 返回 `MULTI_HIT`，要求人工选择 PRIMARY/SECONDARY
4. **TG/SW 归属优先**（强制规则）：

   * 若候选集中存在 TG 或 SW 且语义与其他候选重复（如“地下车库”）→ **保留 TG/SW，剔除其他重复语义候选**，并记录 `DUPLICATE_SEMANTIC`

> 推荐接口只“推荐”，不直接落库；落库必须走绑定表的“人工确认/锁定”流程（10.1.2）。

### 10.4.4 绑定写入规则（MUST）

当用户在 UI 点击“使用”：

* 写入 `building_function_tag_binding`
* `source` 根据推荐来源写 `AUTO`，并写入 `matchedRuleId / matchedKeyword / confidence`
* 默认 `locked=false`，用户点“锁定”后才置 `true`

### 10.4.5 综合楼分摊（可选启用）（SHOULD）

当用户勾选“综合楼分摊模式”时：

* 允许选择 1 个 PRIMARY + 多个 SECONDARY
* 启用权重输入，且需满足以下任一策略（平台配置项二选一）：

**策略 A：归一模式（推荐）**

* 要求：`PRIMARY.weight + Σ(SECONDARY.weight) = 1`

**策略 B：非归一模式**

* 要求：`PRIMARY.weight + Σ(SECONDARY.weight) ≤ 1`
* 剩余权重视为“未分配”，质控模块可提示“存在未分配权重”。

---

## 10.5 变更：空间编码 defaultSpaces 的来源声明（补充说明）

> 说明：你在 `function_tag.defaultSpaces` 使用了空间编码（如 DS/DX），需声明来源。

### 10.5.1 规则（MUST）

* `defaultSpaces` 的编码必须来自 **空间标签字典（13_Tag_System / SPACE 维度）**
* 平台必须提供空间编码枚举或接口（例如：`GET /api/v1/tags/spaces` 或复用通用标签接口按 dimension 过滤）

---

# 11. V1.1 Changelog（Patch）

| 版本   | 日期         | 修订内容                                                                                                                                          |
| ---- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| V1.1 | 2026-01-17 | 新增单体绑定表 building_function_tag_binding；新增 TG/SW 通用功能唯一归属原则；tag_mapping_rule 增加 scope/negativeKeywords/filter；补充推荐冲突处理与分摊策略；声明 defaultSpaces 来源 |

---

如果你接下来准备写《14_Index_Calculation_Spec》，我建议它直接引用本补丁里的两条“硬依赖”：

* **单体功能标签绑定表（主/辅/权重/版本快照）**
* **TG/SW 唯一归属原则（保证指标可比）**
