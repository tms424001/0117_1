# 企业指标库功能规格说明书

> 文档编号：04-DA-002  
> 版本：V1.0  
> 创建日期：2026-01-18  
> 所属模块：04_Data_Asset / 企业库

---

## 1. 功能概述

### 1.1 功能定位

企业指标库是企业数据资产的核心组成部分，汇聚经过标准化处理和审核的造价指标数据，为估算、质控等应用模块提供高质量的指标参考和对标基准。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          企业指标库定位                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────┐        ┌─────────────┐        ┌─────────────┐        │
│   │   我的指标   │  ──▶  │   PR审核    │  ──▶  │  企业指标库  │        │
│   │  (个人数据)  │       │  (质量把关)  │       │  (企业资产)  │        │
│   └─────────────┘        └─────────────┘        └──────┬──────┘        │
│                                                        │               │
│                          ┌─────────────────────────────┼───────┐       │
│                          │                             │       │       │
│                          ▼                             ▼       ▼       │
│                   ┌───────────┐              ┌──────────┐ ┌──────────┐ │
│                   │  估算模块  │              │ 质控模块 │ │ 指标发布 │ │
│                   │ (指标推荐) │              │(对标基准)│ │(版本管理)│ │
│                   └───────────┘              └──────────┘ └──────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 指标体系概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          指标体系三层结构                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     经济指标 (Economic)                          │   │
│  │  ────────────────────────────────────────────────────────────── │   │
│  │  • 综合单方造价（元/㎡）    • 土建单方造价（元/㎡）              │   │
│  │  • 安装单方造价（元/㎡）    • 装饰单方造价（元/㎡）              │   │
│  │  • 人工费占比（%）          • 材料费占比（%）                    │   │
│  │  • 机械费占比（%）          • 管理费占比（%）                    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     工程量指标 (Quantity)                        │   │
│  │  ────────────────────────────────────────────────────────────── │   │
│  │  • 钢筋含量（kg/㎡）        • 混凝土含量（m³/㎡）                │   │
│  │  • 模板含量（㎡/㎡）        • 砌体含量（m³/㎡）                  │   │
│  │  • 外墙面积比（㎡/㎡）      • 门窗面积比（㎡/㎡）                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     人材机指标 (Resource)                        │   │
│  │  ────────────────────────────────────────────────────────────── │   │
│  │  • 人工工日（工日/㎡）      • 主材用量（元/㎡）                  │   │
│  │  • 钢材用量（kg/㎡）        • 水泥用量（kg/㎡）                  │   │
│  │  • 商混用量（m³/㎡）        • 机械台班（台班/㎡）                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 核心价值

| 维度 | 说明 |
|------|------|
| **指标沉淀** | 将项目级指标汇聚为企业级指标资产，形成指标基准库 |
| **多维聚合** | 按功能标签、规模档、地区、时间等维度聚合统计 |
| **估算支撑** | 为指标匡算、详细估算提供指标参考值 |
| **质控基准** | 为造价审核提供对标基准，识别异常偏差 |
| **趋势分析** | 追踪指标变化趋势，洞察行业动态 |

### 1.4 与上下游关系

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            数据流向                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  上游：我的指标                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  • 项目级指标（单个项目的各类指标）                               │   │
│  │  • 单位工程级指标（单位工程维度的指标）                           │   │
│  │  • 三类指标（经济指标/工程量指标/人材机指标）                     │   │
│  │  • 标签关联（功能标签/规模档/地区等维度标签）                     │   │
│  │  • PR补录信息（指标来源/计算方法/质量标识等）                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼ PR审核通过                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        企业指标库                                 │   │
│  │  • 指标管理：查询、筛选、导出                                     │   │
│  │  • 指标聚合：多维度统计聚合                                       │   │
│  │  • 指标分析：趋势分析、对比分析、分布分析                         │   │
│  │  • 指标发布：版本管理、发布策略                                   │   │
│  │  • 数据维护：状态管理、异常处理                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼ 数据消费                           │
│  下游：应用模块                                                          │
│  ┌───────────────┬───────────────┬───────────────┬─────────────────┐   │
│  │    估算模块    │    质控模块    │    指标发布    │    报告输出     │   │
│  │  • 指标推荐   │  • 对标基准   │  • 版本发布   │  • 指标报告    │   │
│  │  • 区间参考   │  • 偏差检测   │  • 订阅推送   │  • 趋势报告    │   │
│  └───────────────┴───────────────┴───────────────┴─────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 功能架构

### 2.1 菜单结构

```
数据资产
├── 企业库
│   ├── 案例库
│   ├── 材价库
│   ├── 综价库
│   └── 指标库        ← 本文档
└── 数据商城
    ├── 信息价
    ├── 公共资源案例库
    └── 会员单位数据
```

### 2.2 功能模块

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          企业指标库功能架构                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        指标管理（主界面）                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  筛选区：指标类别 | 功能标签 | 规模档 | 地区 | 时间 | 状态       │   │
│  │  视图切换：[列表视图] [聚合视图] [矩阵视图]                       │   │
│  │  操作区：查看详情 | 趋势分析 | 导出 | 发布                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        指标聚合（聚合页）                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  聚合维度：功能标签 × 规模档 × 地区 × 时间                       │   │
│  │  聚合统计：样本数 | 均值 | 中位数 | 标准差 | 置信区间            │   │
│  │  结果展示：指标矩阵 | 统计卡片 | 分布图表                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        指标分析（分析页）                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  趋势分析：时间序列 | 季度/年度对比 | 增长率                     │   │
│  │  对比分析：跨地区对比 | 跨功能对比 | 跨规模对比                  │   │
│  │  分布分析：指标分布 | 异常识别 | 分位统计                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        指标发布（发布页）                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  版本管理：版本号 | 发布状态 | 生效时间                          │   │
│  │  发布策略：全量发布 | 增量发布 | 定向发布                        │   │
│  │  发布审核：审核流程 | 发布记录                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        数据维护（管理页）                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  状态管理：启用/停用 | 标记异常 | 删除                           │   │
│  │  数据修订：指标修正 | 重新计算 | 版本管理                        │   │
│  │  异常处理：异常审核 | 批量处理 | 归档                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 数据模型

### 3.1 核心实体关系

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          指标库数据模型                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │              index_definition（指标定义表-元数据）              │     │
│  ├───────────────────────────────────────────────────────────────┤     │
│  │  PK: definition_id                                            │     │
│  │  指标定义：编码 + 名称 + 类别 + 单位 + 计算公式                  │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                    │                                    │
│                                    ▼                                    │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │              enterprise_index（企业指标主表-原始指标）          │     │
│  ├───────────────────────────────────────────────────────────────┤     │
│  │  PK: index_id                                                 │     │
│  │  FK: source_my_index_id → my_index.index_id                   │     │
│  │  FK: source_case_id → enterprise_case.case_id                 │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                    │                                    │
│                                    │ 聚合计算                           │
│                                    ▼                                    │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │              index_aggregate（指标聚合表-统计指标）             │     │
│  ├───────────────────────────────────────────────────────────────┤     │
│  │  PK: aggregate_id                                             │     │
│  │  聚合键：功能标签 + 规模档 + 地区 + 时间段                      │     │
│  │  统计值：样本数 + 均值 + 中位数 + 标准差 + 置信区间              │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                    │                                    │
│                                    │ 版本发布                           │
│                                    ▼                                    │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │              index_publish（指标发布表-发布版本）               │     │
│  ├───────────────────────────────────────────────────────────────┤     │
│  │  PK: publish_id                                               │     │
│  │  FK: aggregate_id → index_aggregate.aggregate_id              │     │
│  │  版本信息：版本号 + 发布状态 + 生效时间                         │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 指标定义表：index_definition

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|:----:|------|
| definition_id | VARCHAR(32) | ✓ | 定义ID，主键 |
| index_code | VARCHAR(50) | ✓ | 指标编码，唯一 |
| index_name | VARCHAR(100) | ✓ | 指标名称 |
| index_category | VARCHAR(20) | ✓ | 指标类别：economic/quantity/resource |
| index_unit | VARCHAR(20) | ✓ | 指标单位 |
| reference_base | VARCHAR(20) | ✓ | 参考基准：area/volume/length/count |
| calculation_formula | VARCHAR(500) |  | 计算公式 |
| description | VARCHAR(500) |  | 指标说明 |
| value_type | VARCHAR(20) | ✓ | 值类型：decimal/percentage/integer |
| precision | INTEGER | ✓ | 小数精度，默认2 |
| min_value | DECIMAL(18,4) |  | 合理最小值 |
| max_value | DECIMAL(18,4) |  | 合理最大值 |
| warning_threshold | DECIMAL(5,2) |  | 预警阈值（偏离均值百分比） |
| sort_order | INTEGER | ✓ | 显示顺序 |
| is_core | BOOLEAN | ✓ | 是否核心指标，默认false |
| status | VARCHAR(20) | ✓ | 状态：active/inactive |
| created_at | TIMESTAMP | ✓ | 创建时间 |
| updated_at | TIMESTAMP | ✓ | 更新时间 |

**核心指标清单：**

| 类别 | 指标编码 | 指标名称 | 单位 | 参考基准 | 是否核心 |
|------|----------|----------|------|----------|:--------:|
| economic | IDX-EC-001 | 综合单方造价 | 元/㎡ | area | ✓ |
| economic | IDX-EC-002 | 土建单方造价 | 元/㎡ | area | ✓ |
| economic | IDX-EC-003 | 安装单方造价 | 元/㎡ | area | ✓ |
| economic | IDX-EC-004 | 装饰单方造价 | 元/㎡ | area |  |
| economic | IDX-EC-005 | 人工费占比 | % | - | ✓ |
| economic | IDX-EC-006 | 材料费占比 | % | - | ✓ |
| economic | IDX-EC-007 | 机械费占比 | % | - |  |
| quantity | IDX-QT-001 | 钢筋含量 | kg/㎡ | area | ✓ |
| quantity | IDX-QT-002 | 混凝土含量 | m³/㎡ | area | ✓ |
| quantity | IDX-QT-003 | 模板含量 | ㎡/㎡ | area |  |
| quantity | IDX-QT-004 | 砌体含量 | m³/㎡ | area |  |
| quantity | IDX-QT-005 | 外墙面积比 | ㎡/㎡ | area |  |
| quantity | IDX-QT-006 | 门窗面积比 | ㎡/㎡ | area |  |
| resource | IDX-RS-001 | 人工工日 | 工日/㎡ | area |  |
| resource | IDX-RS-002 | 钢材用量 | kg/㎡ | area |  |
| resource | IDX-RS-003 | 水泥用量 | kg/㎡ | area |  |
| resource | IDX-RS-004 | 商混用量 | m³/㎡ | area |  |

### 3.3 企业指标主表：enterprise_index

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|:----:|------|
| index_id | VARCHAR(32) | ✓ | 指标ID，主键，格式：EI + 年月 + 序号 |
| source_my_index_id | VARCHAR(32) | ✓ | 来源我的指标ID |
| source_case_id | VARCHAR(32) |  | 关联案例ID（如有） |
| pr_record_id | VARCHAR(32) | ✓ | PR审核记录ID |
| **指标定义关联** ||||
| index_code | VARCHAR(50) | ✓ | 指标编码，关联index_definition |
| index_name | VARCHAR(100) | ✓ | 指标名称 |
| index_category | VARCHAR(20) | ✓ | 指标类别 |
| **指标值** ||||
| index_value | DECIMAL(18,4) | ✓ | 指标值 |
| index_unit | VARCHAR(20) | ✓ | 指标单位 |
| **维度标签** ||||
| function_category | VARCHAR(50) | ✓ | 功能大类 |
| function_subcategory | VARCHAR(50) | ✓ | 功能中类 |
| function_tag | VARCHAR(50) | ✓ | 功能标签 |
| function_tag_code | VARCHAR(20) | ✓ | 功能标签编码 |
| scale_type | VARCHAR(20) | ✓ | 规模类型 |
| scale_level | VARCHAR(20) | ✓ | 规模档 |
| scale_level_code | VARCHAR(10) | ✓ | 规模档编码 |
| province_code | VARCHAR(10) | ✓ | 省份编码 |
| city_code | VARCHAR(10) | ✓ | 城市编码 |
| **时间维度** ||||
| pricing_stage | VARCHAR(20) | ✓ | 计价阶段 |
| pricing_date | DATE | ✓ | 计价基准日 |
| price_period | VARCHAR(20) | ✓ | 材价期 |
| data_year | INTEGER | ✓ | 数据年份 |
| data_quarter | INTEGER | ✓ | 数据季度（1-4） |
| **来源信息** ||||
| project_name | VARCHAR(200) |  | 项目名称 |
| building_area | DECIMAL(18,2) |  | 建筑面积 |
| structure_type | VARCHAR(50) |  | 结构类型 |
| **质量标识** ||||
| quality_flag | VARCHAR(20) | ✓ | 质量标识：normal/warning/error/excluded |
| deviation_ratio | DECIMAL(5,2) |  | 偏离度（与同类均值比较） |
| is_outlier | BOOLEAN | ✓ | 是否异常值，默认false |
| outlier_reason | VARCHAR(200) |  | 异常原因 |
| **状态管理** ||||
| status | VARCHAR(20) | ✓ | 状态：active/inactive/deleted |
| publish_time | TIMESTAMP | ✓ | 入库时间 |
| **审计字段** ||||
| created_at | TIMESTAMP | ✓ | 创建时间 |
| created_by | VARCHAR(32) | ✓ | 创建人 |
| updated_at | TIMESTAMP | ✓ | 更新时间 |
| updated_by | VARCHAR(32) | ✓ | 更新人 |

### 3.4 指标聚合表：index_aggregate

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|:----:|------|
| aggregate_id | VARCHAR(32) | ✓ | 聚合ID，主键 |
| **指标定义** ||||
| index_code | VARCHAR(50) | ✓ | 指标编码 |
| index_name | VARCHAR(100) | ✓ | 指标名称 |
| index_category | VARCHAR(20) | ✓ | 指标类别 |
| index_unit | VARCHAR(20) | ✓ | 指标单位 |
| **聚合维度** ||||
| function_tag_code | VARCHAR(20) | ✓ | 功能标签编码（聚合键） |
| function_tag | VARCHAR(50) | ✓ | 功能标签名称 |
| scale_level_code | VARCHAR(10) | ✓ | 规模档编码（聚合键） |
| scale_level | VARCHAR(20) | ✓ | 规模档名称 |
| province_code | VARCHAR(10) |  | 省份编码（聚合键，可为空表示全国） |
| province_name | VARCHAR(50) |  | 省份名称 |
| data_year | INTEGER | ✓ | 数据年份（聚合键） |
| data_quarter | INTEGER |  | 数据季度（聚合键，可为空表示全年） |
| **统计值** ||||
| sample_count | INTEGER | ✓ | 样本数量 |
| avg_value | DECIMAL(18,4) | ✓ | 平均值 |
| median_value | DECIMAL(18,4) | ✓ | 中位数 |
| std_deviation | DECIMAL(18,4) |  | 标准差 |
| min_value | DECIMAL(18,4) | ✓ | 最小值 |
| max_value | DECIMAL(18,4) | ✓ | 最大值 |
| percentile_25 | DECIMAL(18,4) |  | 25分位数 |
| percentile_75 | DECIMAL(18,4) |  | 75分位数 |
| confidence_lower | DECIMAL(18,4) |  | 95%置信区间下限 |
| confidence_upper | DECIMAL(18,4) |  | 95%置信区间上限 |
| **推荐值** ||||
| recommend_value | DECIMAL(18,4) | ✓ | 推荐值（默认取中位数） |
| recommend_range_low | DECIMAL(18,4) | ✓ | 推荐区间下限 |
| recommend_range_high | DECIMAL(18,4) | ✓ | 推荐区间上限 |
| **质量评估** ||||
| data_quality_score | DECIMAL(5,2) |  | 数据质量评分 |
| reliability_level | VARCHAR(10) | ✓ | 可靠性等级：high/medium/low |
| **状态管理** ||||
| status | VARCHAR(20) | ✓ | 状态：active/inactive |
| last_calculate_time | TIMESTAMP | ✓ | 最后计算时间 |
| created_at | TIMESTAMP | ✓ | 创建时间 |
| updated_at | TIMESTAMP | ✓ | 更新时间 |

**可靠性等级说明：**

| 等级 | 条件 | 说明 |
|------|------|------|
| high | 样本数≥10，标准差/均值≤20% | 高可靠，可直接使用 |
| medium | 样本数≥5，标准差/均值≤30% | 中等可靠，建议参考 |
| low | 样本数<5 或 标准差/均值>30% | 低可靠，仅供参考 |

### 3.5 指标发布表：index_publish

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|:----:|------|
| publish_id | VARCHAR(32) | ✓ | 发布ID，主键 |
| version_code | VARCHAR(20) | ✓ | 版本号，格式：YYYY.Q.N |
| version_name | VARCHAR(100) | ✓ | 版本名称 |
| **发布范围** ||||
| publish_scope | VARCHAR(20) | ✓ | 发布范围：all/category/custom |
| scope_config | JSONB |  | 范围配置 |
| **统计信息** ||||
| total_indexes | INTEGER | ✓ | 指标总数 |
| new_indexes | INTEGER |  | 新增指标数 |
| updated_indexes | INTEGER |  | 更新指标数 |
| **发布状态** ||||
| status | VARCHAR(20) | ✓ | 状态：draft/pending/approved/published/archived |
| effective_time | TIMESTAMP |  | 生效时间 |
| expire_time | TIMESTAMP |  | 失效时间 |
| **审核信息** ||||
| submitted_by | VARCHAR(32) |  | 提交人 |
| submitted_at | TIMESTAMP |  | 提交时间 |
| approved_by | VARCHAR(32) |  | 审核人 |
| approved_at | TIMESTAMP |  | 审核时间 |
| approve_comment | VARCHAR(500) |  | 审核意见 |
| **发布信息** ||||
| published_by | VARCHAR(32) |  | 发布人 |
| published_at | TIMESTAMP |  | 发布时间 |
| release_notes | TEXT |  | 发布说明 |
| created_at | TIMESTAMP | ✓ | 创建时间 |
| updated_at | TIMESTAMP | ✓ | 更新时间 |

---

## 4. 界面设计

### 4.1 指标管理主界面（列表视图）

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 数据资产 > 企业库 > 指标库                                   🔔 👤  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  📋 筛选条件                                          [重置] [收起] │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │                                                                 │   │
│  │  指标类别    [☑经济指标 ☑工程量指标 □人材机指标]                  │   │
│  │                                                                 │   │
│  │  功能标签    [办公建筑        ▼]    规模档      [5000-10000㎡ ▼]    │
│  │                                                                 │   │
│  │  省份       [广东省          ▼]    数据年份    [2025年       ▼]    │
│  │                                                                 │   │
│  │  计价阶段   [□概算 ☑预算 ☑结算 □决算]      质量标识 [☑正常 □异常] │   │
│  │                                                                 │   │
│  │                                    [🔍 查询]  [📊 聚合]  [📥 导出] │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  视图切换：[● 列表视图] [○ 聚合视图] [○ 矩阵视图]                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  统计概览                                                        │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │ 指标总数 │ │ 本季新增 │ │ 经济指标 │ │ 工程量  │ │ 人材机  │   │   │
│  │  │ 28,560  │ │  1,286  │ │ 12,450  │ │ 10,280  │ │  5,830  │   │   │
│  │  │         │ │  ↑12%   │ │  43.6%  │ │  36.0%  │ │  20.4%  │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  原始指标列表                                                    │   │
│  ├────────┬──────────┬────────┬────────┬────────┬────────┬────────┤   │
│  │ 指标名称│ 指标值    │ 功能标签│ 规模档  │ 地区    │ 数据期  │ 质量  │   │
│  ├────────┼──────────┼────────┼────────┼────────┼────────┼────────┤   │
│  │综合单方 │ 4,200    │ 办公建筑│ 5K-1W  │ 广东深圳│ 2025Q2 │ ● 正常│   │
│  │ 元/㎡  │ ↑8.2%    │        │        │        │        │       │   │
│  ├────────┼──────────┼────────┼────────┼────────┼────────┼────────┤   │
│  │钢筋含量 │ 58.6     │ 办公建筑│ 5K-1W  │ 广东深圳│ 2025Q2 │ ● 正常│   │
│  │ kg/㎡  │ ↑6.5%    │        │        │        │        │       │   │
│  ├────────┼──────────┼────────┼────────┼────────┼────────┼────────┤   │
│  │混凝土量 │ 0.42     │ 办公建筑│ 5K-1W  │ 广东深圳│ 2025Q2 │ ● 正常│   │
│  │ m³/㎡  │ ↑2.4%    │        │        │        │        │       │   │
│  ├────────┼──────────┼────────┼────────┼────────┼────────┼────────┤   │
│  │综合单方 │ 5,850    │ 办公建筑│ 5K-1W  │ 广东深圳│ 2025Q2 │ ⚠ 异常│   │
│  │ 元/㎡  │ ↑51.2%   │        │        │        │        │       │   │
│  ├────────┴──────────┴────────┴────────┴────────┴────────┴────────┤   │
│  │                    < 1  2  3  ... 1428 >       共28,560条 20条/页 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 聚合视图

```
┌─────────────────────────────────────────────────────────────────────────┐
│  视图切换：[○ 列表视图] [● 聚合视图] [○ 矩阵视图]                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  聚合维度设置                                                    │   │
│  │  ┌────────────────────────────────────────────────────────────┐ │   │
│  │  │ 功能标签：[办公建筑 ▼]  规模档：[5000-10000㎡ ▼]            │ │   │
│  │  │ 地区：   [广东省    ▼]  时间：  [2025年       ▼]  [聚合计算] │ │   │
│  │  └────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  聚合结果：办公建筑 | 5000-10000㎡ | 广东省 | 2025年              │   │
│  │  样本数：42个案例                              可靠性：🟢 高      │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │  经济指标                                                 │   │   │
│  │  │  ┌─────────────┬────────┬────────┬────────┬────────────┐│   │   │
│  │  │  │ 指标名称     │ 推荐值  │ 均值    │ 中位数  │ 推荐区间   ││   │   │
│  │  │  ├─────────────┼────────┼────────┼────────┼────────────┤│   │   │
│  │  │  │ 综合单方造价  │ 3,950  │ 4,012  │ 3,950  │3,600~4,400││   │   │
│  │  │  │ 土建单方造价  │ 2,370  │ 2,407  │ 2,370  │2,160~2,640││   │   │
│  │  │  │ 安装单方造价  │ 1,185  │ 1,204  │ 1,185  │1,080~1,320││   │   │
│  │  │  │ 人工费占比    │ 18.5%  │ 18.8%  │ 18.5%  │17.0%~20.5%││   │   │
│  │  │  │ 材料费占比    │ 62.0%  │ 61.5%  │ 62.0%  │58.0%~65.0%││   │   │
│  │  │  └─────────────┴────────┴────────┴────────┴────────────┘│   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │  工程量指标                                               │   │   │
│  │  │  ┌─────────────┬────────┬────────┬────────┬────────────┐│   │   │
│  │  │  │ 指标名称     │ 推荐值  │ 均值    │ 中位数  │ 推荐区间   ││   │   │
│  │  │  ├─────────────┼────────┼────────┼────────┼────────────┤│   │   │
│  │  │  │ 钢筋含量     │ 55.0   │ 56.2   │ 55.0   │ 48~62     ││   │   │
│  │  │  │ 混凝土含量   │ 0.41   │ 0.42   │ 0.41   │ 0.36~0.46 ││   │   │
│  │  │  │ 模板含量     │ 2.10   │ 2.15   │ 2.10   │ 1.90~2.35 ││   │   │
│  │  │  │ 外墙面积比   │ 0.35   │ 0.36   │ 0.35   │ 0.30~0.42 ││   │   │
│  │  │  └─────────────┴────────┴────────┴────────┴────────────┘│   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │                                                                 │   │
│  │                                     [查看分布] [趋势分析] [导出] │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 矩阵视图

```
┌─────────────────────────────────────────────────────────────────────────┐
│  视图切换：[○ 列表视图] [○ 聚合视图] [● 矩阵视图]                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  矩阵设置                                                        │   │
│  │  指标：[综合单方造价 ▼]  行维度：[功能标签 ▼]  列维度：[规模档 ▼]  │   │
│  │  地区：[广东省      ▼]  年份：  [2025年    ▼]        [生成矩阵]   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  综合单方造价矩阵（元/㎡）| 广东省 | 2025年                       │   │
│  │  ┌──────────┬────────┬────────┬────────┬────────┬────────────┐ │   │
│  │  │ 功能\规模 │ <3000  │ 3K-5K  │ 5K-1W  │ 1W-2W  │ 2W-5W      │ │   │
│  │  ├──────────┼────────┼────────┼────────┼────────┼────────────┤ │   │
│  │  │ 办公建筑  │ 4,350  │ 4,150  │ 3,950  │ 3,800  │ 3,650      │ │   │
│  │  │          │ (12)   │ (18)   │ (42)   │ (35)   │ (28)       │ │   │
│  │  ├──────────┼────────┼────────┼────────┼────────┼────────────┤ │   │
│  │  │ 商业建筑  │ 5,200  │ 4,950  │ 4,700  │ 4,500  │ 4,350      │ │   │
│  │  │          │ (8)    │ (15)   │ (38)   │ (42)   │ (25)       │ │   │
│  │  ├──────────┼────────┼────────┼────────┼────────┼────────────┤ │   │
│  │  │ 教学建筑  │ 3,850  │ 3,650  │ 3,500  │ 3,380  │ 3,250      │ │   │
│  │  │          │ (15)   │ (22)   │ (35)   │ (28)   │ (18)       │ │   │
│  │  ├──────────┼────────┼────────┼────────┼────────┼────────────┤ │   │
│  │  │ 医疗建筑  │ 6,500  │ 6,200  │ 5,850  │ 5,600  │ 5,400      │ │   │
│  │  │          │ (5)    │ (12)   │ (25)   │ (32)   │ (22)       │ │   │
│  │  ├──────────┼────────┼────────┼────────┼────────┼────────────┤ │   │
│  │  │ 高层住宅  │ 3,200  │ 3,050  │ 2,950  │ 2,850  │ 2,750      │ │   │
│  │  │          │ (20)   │ (45)   │ (68)   │ (52)   │ (35)       │ │   │
│  │  └──────────┴────────┴────────┴────────┴────────┴────────────┘ │   │
│  │                                                                 │   │
│  │  图例：数值为推荐值，括号内为样本数                              │   │
│  │  颜色：🟢≥10样本  🟡5-9样本  🔴<5样本                           │   │
│  │                                                                 │   │
│  │                                        [导出Excel] [生成热力图]  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.4 指标趋势分析

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 数据资产 > 企业库 > 指标库 > 趋势分析                        🔔 👤  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  分析条件                                                        │   │
│  │  指标：[综合单方造价 ▼]  功能：[办公建筑 ▼]  规模：[5K-1W    ▼]   │   │
│  │  地区：[广东省      ▼]  时间：[2023Q1 ] 至 [2025Q4 ]  [分析]     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  趋势图：办公建筑 | 5000-10000㎡ | 广东省 | 综合单方造价           │   │
│  │                                                                 │   │
│  │  4,200 ┤                                              ●        │   │
│  │        │                                         ●              │   │
│  │  4,000 ┤                                    ●                   │   │
│  │        │                               ●                        │   │
│  │  3,800 ┤                          ●                             │   │
│  │        │                     ●                                  │   │
│  │  3,600 ┤               ●                                        │   │
│  │        │          ●                                             │   │
│  │  3,400 ┤     ●                                                  │   │
│  │        │●                                                       │   │
│  │  3,200 ┼────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬──── │   │
│  │        23Q1 23Q2 23Q3 23Q4 24Q1 24Q2 24Q3 24Q4 25Q1 25Q2 25Q3   │   │
│  │                                                                 │   │
│  │  ── 推荐值   ─ ─ 均值   ░░ 置信区间                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  趋势统计                                                        │   │
│  │  ┌───────────┬───────────┬───────────┬───────────┬───────────┐ │   │
│  │  │ 时间段     │ 推荐值     │ 环比变化   │ 同比变化   │ 样本数    │ │   │
│  │  ├───────────┼───────────┼───────────┼───────────┼───────────┤ │   │
│  │  │ 2025Q3    │ 4,150     │ +3.8%     │ +12.2%    │ 42        │ │   │
│  │  │ 2025Q2    │ 4,000     │ +2.6%     │ +10.5%    │ 38        │ │   │
│  │  │ 2025Q1    │ 3,900     │ +2.9%     │ +9.2%     │ 35        │ │   │
│  │  │ 2024Q4    │ 3,790     │ +2.4%     │ +8.0%     │ 40        │ │   │
│  │  │ 2024Q3    │ 3,700     │ +2.8%     │ +6.9%     │ 36        │ │   │
│  │  └───────────┴───────────┴───────────┴───────────┴───────────┘ │   │
│  │                                                                 │   │
│  │  趋势洞察：                                                      │   │
│  │  • 近3年年均增长率：8.5%                                        │   │
│  │  • 2025年增速：10.8%（高于历史平均）                             │   │
│  │  • 预测2025Q4：约4,280元/㎡（±150）                             │   │
│  │                                                                 │   │
│  │                                              [导出报告] [保存]   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.5 指标发布管理

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 数据资产 > 企业库 > 指标库 > 发布管理                        🔔 👤  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  当前发布版本：2025.3.1                                          │   │
│  │  发布时间：2025-10-01 | 指标数：1,286 | 状态：已发布              │   │
│  │                                                   [创建新版本]    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  版本列表                                                        │   │
│  ├──────────┬────────────┬────────┬────────┬────────┬─────────────┤   │
│  │ 版本号    │ 版本名称    │ 指标数  │ 状态    │ 发布时间 │ 操作       │   │
│  ├──────────┼────────────┼────────┼────────┼────────┼─────────────┤   │
│  │ 2025.4.1 │ 2025Q4指标  │ 1,350  │ 待审核  │ -      │ 审核 撤回   │   │
│  │          │ (草稿)     │ +64新增│        │        │             │   │
│  ├──────────┼────────────┼────────┼────────┼────────┼─────────────┤   │
│  │ 2025.3.1 │ 2025Q3指标  │ 1,286  │ 已发布  │ 10-01  │ 查看 归档   │   │
│  │          │ (当前版本)  │        │ 🟢     │        │             │   │
│  ├──────────┼────────────┼────────┼────────┼────────┼─────────────┤   │
│  │ 2025.2.1 │ 2025Q2指标  │ 1,198  │ 已归档  │ 07-01  │ 查看        │   │
│  ├──────────┼────────────┼────────┼────────┼────────┼─────────────┤   │
│  │ 2025.1.1 │ 2025Q1指标  │ 1,105  │ 已归档  │ 04-01  │ 查看        │   │
│  └──────────┴────────────┴────────┴────────┴────────┴─────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  版本 2025.4.1 详情                                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  变更统计：                                                      │   │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │   │
│  │  │   新增指标   │ │   更新指标   │ │   无变化    │               │   │
│  │  │     64      │ │    128      │ │   1,158    │               │   │
│  │  └─────────────┘ └─────────────┘ └─────────────┘               │   │
│  │                                                                 │   │
│  │  主要变化：                                                      │   │
│  │  • 办公建筑综合单方上涨3.8%（3,950→4,100）                       │   │
│  │  • 新增产业园办公指标（功能标签扩展）                             │   │
│  │  • 钢筋含量指标样本数增加20%                                     │   │
│  │                                                                 │   │
│  │                                    [提交审核] [保存草稿] [预览]  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 业务规则

### 5.1 数据入库规则

| 规则编号 | 规则名称 | 规则说明 |
|----------|----------|----------|
| EI-001 | PR审核前置 | 指标必须通过PR审核才能入库 |
| EI-002 | 指标定义校验 | 指标编码必须存在于index_definition表 |
| EI-003 | 维度完整性 | 功能标签、规模档、地区、时间维度必填 |
| EI-004 | 数值范围校验 | 指标值必须在定义的合理范围内 |
| EI-005 | 来源关联 | 必须关联来源项目或我的指标记录 |
| EI-006 | 去重校验 | 同一来源指标不可重复入库 |

### 5.2 异常检测规则

| 规则编号 | 规则名称 | 规则说明 |
|----------|----------|----------|
| EI-101 | IQR异常检测 | 值 < Q1-1.5×IQR 或 值 > Q3+1.5×IQR 标记为异常 |
| EI-102 | Z-Score检测 | \|Z-Score\| > 3 标记为异常 |
| EI-103 | 经验值检测 | 偏离同类均值±50%标记为warning |
| EI-104 | 极值检测 | 超出定义的min_value/max_value标记为error |
| EI-105 | 异常排除 | 异常指标默认不参与聚合计算，可手动审核恢复 |

### 5.3 聚合计算规则

| 规则编号 | 规则名称 | 规则说明 |
|----------|----------|----------|
| EI-201 | 聚合维度 | 按功能标签+规模档+地区+年份四维聚合 |
| EI-202 | 最小样本数 | 样本数≥3才生成聚合结果 |
| EI-203 | 异常值排除 | quality_flag=error或is_outlier=true的数据不参与聚合 |
| EI-204 | 推荐值选取 | 默认取中位数作为推荐值 |
| EI-205 | 推荐区间 | 默认取25分位~75分位作为推荐区间 |
| EI-206 | 可靠性计算 | 基于样本数和变异系数计算可靠性等级 |
| EI-207 | 定时计算 | 每日凌晨自动增量计算，可手动触发全量计算 |

### 5.4 发布管理规则

| 规则编号 | 规则名称 | 规则说明 |
|----------|----------|----------|
| EI-301 | 版本号规则 | 格式：YYYY.Q.N（年.季度.序号） |
| EI-302 | 审核前置 | 发布必须经过审核，审核通过后方可发布 |
| EI-303 | 单一生效 | 同一时间只能有一个版本处于published状态 |
| EI-304 | 归档策略 | 新版本发布后，旧版本自动归档 |
| EI-305 | 回滚限制 | 仅支持回滚到上一个归档版本 |
| EI-306 | 发布通知 | 发布成功后自动通知订阅用户 |

### 5.5 查询筛选规则

| 规则编号 | 规则名称 | 规则说明 |
|----------|----------|----------|
| EI-401 | 指标类别筛选 | 支持经济/工程量/人材机三类多选 |
| EI-402 | 多维联动 | 功能标签、规模档、地区支持联动筛选 |
| EI-403 | 时间范围 | 支持按年、季度筛选，默认近2年 |
| EI-404 | 质量筛选 | 支持按质量标识筛选正常/异常数据 |
| EI-405 | 聚合查询 | 聚合视图默认显示聚合后的统计指标 |

---

## 6. 接口设计

### 6.1 接口清单

| 接口编号 | 接口名称 | 方法 | 路径 |
|----------|----------|------|------|
| EI-API-001 | 原始指标列表 | POST | /api/v1/enterprise/indexes/list |
| EI-API-002 | 指标聚合查询 | POST | /api/v1/enterprise/indexes/aggregate |
| EI-API-003 | 指标矩阵查询 | POST | /api/v1/enterprise/indexes/matrix |
| EI-API-004 | 指标趋势分析 | POST | /api/v1/enterprise/indexes/trend |
| EI-API-005 | 指标分布分析 | POST | /api/v1/enterprise/indexes/distribution |
| EI-API-006 | 统计概览 | GET | /api/v1/enterprise/indexes/statistics |
| EI-API-007 | 指标导出 | POST | /api/v1/enterprise/indexes/export |
| EI-API-008 | 发布版本列表 | GET | /api/v1/enterprise/indexes/publish/versions |
| EI-API-009 | 创建发布版本 | POST | /api/v1/enterprise/indexes/publish |
| EI-API-010 | 提交审核 | PUT | /api/v1/enterprise/indexes/publish/{id}/submit |
| EI-API-011 | 审核发布 | PUT | /api/v1/enterprise/indexes/publish/{id}/approve |
| EI-API-012 | 执行发布 | PUT | /api/v1/enterprise/indexes/publish/{id}/publish |
| EI-API-013 | 指标推荐 | POST | /api/v1/enterprise/indexes/recommend |

### 6.2 核心接口定义

#### 6.2.1 指标聚合查询

**请求：**
```json
POST /api/v1/enterprise/indexes/aggregate
{
  "dimensions": {
    "functionTagCode": "B01-01-001",
    "scaleLevelCode": "A-04",
    "provinceCode": "440000",
    "dataYear": 2025,
    "dataQuarter": null
  },
  "indexCodes": ["IDX-EC-001", "IDX-EC-002", "IDX-QT-001", "IDX-QT-002"],
  "excludeOutliers": true
}
```

**响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dimensions": {
      "functionTag": "办公建筑-甲级办公",
      "scaleLevel": "5000-10000㎡",
      "province": "广东省",
      "dataYear": 2025
    },
    "sampleCount": 42,
    "reliabilityLevel": "high",
    "indexes": [
      {
        "indexCode": "IDX-EC-001",
        "indexName": "综合单方造价",
        "indexUnit": "元/㎡",
        "sampleCount": 42,
        "avgValue": 4012,
        "medianValue": 3950,
        "stdDeviation": 385,
        "minValue": 3280,
        "maxValue": 4850,
        "percentile25": 3720,
        "percentile75": 4280,
        "recommendValue": 3950,
        "recommendRangeLow": 3720,
        "recommendRangeHigh": 4280,
        "reliabilityLevel": "high"
      }
    ]
  }
}
```

#### 6.2.2 指标推荐（估算模块调用）

**请求：**
```json
POST /api/v1/enterprise/indexes/recommend
{
  "functionTagCode": "B01-01-001",
  "scaleLevelCode": "A-04",
  "provinceCode": "440000",
  "pricingDate": "2025-10-01",
  "indexCodes": ["IDX-EC-001", "IDX-EC-002", "IDX-QT-001"],
  "matchStrategy": "exact_first"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "matchLevel": "exact",
    "matchDescription": "精确匹配：办公建筑-甲级办公 + 5000-10000㎡ + 广东省",
    "publishVersion": "2025.3.1",
    "recommendations": [
      {
        "indexCode": "IDX-EC-001",
        "indexName": "综合单方造价",
        "indexUnit": "元/㎡",
        "recommendValue": 3950,
        "recommendRangeLow": 3720,
        "recommendRangeHigh": 4280,
        "sampleCount": 42,
        "reliabilityLevel": "high"
      }
    ]
  }
}
```

---

## 7. 状态机

### 7.1 原始指标状态

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        原始指标状态机                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                    PR审核通过                                           │
│                        │                                                │
│                        ▼                                                │
│                  ┌──────────┐                                           │
│                  │  active  │ ◀──────────────────────┐                  │
│                  │  (启用)   │                        │                  │
│                  └────┬─────┘                        │                  │
│                       │                              │                  │
│          ┌────────────┼────────────┐                │                  │
│          │            │            │                │                  │
│          │ 标记异常    │ 手动停用    │ 审核恢复       │                  │
│          ▼            ▼            │                │                  │
│    ┌──────────┐ ┌──────────┐      │                │                  │
│    │ excluded │ │ inactive │──────┘                │                  │
│    │  (排除)   │ │  (停用)   │                       │                  │
│    └────┬─────┘ └────┬─────┘                       │                  │
│         │            │                              │                  │
│         └────────────┼──────────────────────────────┘                  │
│                      ▼                                                  │
│                ┌──────────┐                                             │
│                │ deleted  │                                             │
│                │ (已删除)  │                                             │
│                └──────────┘                                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 7.2 发布版本状态

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        发布版本状态机                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│       创建版本                                                          │
│           │                                                             │
│           ▼                                                             │
│     ┌──────────┐     提交审核     ┌──────────┐                         │
│     │  draft   │ ──────────────▶ │ pending  │                         │
│     │  (草稿)   │ ◀────────────── │ (待审核)  │                         │
│     └──────────┘     撤回提交     └────┬─────┘                         │
│                                        │                                │
│                           ┌────────────┼────────────┐                  │
│                           │ 审核通过    │            │ 审核驳回          │
│                           ▼            │            ▼                  │
│                    ┌──────────┐        │      ┌──────────┐             │
│                    │ approved │        │      │ rejected │             │
│                    │ (已审核)  │        │      │  (驳回)   │             │
│                    └────┬─────┘        │      └────┬─────┘             │
│                         │ 执行发布     │           │                    │
│                         ▼              │           └─────▶ draft       │
│                    ┌──────────┐        │                               │
│                    │published │        │                               │
│                    │ (已发布)  │        │                               │
│                    └────┬─────┘        │                               │
│                         │ 新版本发布    │                               │
│                         ▼              │                               │
│                    ┌──────────┐        │                               │
│                    │ archived │ ◀──────┘                               │
│                    │ (已归档)  │                                        │
│                    └──────────┘                                         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 聚合计算说明

### 8.1 聚合计算流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          聚合计算流程                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Step 1: 数据筛选                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  • 筛选status=active的原始指标                                   │   │
│  │  • 排除quality_flag=error和is_outlier=true的数据                 │   │
│  │  • 按聚合维度分组：功能标签 + 规模档 + 地区 + 年份                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  Step 2: 统计计算                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  对每个分组计算：                                                 │   │
│  │  • 样本数（COUNT）                                               │   │
│  │  • 平均值（AVG）                                                 │   │
│  │  • 中位数（PERCENTILE_CONT(0.5)）                                │   │
│  │  • 标准差（STDDEV）                                              │   │
│  │  • 最小值/最大值（MIN/MAX）                                       │   │
│  │  • 25/75分位数（PERCENTILE_CONT(0.25/0.75)）                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  Step 3: 置信区间计算                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  95%置信区间 = 均值 ± 1.96 × (标准差 / √样本数)                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  Step 4: 推荐值生成                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  • 推荐值 = 中位数（更稳健，不受极值影响）                         │   │
│  │  • 推荐区间 = [25分位数, 75分位数]                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  Step 5: 可靠性评估                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  变异系数 CV = 标准差 / 均值                                      │   │
│  │  • high:   样本数≥10 且 CV≤20%                                   │   │
│  │  • medium: 样本数≥5  且 CV≤30%                                   │   │
│  │  • low:    样本数<5  或 CV>30%                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  Step 6: 结果存储                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  • 更新或插入index_aggregate表                                    │   │
│  │  • 记录计算时间last_calculate_time                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 8.2 聚合维度降级策略

当精确匹配无数据时，按以下顺序降级查询：

| 优先级 | 匹配策略 | 说明 |
|:------:|----------|------|
| 1 | 精确匹配 | 功能标签 + 规模档 + 地区 + 年份 |
| 2 | 放宽地区 | 功能标签 + 规模档 + 全省 + 年份 |
| 3 | 放宽规模 | 功能标签 + 相邻规模档 + 地区 + 年份 |
| 4 | 放宽时间 | 功能标签 + 规模档 + 地区 + 近3年 |
| 5 | 功能大类 | 功能大类 + 规模档 + 地区 + 年份 |
| 6 | 兜底 | 功能大类 + 全规模 + 全国 + 近3年 |

---

## 9. 非功能需求

### 9.1 性能要求

| 场景 | 指标 | 目标值 |
|------|------|--------|
| 列表查询 | 响应时间 | < 500ms |
| 聚合查询 | 响应时间 | < 800ms |
| 矩阵查询 | 响应时间 | < 1s |
| 趋势分析 | 响应时间 | < 1s |
| 聚合计算（增量） | 处理时间 | < 5min/日 |
| 聚合计算（全量） | 处理时间 | < 30min |

### 9.2 数据安全

| 类别 | 要求 |
|------|------|
| 访问控制 | 基于角色的权限控制 |
| 审计日志 | 记录所有查询、导出、发布操作 |
| 数据备份 | 每日增量备份，每周全量备份 |

---

## 10. 附录

### 10.1 指标编码规则

```
指标编码格式：IDX-{类别}-{序号}

类别：
  EC = Economic（经济指标）
  QT = Quantity（工程量指标）
  RS = Resource（人材机指标）

示例：
  IDX-EC-001 = 经济指标第001号（综合单方造价）
  IDX-QT-001 = 工程量指标第001号（钢筋含量）
  IDX-RS-001 = 人材机指标第001号（人工工日）
```

### 10.2 版本号规则

```
版本号格式：YYYY.Q.N

YYYY = 年份（4位）
Q    = 季度（1-4）
N    = 当季序号（从1开始）

示例：
  2025.3.1 = 2025年第3季度第1次发布
  2025.4.2 = 2025年第4季度第2次发布
```

---

## 11. 版本历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| V1.0 | 2026-01-18 | - | 初版，完成企业指标库功能规格说明 |

---

**文档说明：**
1. 本文档定义企业指标库的功能规格，作为开发实现的依据
2. 数据模型与已完成的数据采集模块保持一致
3. 接口设计遵循技术规范中的API契约规范
4. 指标推荐接口供估算模块调用，支持多级匹配降级