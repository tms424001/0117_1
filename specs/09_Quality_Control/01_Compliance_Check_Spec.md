# 合规性检查规格说明书

> 版本：V1.0  
> 更新日期：2026-01-18  
> 文档状态：初稿  
> 所属模块：09_Quality_Control  
> 上级文档：00_QC_Overview_Spec.md

---

## 1. 功能概述

### 1.1 功能定位

合规性检查是质控模块的**基础检查层**，依据国家标准和行业规范，对造价文件的编码、单位、特征、结构进行规范性校验。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          合规性检查定位                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   检查层次                                                              │
│   ────────                                                              │
│   ┌─────────────┐                                                       │
│   │ 合规性检查  │ ◀── 基础层：格式正确、结构完整（本文档）             │
│   ├─────────────┤                                                       │
│   │ 价格检查    │ ◀── 价值层：价格合理、逻辑正确                       │
│   ├─────────────┤                                                       │
│   │ 清单检查    │ ◀── 内容层：特征准确、项目齐全                       │
│   ├─────────────┤                                                       │
│   │ 指标检查    │ ◀── 宏观层：指标合理、整体平衡                       │
│   └─────────────┘                                                       │
│                                                                         │
│   核心价值：确保数据"格式正确"，为后续深度检查奠定基础                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 检查范围

| 检查类别 | 检查对象 | 规范依据 |
|----------|----------|----------|
| 清单编码检查 | 分部分项清单编码 | GB 50500《建设工程工程量清单计价规范》 |
| 计量单位检查 | 清单项计量单位 | GB 50500 附录 |
| 项目特征检查 | 清单项目特征描述 | GB 50500 附录 |
| 费用结构检查 | 造价文件费用组成 | 各省计价规则 |

### 1.3 适用文件类型

| 文件类型 | 是否适用 | 说明 |
|----------|:--------:|------|
| 估算文件 | ○ | 部分规则适用（费用结构） |
| 概算文件 | ○ | 部分规则适用（费用结构） |
| 招标控制价 | ● | 全部规则适用 |
| 投标文件 | ● | 全部规则适用 |
| 合同价 | ● | 全部规则适用 |
| 结算文件 | ● | 全部规则适用 |

> ● 全部适用 ○ 部分适用 - 不适用

---

## 2. 检查规则详述

### 2.1 清单编码检查

#### 2.1.1 编码格式规则

**规范依据**：GB 50500-2013《建设工程工程量清单计价规范》

**12位编码结构**：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        清单编码结构（12位）                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   0  1  0  5  0  1  0  0  4  0  0  1                                   │
│   ─  ─  ─  ─  ─  ─  ─  ─  ─  ─  ─  ─                                   │
│   │  │  │  │  │  │  │  │  │  │  │  │                                   │
│   └──┴──┘  └──┴──┘  └──┴──┘  └──┴──┴──┘                                │
│      │        │        │        │                                      │
│      │        │        │        └─ 清单项序号（4位）                   │
│      │        │        │           企业自编，0001-9999                  │
│      │        │        │                                               │
│      │        │        └─ 清单项编码（3位）                            │
│      │        │           按规范附录，001-999                          │
│      │        │                                                        │
│      │        └─ 章编码（2位）                                         │
│      │           如：01土石方、02桩基础、03砌筑...                      │
│      │                                                                 │
│      └─ 专业编码（2位）                                                │
│         01房屋建筑、02装饰装修、03安装、04市政...                      │
│                                                                         │
│   示例：010501004001                                                    │
│   解读：房屋建筑(01) - 混凝土(05) - 柱(01) - 矩形柱(004) - 序号(001)   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**检查规则清单**：

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-CODE-001 | 编码长度检查 | 编码必须为12位数字 | 🔴 严重 |
| CMP-CODE-002 | 专业编码有效性 | 前2位必须在专业编码表中存在 | 🔴 严重 |
| CMP-CODE-003 | 章编码有效性 | 3-4位必须在对应专业的章编码表中存在 | 🔴 严重 |
| CMP-CODE-004 | 清单项编码有效性 | 5-9位必须在对应章的清单项编码表中存在 | 🔴 严重 |
| CMP-CODE-005 | 序号唯一性检查 | 同一清单项编码下序号不能重复 | 🟡 一般 |
| CMP-CODE-006 | 序号连续性检查 | 序号应从0001开始连续编号 | 🔵 提示 |

**专业编码表**：

| 专业编码 | 专业名称 | 适用范围 |
|:--------:|----------|----------|
| 01 | 房屋建筑与装饰工程 | 房建土建+装饰 |
| 02 | 仿古建筑工程 | 仿古建筑 |
| 03 | 通用安装工程 | 安装工程 |
| 04 | 市政工程 | 市政道路、桥梁等 |
| 05 | 园林绿化工程 | 园林景观 |
| 06 | 矿山工程 | 矿山建设 |
| 07 | 构筑物工程 | 独立构筑物 |
| 08 | 城市轨道交通工程 | 地铁、轻轨 |
| 09 | 爆破工程 | 爆破拆除 |

#### 2.1.2 编码匹配规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-CODE-101 | 编码与名称匹配 | 清单编码对应的标准名称应与实际名称相近 | 🟡 一般 |
| CMP-CODE-102 | 编码与特征匹配 | 清单编码要求的必填特征应存在 | 🟡 一般 |
| CMP-CODE-103 | 编码与单位匹配 | 清单编码对应的标准单位应与实际单位一致 | 🔴 严重 |

### 2.2 计量单位检查

#### 2.2.1 单位规范性规则

**规范依据**：GB 50500-2013 附录各清单项的计量单位规定

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-UNIT-001 | 单位标准化检查 | 单位必须使用标准写法 | 🟡 一般 |
| CMP-UNIT-002 | 单位与编码匹配 | 单位必须与清单编码规定的单位一致 | 🔴 严重 |
| CMP-UNIT-003 | 单位合理性检查 | 单位应与清单项性质匹配 | 🟡 一般 |

**标准单位对照表**：

| 标准写法 | 允许的变体 | 不允许的写法 | 适用清单项示例 |
|:--------:|-----------|-------------|---------------|
| m³ | M3, m3, 立方米 | 方, 立米 | 混凝土、土方、砌体 |
| m² | M2, m2, 平方米 | 平方, 平米 | 模板、涂料、地面 |
| m | M, 米 | - | 线缆、管道、围墙 |
| kg | KG, 公斤 | 千克 | 钢筋、型钢 |
| t | T, 吨 | - | 钢结构、预制构件 |
| 个 | - | 只, 枚 | 井盖、阀门 |
| 套 | - | 组 | 门窗、设备 |
| 根 | - | 条 | 桩基、柱子 |
| 台 | - | 部 | 设备、机械 |
| 项 | - | 次 | 综合项目 |

#### 2.2.2 单位换算检查

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-UNIT-101 | 工程量量级检查 | 工程量应与单位量级匹配（如m³不应出现0.001级别） | 🔵 提示 |
| CMP-UNIT-102 | 单位精度检查 | 工程量小数位数应符合规范要求 | 🔵 提示 |

**工程量精度要求**：

| 单位 | 小数位数 | 说明 |
|:----:|:--------:|------|
| m³ | 2位 | 保留到0.01m³ |
| m² | 2位 | 保留到0.01m² |
| m | 2位 | 保留到0.01m |
| kg | 2位 | 保留到0.01kg |
| t | 3位 | 保留到0.001t |
| 个/套/根/台 | 0位 | 取整数 |

### 2.3 项目特征检查

#### 2.3.1 特征完整性规则

**规范依据**：GB 50500-2013 附录各清单项的项目特征要求

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEAT-001 | 必填特征完整性 | 规范规定的必填特征不能缺失 | 🔴 严重 |
| CMP-FEAT-002 | 特征描述非空 | 项目特征字段不能为空或仅含空格 | 🟡 一般 |
| CMP-FEAT-003 | 特征数量检查 | 特征条数应在合理范围内（1-20条） | 🔵 提示 |

**常见清单项必填特征**：

| 清单项 | 必填特征 | 示例 |
|--------|----------|------|
| 矩形柱 | 截面尺寸、混凝土强度等级 | 400×400, C30 |
| 梁 | 截面尺寸、混凝土强度等级、梁类型 | 250×500, C30, 框架梁 |
| 板 | 板厚、混凝土强度等级、板类型 | 120mm, C30, 现浇板 |
| 钢筋 | 钢筋种类、规格 | HRB400, Φ12 |
| 墙体砌筑 | 墙体类型、砂浆种类及强度、墙厚 | 加气块, M5混合砂浆, 200mm |
| 门 | 门类型、规格、材质 | 防火门, 1000×2100, 钢质 |
| 窗 | 窗类型、规格、材质 | 推拉窗, 1500×1800, 铝合金 |

#### 2.3.2 特征规范性规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEAT-101 | 特征格式规范 | 尺寸特征应使用标准格式（如"400×400"） | 🔵 提示 |
| CMP-FEAT-102 | 特征值有效性 | 特征值应在合理范围内（如C30-C60） | 🟡 一般 |
| CMP-FEAT-103 | 特征一致性 | 相同清单项的相同特征应使用一致的描述方式 | 🔵 提示 |

**特征值有效范围**：

| 特征类型 | 有效值范围 | 异常示例 |
|----------|-----------|----------|
| 混凝土强度等级 | C15-C80 | C100、C10 |
| 砂浆强度等级 | M2.5-M20 | M30、M1 |
| 钢筋等级 | HPB300, HRB335, HRB400, HRB500 | HRB600 |
| 板厚 | 60mm-300mm | 500mm、30mm |
| 墙厚 | 100mm-400mm | 50mm、500mm |

#### 2.3.3 特征逻辑性规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEAT-201 | 名称与特征一致 | 清单名称中的信息应与特征一致 | 🔴 严重 |
| CMP-FEAT-202 | 特征内部一致 | 多个特征之间不应矛盾 | 🔴 严重 |

**示例**：
- ❌ 清单名称"C30矩形柱"，特征中强度等级填"C40"→ 触发 CMP-FEAT-201
- ❌ 特征"截面400×400"，另一特征"周长1200mm"→ 触发 CMP-FEAT-202

### 2.4 费用结构检查

#### 2.4.1 费用组成完整性规则

**规范依据**：各省《建设工程计价规则》

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEE-001 | 一级费用完整性 | 必须包含分部分项费、措施费、规费、税金 | 🔴 严重 |
| CMP-FEE-002 | 分部分项费非空 | 分部分项工程费不能为0 | 🔴 严重 |
| CMP-FEE-003 | 措施费完整性 | 措施费应包含必要子项 | 🟡 一般 |
| CMP-FEE-004 | 规费完整性 | 规费应包含社保、住房公积金等必要子项 | 🟡 一般 |
| CMP-FEE-005 | 税金费率检查 | 税金费率应符合现行税率规定 | 🔴 严重 |

**标准费用结构**：

```
工程造价
├── 分部分项工程费
│   ├── 定额人工费
│   ├── 定额材料费
│   ├── 定额机械费
│   ├── 企业管理费
│   └── 利润
├── 措施项目费
│   ├── 安全文明施工费 *
│   ├── 夜间施工增加费
│   ├── 二次搬运费
│   ├── 冬雨季施工增加费
│   ├── 大型机械进出场及安拆费
│   ├── 施工排水降水费
│   ├── 脚手架费 *
│   ├── 模板费 *（或含在分部分项中）
│   └── 其他措施费
├── 其他项目费
│   ├── 暂列金额
│   ├── 暂估价
│   ├── 计日工
│   └── 总承包服务费
├── 规费
│   ├── 社会保险费 *
│   │   ├── 养老保险费
│   │   ├── 医疗保险费
│   │   ├── 失业保险费
│   │   └── 工伤保险费
│   └── 住房公积金 *
└── 税金 *

注：* 为必填项
```

#### 2.4.2 费用计算规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEE-101 | 汇总计算正确性 | 各层级费用汇总应正确 | 🔴 严重 |
| CMP-FEE-102 | 费率应用正确性 | 管理费率、利润率、规费费率应符合规定 | 🟡 一般 |
| CMP-FEE-103 | 税金计算正确性 | 税金 = 税前造价 × 税率 | 🔴 严重 |

**费率参考范围**：

| 费用项 | 计算基数 | 参考费率范围 | 说明 |
|--------|----------|:------------:|------|
| 企业管理费 | 定额人工费+机械费 | 15%-40% | 按工程类别、企业资质 |
| 利润 | 定额人工费+机械费 | 5%-15% | 按工程类别 |
| 安全文明施工费 | 定额人工费 | 10%-30% | 按工程类别、地区 |
| 社会保险费 | 定额人工费 | 25%-35% | 按地区规定 |
| 住房公积金 | 定额人工费 | 5%-12% | 按地区规定 |
| 税金 | 税前造价 | 9% | 增值税一般计税 |

#### 2.4.3 费用层级检查

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| CMP-FEE-201 | 分部存在性检查 | 应至少包含1个分部 | 🔴 严重 |
| CMP-FEE-202 | 分项存在性检查 | 每个分部应至少包含1个分项 | 🔴 严重 |
| CMP-FEE-203 | 清单项存在性检查 | 每个分项应至少包含1个清单项 | 🟡 一般 |
| CMP-FEE-204 | 层级结构完整性 | 费用层级应完整（分部→分项→清单项） | 🟡 一般 |

---

## 3. 规则配置

### 3.1 规则数据结构

```typescript
interface ComplianceRule {
  // 基本信息
  ruleId: string;                    // 规则ID，格式：CMP-{类别}-{序号}
  ruleName: string;                  // 规则名称
  ruleCategory: 'code' | 'unit' | 'feature' | 'fee';  // 规则类别
  
  // 规则定义
  description: string;               // 规则描述
  checkTarget: CheckTarget;          // 检查对象
  checkLogic: CheckLogic;            // 检查逻辑
  
  // 严重程度
  severity: 'error' | 'warning' | 'info';
  
  // 参数配置
  parameters: RuleParameter[];
  
  // 引用数据
  referenceData: {
    standardLibrary?: string;        // 引用的标准库
    lookupTable?: string;            // 引用的对照表
  };
  
  // 适用范围
  applicableFileTypes: FileType[];
  applicableProfessions: string[];   // 适用专业编码，空表示全部
  
  // 状态
  isEnabled: boolean;
  version: string;
}

interface CheckTarget {
  level: 'file' | 'division' | 'subdivision' | 'item' | 'material';
  field: string;                     // 目标字段
}

interface CheckLogic {
  type: 'format' | 'lookup' | 'compare' | 'calculate' | 'custom';
  expression?: string;               // 表达式（format/compare/calculate）
  lookupSource?: string;             // 查找源（lookup）
  customFunction?: string;           // 自定义函数名（custom）
}
```

### 3.2 规则配置示例

**示例1：清单编码长度检查**

```json
{
  "ruleId": "CMP-CODE-001",
  "ruleName": "编码长度检查",
  "ruleCategory": "code",
  "description": "清单编码必须为12位数字",
  "checkTarget": {
    "level": "item",
    "field": "itemCode"
  },
  "checkLogic": {
    "type": "format",
    "expression": "^\\d{12}$"
  },
  "severity": "error",
  "parameters": [],
  "referenceData": {},
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "applicableProfessions": [],
  "isEnabled": true,
  "version": "1.0.0"
}
```

**示例2：单位与编码匹配检查**

```json
{
  "ruleId": "CMP-UNIT-002",
  "ruleName": "单位与编码匹配",
  "ruleCategory": "unit",
  "description": "计量单位必须与清单编码规定的标准单位一致",
  "checkTarget": {
    "level": "item",
    "field": "unit"
  },
  "checkLogic": {
    "type": "lookup",
    "lookupSource": "standardBoQLibrary"
  },
  "severity": "error",
  "parameters": [
    {
      "paramName": "allowVariants",
      "paramType": "boolean",
      "defaultValue": true,
      "currentValue": true,
      "description": "是否允许单位变体（如m³/M3）"
    }
  ],
  "referenceData": {
    "standardLibrary": "SBoQ",
    "lookupTable": "unitMapping"
  },
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "applicableProfessions": [],
  "isEnabled": true,
  "version": "1.0.0"
}
```

**示例3：必填特征完整性检查**

```json
{
  "ruleId": "CMP-FEAT-001",
  "ruleName": "必填特征完整性",
  "ruleCategory": "feature",
  "description": "规范规定的必填特征不能缺失",
  "checkTarget": {
    "level": "item",
    "field": "features"
  },
  "checkLogic": {
    "type": "lookup",
    "lookupSource": "requiredFeatureLibrary"
  },
  "severity": "error",
  "parameters": [],
  "referenceData": {
    "standardLibrary": "SBoQ",
    "lookupTable": "requiredFeatures"
  },
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "applicableProfessions": [],
  "isEnabled": true,
  "version": "1.0.0"
}
```

**示例4：费用汇总计算正确性检查**

```json
{
  "ruleId": "CMP-FEE-101",
  "ruleName": "汇总计算正确性",
  "ruleCategory": "fee",
  "description": "各层级费用汇总应正确（子项之和等于父项）",
  "checkTarget": {
    "level": "division",
    "field": "totalAmount"
  },
  "checkLogic": {
    "type": "calculate",
    "expression": "ABS(parent.totalAmount - SUM(children.totalAmount)) < tolerance"
  },
  "severity": "error",
  "parameters": [
    {
      "paramName": "tolerance",
      "paramType": "number",
      "defaultValue": 0.01,
      "currentValue": 0.01,
      "description": "允许的计算误差（元）"
    }
  ],
  "referenceData": {},
  "applicableFileTypes": ["estimate", "budget", "bidControl", "bid", "contract", "settlement"],
  "applicableProfessions": [],
  "isEnabled": true,
  "version": "1.0.0"
}
```

### 3.3 规则汇总

| 类别 | 规则数量 | 严重级别分布 |
|------|:--------:|-------------|
| 清单编码检查 | 9条 | 🔴×4 🟡×3 🔵×2 |
| 计量单位检查 | 5条 | 🔴×1 🟡×2 🔵×2 |
| 项目特征检查 | 8条 | 🔴×3 🟡×3 🔵×2 |
| 费用结构检查 | 9条 | 🔴×5 🟡×3 🔵×1 |
| **合计** | **31条** | 🔴×13 🟡×11 🔵×7 |

---

## 4. 检查流程

### 4.1 执行流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        合规性检查执行流程                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────┐                                                       │
│  │   输入文件    │                                                       │
│  └───────┬──────┘                                                       │
│          │                                                              │
│          ▼                                                              │
│  ┌──────────────┐     ┌──────────────┐                                 │
│  │  文件解析     │────▶│  识别文件类型 │                                 │
│  └───────┬──────┘     └───────┬──────┘                                 │
│          │                    │                                        │
│          │                    ▼                                        │
│          │            ┌──────────────┐                                 │
│          │            │ 加载适用规则  │                                 │
│          │            │ （按文件类型）│                                 │
│          │            └───────┬──────┘                                 │
│          │                    │                                        │
│          ▼                    ▼                                        │
│  ┌──────────────────────────────────────┐                              │
│  │           逐层遍历执行检查            │                              │
│  │                                      │                              │
│  │  文件级检查                          │                              │
│  │    └─ CMP-FEE-001~005 (费用结构)     │                              │
│  │         │                            │                              │
│  │         ▼                            │                              │
│  │  分部级检查                          │                              │
│  │    └─ CMP-FEE-101~103 (费用计算)     │                              │
│  │    └─ CMP-FEE-201~204 (层级结构)     │                              │
│  │         │                            │                              │
│  │         ▼                            │                              │
│  │  清单项级检查                        │                              │
│  │    └─ CMP-CODE-001~006 (编码格式)    │                              │
│  │    └─ CMP-CODE-101~103 (编码匹配)    │                              │
│  │    └─ CMP-UNIT-001~003 (单位规范)    │                              │
│  │    └─ CMP-UNIT-101~102 (单位精度)    │                              │
│  │    └─ CMP-FEAT-001~003 (特征完整)    │                              │
│  │    └─ CMP-FEAT-101~103 (特征规范)    │                              │
│  │    └─ CMP-FEAT-201~202 (特征逻辑)    │                              │
│  │                                      │                              │
│  └──────────────────────────────────────┘                              │
│          │                                                              │
│          ▼                                                              │
│  ┌──────────────┐                                                       │
│  │  汇总Issue   │                                                       │
│  │  生成报告    │                                                       │
│  └──────────────┘                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 检查优先级

检查按以下优先级顺序执行，高优先级检查失败可能导致低优先级检查跳过：

| 优先级 | 检查类别 | 说明 |
|:------:|----------|------|
| 1 | 费用结构完整性 | 结构不完整则无法进行后续检查 |
| 2 | 清单编码格式 | 编码格式错误则无法进行编码匹配检查 |
| 3 | 清单编码匹配 | 编码有效才能查找标准单位和必填特征 |
| 4 | 计量单位检查 | - |
| 5 | 项目特征检查 | - |
| 6 | 费用计算检查 | - |

### 4.3 依赖数据

| 数据源 | 用途 | 更新频率 |
|--------|------|----------|
| 标准清单库（SBoQ） | 编码有效性、标准单位、必填特征 | 规范更新时 |
| 单位对照表 | 单位变体映射 | 按需维护 |
| 特征有效值表 | 特征值范围校验 | 按需维护 |
| 省份费率表 | 费率范围参考 | 年度/政策调整时 |
| 税率表 | 税率校验 | 政策调整时 |

---

## 5. Issue 生成

### 5.1 Issue 模板

**清单编码类Issue**：

```typescript
{
  title: "清单编码{问题类型}",
  description: "清单项【{清单名称}】的编码【{实际编码}】{问题描述}",
  suggestion: "{修改建议}",
  locationType: "item",
  locationPath: "{分部}/{分项}/{清单项名称}",
  lineNumber: {行号},
  actualValue: "{实际值}",
  expectedValue: "{期望值}"
}
```

**示例**：
```json
{
  "title": "清单编码长度错误",
  "description": "清单项【矩形柱】的编码【01050100401】不符合12位规范，当前为11位",
  "suggestion": "请检查编码，补充至12位。参考格式：010501004001",
  "locationType": "item",
  "locationPath": "土建工程/混凝土工程/矩形柱",
  "lineNumber": 35,
  "actualValue": "01050100401",
  "expectedValue": "12位数字编码"
}
```

**计量单位类Issue**：

```json
{
  "title": "计量单位与编码不匹配",
  "description": "清单项【矩形柱】编码010501004001对应标准单位为m³，实际填写m²",
  "suggestion": "请将计量单位修改为m³",
  "locationType": "item",
  "locationPath": "土建工程/混凝土工程/矩形柱",
  "lineNumber": 35,
  "actualValue": "m²",
  "expectedValue": "m³"
}
```

**项目特征类Issue**：

```json
{
  "title": "必填特征缺失",
  "description": "清单项【矩形柱】缺少必填特征：截面尺寸",
  "suggestion": "请补充截面尺寸，格式如：400×400",
  "locationType": "item",
  "locationPath": "土建工程/混凝土工程/矩形柱",
  "lineNumber": 35,
  "actualValue": "缺失",
  "expectedValue": "截面尺寸（必填）"
}
```

**费用结构类Issue**：

```json
{
  "title": "费用汇总计算错误",
  "description": "分部【土建工程】费用汇总错误，子项合计125,680.50元，但分部合计填写125,580.50元，差额100.00元",
  "suggestion": "请检查并修正分部汇总金额",
  "locationType": "division",
  "locationPath": "土建工程",
  "lineNumber": null,
  "actualValue": "125,580.50",
  "expectedValue": "125,680.50",
  "deviation": -100.00
}
```

### 5.2 Issue 严重程度判定

| 问题类型 | 严重程度 | 判定依据 |
|----------|:--------:|----------|
| 编码格式错误 | 🔴 严重 | 影响数据标准化和后续检查 |
| 编码不存在 | 🔴 严重 | 无法识别清单项类型 |
| 单位与编码不匹配 | 🔴 严重 | 影响工程量计价正确性 |
| 必填特征缺失 | 🔴 严重 | 影响清单项识别和计价 |
| 名称与特征矛盾 | 🔴 严重 | 信息不一致，存在错误 |
| 费用结构缺失 | 🔴 严重 | 造价不完整 |
| 费用计算错误 | 🔴 严重 | 造价金额不正确 |
| 编码序号重复 | 🟡 一般 | 不影响计价，但不规范 |
| 单位非标准写法 | 🟡 一般 | 可识别，但不规范 |
| 特征值超出常规范围 | 🟡 一般 | 可能存在问题，需人工确认 |
| 编码序号不连续 | 🔵 提示 | 仅规范性建议 |
| 工程量精度不符 | 🔵 提示 | 仅规范性建议 |

---

## 6. 界面设计

### 6.1 检查结果展示

```
┌─ 合规性检查结果 ─────────────────────────────────────────────────────────┐
│                                                                          │
│  检查概况                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                    │ │
│  │   检查规则     命中问题     问题分布                                │ │
│  │   ┌─────┐     ┌─────┐     ┌─────────────────────┐                 │ │
│  │   │  31 │     │  12 │     │ 🔴 严重    5 (42%)  │                 │ │
│  │   │  条 │     │  条 │     │ 🟡 一般    4 (33%)  │                 │ │
│  │   └─────┘     └─────┘     │ 🔵 提示    3 (25%)  │                 │ │
│  │                           └─────────────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  分类统计                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ 检查类别           规则数    命中数    通过率     操作               │ │
│  │ ─────────────────────────────────────────────────────────────────  │ │
│  │ 清单编码检查         9         3       67%      [查看详情]          │ │
│  │ 计量单位检查         5         2       60%      [查看详情]          │ │
│  │ 项目特征检查         8         4       50%      [查看详情]          │ │
│  │ 费用结构检查         9         3       67%      [查看详情]          │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  问题清单                                        [全部] [严重] [一般]   │
│  ┌────────┬──────────────────────────────┬──────────┬────────────────┐ │
│  │ 级别   │ 问题描述                      │ 定位     │ 操作           │ │
│  ├────────┼──────────────────────────────┼──────────┼────────────────┤ │
│  │ 🔴严重 │ 清单编码长度错误：01050100401│ 第35行   │ [定位] [处理]  │ │
│  │        │ 应为12位，实际11位            │          │                │ │
│  ├────────┼──────────────────────────────┼──────────┼────────────────┤ │
│  │ 🔴严重 │ 单位与编码不匹配：矩形柱      │ 第35行   │ [定位] [处理]  │ │
│  │        │ 应为m³，实际m²                │          │                │ │
│  ├────────┼──────────────────────────────┼──────────┼────────────────┤ │
│  │ 🔴严重 │ 必填特征缺失：矩形柱          │ 第35行   │ [定位] [处理]  │ │
│  │        │ 缺少"截面尺寸"                │          │                │ │
│  ├────────┼──────────────────────────────┼──────────┼────────────────┤ │
│  │ 🟡一般 │ 单位非标准写法：立方米        │ 第42行   │ [定位] [处理]  │ │
│  │        │ 建议使用m³                    │          │                │ │
│  ├────────┼──────────────────────────────┼──────────┼────────────────┤ │
│  │ 🔵提示 │ 编码序号不连续：0001→0003    │ 全局     │ [定位] [忽略]  │ │
│  │        │ 缺少0002                      │          │                │ │
│  └────────┴──────────────────────────────┴──────────┴────────────────┘ │
│                                                                          │
│                                    [导出报告]  [批量处理]  [重新检查]   │
└──────────────────────────────────────────────────────────────────────────┘
```

### 6.2 问题定位与联动

点击"定位"按钮后，自动跳转到文件预览界面，并高亮显示问题所在行：

```
┌─ 文件预览（问题定位）────────────────────────────────────────────────────┐
│                                                                          │
│  ┌─ 左侧：项目树 ─────────────────┐  ┌─ 右侧：清单详情 ───────────────┐ │
│  │                                │  │                                │ │
│  │  📁 某住宅项目                  │  │  清单项详情                    │ │
│  │  ├─ 📂 土建工程 ←[高亮]        │  │  ┌────────────────────────┐  │ │
│  │  │   ├─ 📂 土石方工程          │  │  │ 编码：01050100401      │  │ │
│  │  │   ├─ 📂 砌筑工程            │  │  │       ↑ ⚠️ 编码错误    │  │ │
│  │  │   ├─ 📂 混凝土工程 ←[高亮]  │  │  │ 名称：矩形柱            │  │ │
│  │  │   │   ├─ 矩形柱 ←[选中]    │  │  │ 单位：m² ← ⚠️ 应为m³  │  │ │
│  │  │   │   ├─ 矩形梁             │  │  │ 工程量：125.60          │  │ │
│  │  │   │   └─ 现浇板             │  │  │ 单价：580.00            │  │ │
│  │  │   └─ 📂 钢筋工程            │  │  │ 合价：72,848.00         │  │ │
│  │  └─ 📂 装饰工程                │  │  └────────────────────────┘  │ │
│  │                                │  │                                │ │
│  │                                │  │  项目特征                      │ │
│  │                                │  │  ┌────────────────────────┐  │ │
│  │                                │  │  │ 1. 混凝土强度：C30      │  │ │
│  │                                │  │  │ 2. ⚠️ 缺少：截面尺寸   │  │ │
│  │                                │  │  └────────────────────────┘  │ │
│  │                                │  │                                │ │
│  │                                │  │  [上一问题] [下一问题] [修改] │ │
│  └────────────────────────────────┘  └────────────────────────────────┘ │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 7. API 接口

### 7.1 接口列表

| 接口名称 | 方法 | 路径 | 说明 |
|----------|------|------|------|
| 执行合规性检查 | POST | `/api/qc/check/compliance` | 对文件执行合规性检查 |
| 获取检查结果 | GET | `/api/qc/check/compliance/{taskId}/result` | 获取合规性检查结果 |
| 获取规则列表 | GET | `/api/qc/rules/compliance` | 获取合规性检查规则列表 |
| 更新规则配置 | PUT | `/api/qc/rules/compliance/{ruleId}` | 更新规则参数配置 |

### 7.2 接口详情

**执行合规性检查**

```
POST /api/qc/check/compliance

Request:
{
  "fileId": "file-001",
  "ruleCategories": ["code", "unit", "feature", "fee"],  // 可选，默认全部
  "severityFilter": ["error", "warning", "info"]          // 可选，默认全部
}

Response:
{
  "code": 200,
  "data": {
    "taskId": "task-cmp-001",
    "status": "completed",
    "statistics": {
      "totalRules": 31,
      "checkedRules": 31,
      "totalIssues": 12,
      "errorCount": 5,
      "warningCount": 4,
      "infoCount": 3
    },
    "categoryStats": [
      { "category": "code", "ruleCount": 9, "issueCount": 3, "passRate": 0.67 },
      { "category": "unit", "ruleCount": 5, "issueCount": 2, "passRate": 0.60 },
      { "category": "feature", "ruleCount": 8, "issueCount": 4, "passRate": 0.50 },
      { "category": "fee", "ruleCount": 9, "issueCount": 3, "passRate": 0.67 }
    ],
    "issues": [
      {
        "issueId": "issue-001",
        "ruleId": "CMP-CODE-001",
        "severity": "error",
        "title": "清单编码长度错误",
        "description": "清单项【矩形柱】的编码【01050100401】不符合12位规范",
        "suggestion": "请检查编码，补充至12位",
        "locationPath": "土建工程/混凝土工程/矩形柱",
        "lineNumber": 35,
        "actualValue": "01050100401",
        "expectedValue": "12位数字编码"
      }
      // ... more issues
    ]
  }
}
```

**获取规则列表**

```
GET /api/qc/rules/compliance?category=code&enabled=true

Response:
{
  "code": 200,
  "data": {
    "total": 9,
    "rules": [
      {
        "ruleId": "CMP-CODE-001",
        "ruleName": "编码长度检查",
        "ruleCategory": "code",
        "description": "清单编码必须为12位数字",
        "severity": "error",
        "isEnabled": true,
        "version": "1.0.0",
        "parameters": []
      }
      // ... more rules
    ]
  }
}
```

---

## 8. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-18 | 初稿，完成合规性检查规格 | - |

---

## 附录 A：清单编码速查表（房屋建筑与装饰工程）

| 章编码 | 章名称 | 常见清单项编码示例 |
|:------:|--------|-------------------|
| 01 | 土石方工程 | 010101 平整场地、010102 挖一般土方 |
| 02 | 桩基础工程 | 010201 预制钢筋混凝土方桩、010204 钻孔灌注桩 |
| 03 | 砌筑工程 | 010301 砖基础、010302 砖墙 |
| 04 | 混凝土及钢筋混凝土工程 | 010401 现浇混凝土基础、010501 矩形柱 |
| 05 | 厂库房大门、特种门、木结构 | 010601 厂库房大门 |
| 06 | 金属结构工程 | 010701 金属结构柱 |
| 07 | 屋面及防水工程 | 010801 瓦屋面、010802 屋面防水 |
| 08 | 保温、隔热、防腐工程 | 010901 保温隔热屋面 |
| 09 | 楼地面装饰工程 | 011001 整体面层 |
| 10 | 墙、柱面装饰与隔断、幕墙工程 | 011101 墙面抹灰 |
| 11 | 天棚工程 | 011201 天棚抹灰 |
| 12 | 油漆、涂料、裱糊工程 | 011301 木材面油漆 |
| 13 | 其他装饰工程 | 011401 装饰线条 |
| 14 | 措施项目 | 011501 脚手架、011502 模板 |

---

## 附录 B：相关文档索引

| 文档名称 | 路径 | 说明 |
|----------|------|------|
| 质控模块总览 | 00_QC_Overview_Spec.md | 上级文档 |
| 材料价格检查 | 02_Material_Price_Check_Spec.md | 下一检查类型 |
| 标准清单库 | 02_Standard_Library/SBoQ_Spec.md | 编码/单位/特征依赖 |
| 计价规则 | 各省计价规则文档 | 费用结构依赖 |