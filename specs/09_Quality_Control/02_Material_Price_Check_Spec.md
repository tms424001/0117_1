# 材料价格检查规格说明书

> 版本：V1.0  
> 更新日期：2026-01-18  
> 文档状态：初稿  
> 所属模块：09_Quality_Control  
> 上级文档：00_QC_Overview_Spec.md

---

## 1. 功能概述

### 1.1 功能定位

材料价格检查是质控模块的**核心检查能力**，通过多维度校验确保材料价格的准确性和合理性。材料费通常占工程造价的60%-70%，价格检查直接影响造价审核质量。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          材料价格检查定位                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   造价构成                           检查价值                           │
│   ────────                           ────────                           │
│   ┌─────────────────────────┐                                          │
│   │ 材料费      60%~70%     │ ◀── 本文档：确保材料价格准确            │
│   ├─────────────────────────┤                                          │
│   │ 人工费      15%~25%     │                                          │
│   ├─────────────────────────┤                                          │
│   │ 机械费       5%~10%     │                                          │
│   ├─────────────────────────┤                                          │
│   │ 管理费+利润  5%~10%     │                                          │
│   └─────────────────────────┘                                          │
│                                                                         │
│   三维检查模型                                                          │
│   ──────────────                                                        │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │
│   │   合理性    │  │   一致性    │  │   逻辑性    │                   │
│   │  Validity   │  │ Consistency │  │   Logic     │                   │
│   ├─────────────┤  ├─────────────┤  ├─────────────┤                   │
│   │ 价格是否在  │  │ 同一材料在  │  │ 材料间价格  │                   │
│   │ 合理区间内  │  │ 文件内价格  │  │ 关系是否   │                   │
│   │ （对比基准）│  │ 是否一致    │  │ 符合逻辑   │                   │
│   └─────────────┘  └─────────────┘  └─────────────┘                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 检查前提

**标准化是检查的基础**：材料价格检查依赖标准化引擎，只有将材料归一化到 SMLCode 后，才能进行有效的价格比对。

```
原始材料名称              标准化处理              可比对
────────────              ──────────              ──────
"商砼C30"      ─┐                        ┌─▶  材价库基准价
"C30混凝土"    ─┼─▶  SMLCode: 04-01-0030 ─┼─▶  信息价
"预拌C30砼"    ─┘                        └─▶  文件内其他C30
```

### 1.3 检查维度总览

| 检查维度 | 检查目的 | 数据依赖 | 难度 |
|----------|----------|----------|:----:|
| **合理性检查** | 价格是否在合理区间 | 材价库、信息价 | ★★★ |
| **一致性检查** | 文件内同材料价格是否一致 | 文件内数据 | ★☆☆ |
| **逻辑性检查** | 材料间价格关系是否合理 | 材料属性规则 | ★★☆ |

---

## 2. 合理性检查

### 2.1 检查原理

合理性检查通过将文件中的材料价格与**基准价格**进行对比，判断价格是否在合理浮动范围内。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          合理性检查原理                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   基准价格来源（优先级从高到低）                                        │
│   ──────────────────────────────                                        │
│                                                                         │
│   ┌─────────────────┐                                                   │
│   │ 1. 合同约定价格  │  ← 若有合同约定，以合同为准                      │
│   ├─────────────────┤                                                   │
│   │ 2. 信息价        │  ← 政府发布的指导价格（造价站/住建厅）           │
│   ├─────────────────┤                                                   │
│   │ 3. 企业材价库    │  ← 企业历史采购价格                              │
│   ├─────────────────┤                                                   │
│   │ 4. 市场询价      │  ← 实时市场价格（需标记为参考）                  │
│   └─────────────────┘                                                   │
│                                                                         │
│   浮动区间计算                                                          │
│   ────────────                                                          │
│                                                                         │
│   合理区间 = [基准价 × (1 - 下浮比例), 基准价 × (1 + 上浮比例)]        │
│                                                                         │
│   示例：信息价 4500元/t，浮动±10%                                       │
│   合理区间 = [4050, 4950] 元/t                                          │
│                                                                         │
│              4050          4500          4950                           │
│   ──────────|──────────────|──────────────|──────────                  │
│             ↑              ↑              ↑                             │
│           下限           基准价          上限                           │
│                                                                         │
│   偏离判定：                                                            │
│   • 实际价 < 下限 → 价格偏低告警                                       │
│   • 实际价 > 上限 → 价格偏高告警                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 基准价格匹配

#### 2.2.1 匹配流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        基准价格匹配流程                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────┐                                                    │
│  │  文件中的材料    │                                                    │
│  │  名称 + 规格     │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                             │
│           ▼                                                             │
│  ┌─────────────────┐                                                    │
│  │  标准化引擎      │  材料名称 → SMLCode                               │
│  │  归一化处理      │  属性提取 → ParamMap                              │
│  └────────┬────────┘                                                    │
│           │                                                             │
│           ▼                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    基准价格查询                                  │   │
│  │                                                                  │   │
│  │  查询条件：                                                      │   │
│  │  • SMLCode（材料编码）                                          │   │
│  │  • 规格型号（如有）                                              │   │
│  │  • 地区（省/市/区）                                              │   │
│  │  • 材价期（年月）                                                │   │
│  │                                                                  │   │
│  │  查询顺序：                                                      │   │
│  │  ① 精确匹配（SMLCode + 规格 + 地区 + 材价期）                   │   │
│  │  ② 规格模糊（SMLCode + 地区 + 材价期，规格相近）                │   │
│  │  ③ 时间放宽（SMLCode + 规格 + 地区，最近3期）                   │   │
│  │  ④ 地区放宽（SMLCode + 规格 + 材价期，上级地区）                │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│           │                                                             │
│           ▼                                                             │
│  ┌─────────────────┐     ┌─────────────────┐                           │
│  │  匹配成功        │     │  匹配失败        │                           │
│  │  返回基准价格    │     │  标记为"无基准"  │                           │
│  │  + 匹配置信度    │     │  跳过合理性检查  │                           │
│  └─────────────────┘     └─────────────────┘                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 2.2.2 匹配置信度

| 匹配级别 | 置信度 | 匹配条件 | 检查策略 |
|:--------:|:------:|----------|----------|
| 精确匹配 | 100% | SMLCode + 规格 + 地区 + 材价期 完全匹配 | 严格检查 |
| 高度匹配 | 80% | SMLCode + 地区 + 材价期 匹配，规格相近 | 严格检查 |
| 中度匹配 | 60% | SMLCode + 规格 匹配，材价期±3期 | 正常检查，标注时间差异 |
| 低度匹配 | 40% | SMLCode 匹配，地区为上级区域 | 宽松检查，标注地区差异 |
| 参考匹配 | 20% | 仅 SMLCode 匹配 | 仅供参考，不产生告警 |

### 2.3 浮动比例配置

#### 2.3.1 按材料类别配置

不同类别材料的价格波动特性不同，浮动比例应差异化配置：

| 材料类别 | 默认上浮 | 默认下浮 | 说明 |
|----------|:--------:|:--------:|------|
| **主材** | | | |
| 钢材（螺纹钢、线材等） | 15% | 15% | 价格波动大，受期货影响 |
| 水泥 | 10% | 10% | 相对稳定 |
| 混凝土（商砼） | 10% | 10% | 地区差异明显 |
| 砂石料 | 20% | 20% | 受运距影响大 |
| **辅材** | | | |
| 模板（木、钢） | 15% | 15% | 租赁价格差异大 |
| 周转材料 | 15% | 15% | - |
| **装饰材料** | | | |
| 瓷砖 | 30% | 30% | 品牌差异大 |
| 涂料 | 25% | 25% | 品牌差异大 |
| 石材 | 40% | 40% | 品种、产地差异极大 |
| **安装材料** | | | |
| 电线电缆 | 15% | 15% | 铜价波动影响 |
| 管材（镀锌管、PPR等） | 10% | 10% | 相对稳定 |
| 阀门 | 20% | 20% | 品牌差异 |
| **设备** | | | |
| 电气设备 | 25% | 25% | 配置差异大 |
| 暖通设备 | 25% | 25% | 配置差异大 |

#### 2.3.2 按计价阶段配置

| 计价阶段 | 建议浮动比例 | 说明 |
|----------|:------------:|------|
| 估算 | ±25%~30% | 精度要求低，允许较大浮动 |
| 概算 | ±20%~25% | - |
| 招标控制价 | ±10%~15% | 应较为准确 |
| 投标报价 | ±5%~10% | 需关注低价策略 |
| 结算 | ±5%~10% | 应与市场价接近 |

### 2.4 检查规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| PRC-VAL-001 | 价格偏高检查 | 实际价 > 基准价 × (1 + 上浮比例) | 🟡 一般 |
| PRC-VAL-002 | 价格偏低检查 | 实际价 < 基准价 × (1 - 下浮比例) | 🟡 一般 |
| PRC-VAL-003 | 价格严重偏高 | 实际价 > 基准价 × 2 | 🔴 严重 |
| PRC-VAL-004 | 价格严重偏低 | 实际价 < 基准价 × 0.5 | 🔴 严重 |
| PRC-VAL-005 | 价格为零检查 | 实际价 = 0 | 🔴 严重 |
| PRC-VAL-006 | 价格为负检查 | 实际价 < 0 | 🔴 严重 |
| PRC-VAL-007 | 无基准价格 | 未能匹配到基准价格 | 🔵 提示 |

---

## 3. 一致性检查

### 3.1 检查原理

一致性检查确保**同一造价文件内**，相同材料的价格保持一致。这是最基本的价格检查，不依赖外部数据。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          一致性检查原理                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   检查场景                                                              │
│   ────────                                                              │
│                                                                         │
│   某造价文件中出现多处相同材料：                                        │
│                                                                         │
│   清单项A - 矩形柱：C30混凝土 .......... 单价 420元/m³                 │
│   清单项B - 矩形梁：C30混凝土 .......... 单价 420元/m³  ✓ 一致        │
│   清单项C - 现浇板：C30混凝土 .......... 单价 380元/m³  ✗ 不一致      │
│                                                                         │
│   问题：同一文件内，C30混凝土出现两个价格（420、380），需要告警        │
│                                                                         │
│   检查步骤                                                              │
│   ────────                                                              │
│                                                                         │
│   ① 提取文件中所有材料                                                 │
│   ② 按 SMLCode + 规格 分组                                             │
│   ③ 检查每组内价格是否一致                                             │
│   ④ 不一致的生成Issue                                                  │
│                                                                         │
│   分组示例                                                              │
│   ────────                                                              │
│                                                                         │
│   SMLCode: 04-01-0030（C30混凝土）                                     │
│   ┌─────────────────────────────────────────────────────────────────┐  │
│   │ 出现位置        单价        判定                                 │  │
│   │ ─────────────────────────────────────────────────────────────── │  │
│   │ 矩形柱/第5行    420元/m³    基准价（首次出现）                   │  │
│   │ 矩形梁/第12行   420元/m³    ✓ 一致                              │  │
│   │ 现浇板/第28行   380元/m³    ✗ 偏离基准-9.5%                     │  │
│   └─────────────────────────────────────────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 一致性判定规则

#### 3.2.1 完全一致 vs 允许偏差

| 模式 | 判定逻辑 | 适用场景 |
|------|----------|----------|
| 严格模式 | 价格必须完全相等（精确到分） | 招标控制价、合同价 |
| 宽松模式 | 允许微小偏差（如±1%） | 估算、概算 |

#### 3.2.2 相同材料的判定

两个材料被视为"相同"需满足：

| 条件 | 必须/可选 | 说明 |
|------|:--------:|------|
| SMLCode 相同 | 必须 | 标准材料编码一致 |
| 规格型号相同 | 必须 | 如 Φ12、Φ16 视为不同材料 |
| 品牌相同 | 可选 | 若指定品牌则需一致 |
| 产地相同 | 可选 | 若指定产地则需一致 |

### 3.3 检查规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| PRC-CON-001 | 价格不一致检查 | 同材料在文件内价格不一致 | 🔴 严重 |
| PRC-CON-002 | 价格微小偏差 | 同材料价格偏差在1%以内 | 🔵 提示 |
| PRC-CON-003 | 主材价格不一致 | 主材（钢材、混凝土等）价格不一致 | 🔴 严重 |
| PRC-CON-004 | 辅材价格不一致 | 辅材价格不一致 | 🟡 一般 |

### 3.4 特殊情况处理

| 情况 | 处理方式 | 说明 |
|------|----------|------|
| 不同计价阶段 | 允许不一致 | 如概算材料价与详细预算材料价 |
| 不同单项工程 | 可配置 | 有时不同楼栋可能有价差 |
| 暂估材料 | 单独标记 | 暂估材料不参与一致性检查 |
| 甲供材料 | 单独标记 | 甲供材料价格可能特殊 |

---

## 4. 逻辑性检查

### 4.1 检查原理

逻辑性检查基于材料的**内在属性关系**，判断材料间的价格关系是否符合常理。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          逻辑性检查原理                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   基本逻辑：材料属性越高/越好，价格应越高                               │
│   ────────────────────────────────────────                              │
│                                                                         │
│   示例1：混凝土强度等级                                                 │
│   ┌─────────────────────────────────────────────────────────┐          │
│   │  C30 < C35 < C40 < C45 < C50                            │          │
│   │  价格应递增                                              │          │
│   │                                                          │          │
│   │  若 C40价格 < C30价格 → 价格逻辑倒挂，告警               │          │
│   └─────────────────────────────────────────────────────────┘          │
│                                                                         │
│   示例2：钢筋直径                                                       │
│   ┌─────────────────────────────────────────────────────────┐          │
│   │  Φ6 < Φ8 < Φ10 < Φ12 < ... < Φ25 < Φ28 < Φ32           │          │
│   │  单价（元/t）通常：小直径 > 大直径（加工费差异）         │          │
│   │                                                          │          │
│   │  若 Φ25价格 > Φ12价格 较多 → 可能存在问题               │          │
│   └─────────────────────────────────────────────────────────┘          │
│                                                                         │
│   示例3：管材壁厚                                                       │
│   ┌─────────────────────────────────────────────────────────┐          │
│   │  DN100 薄壁 < DN100 普通 < DN100 加厚                    │          │
│   │  同规格管材，壁厚越大价格越高                            │          │
│   └─────────────────────────────────────────────────────────┘          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 逻辑规则分类

#### 4.2.1 正向递增规则

属性值越大，价格应越高：

| 材料类别 | 属性 | 规则描述 |
|----------|------|----------|
| 混凝土 | 强度等级 | C30 < C35 < C40 < C45 < C50 < C55 < C60 |
| 砂浆 | 强度等级 | M5 < M7.5 < M10 < M15 < M20 |
| 钢材 | 强度等级 | Q235 < Q345 < Q390 < Q420 |
| 管材 | 公称直径 | DN50 < DN80 < DN100 < DN150... |
| 管材 | 壁厚 | 薄壁 < 普通 < 加厚 |
| 电缆 | 截面积 | 2.5mm² < 4mm² < 6mm² < 10mm²... |
| 保温材料 | 厚度 | 30mm < 50mm < 80mm < 100mm... |

#### 4.2.2 反向递减规则

属性值越大，单价可能越低（批量效应）：

| 材料类别 | 属性 | 规则描述 |
|----------|------|----------|
| 钢筋 | 直径 | 小直径单价略高于大直径（加工费因素） |

#### 4.2.3 同系列规则

同系列材料应保持合理价格梯度：

| 材料系列 | 规则描述 |
|----------|----------|
| 同品牌瓷砖 | 800×800 > 600×600 > 300×300（按面积） |
| 同品牌涂料 | 底漆 < 面漆 < 弹性涂料 |
| 同规格阀门 | 闸阀 < 截止阀 < 蝶阀 < 调节阀 |

### 4.3 检查规则

| 规则ID | 规则名称 | 检查逻辑 | 严重程度 |
|--------|----------|----------|:--------:|
| PRC-LOG-001 | 混凝土强度价格倒挂 | 高强度等级价格低于低强度等级 | 🔴 严重 |
| PRC-LOG-002 | 砂浆强度价格倒挂 | 高强度等级价格低于低强度等级 | 🔴 严重 |
| PRC-LOG-003 | 钢材强度价格倒挂 | 高强度等级价格低于低强度等级 | 🔴 严重 |
| PRC-LOG-004 | 管材规格价格倒挂 | 大规格价格低于小规格 | 🟡 一般 |
| PRC-LOG-005 | 电缆截面价格倒挂 | 大截面价格低于小截面 | 🟡 一般 |
| PRC-LOG-006 | 保温厚度价格倒挂 | 厚规格价格低于薄规格 | 🟡 一般 |
| PRC-LOG-007 | 钢筋直径价格异常 | 直径价差超出合理范围 | 🔵 提示 |
| PRC-LOG-008 | 同系列价格梯度异常 | 同系列材料价格梯度不合理 | 🔵 提示 |

### 4.4 逻辑规则配置

```typescript
interface PriceLogicRule {
  ruleId: string;
  ruleName: string;
  
  // 适用材料
  materialCategory: string;        // 材料大类
  smlCodePattern: string;          // SMLCode匹配模式（正则）
  
  // 比较属性
  compareAttribute: string;        // 用于比较的属性字段
  attributeOrder: 'asc' | 'desc';  // 属性排序方向
  
  // 价格关系
  priceRelation: 'asc' | 'desc' | 'proportional';  // 价格应递增/递减/成比例
  
  // 容差配置
  tolerance: {
    type: 'percentage' | 'absolute';
    value: number;
  };
  
  severity: 'error' | 'warning' | 'info';
}
```

**配置示例：混凝土强度价格规则**

```json
{
  "ruleId": "PRC-LOG-001",
  "ruleName": "混凝土强度价格倒挂",
  "materialCategory": "混凝土",
  "smlCodePattern": "^04-01-.*",
  "compareAttribute": "strengthGrade",
  "attributeOrder": "asc",
  "priceRelation": "asc",
  "tolerance": {
    "type": "percentage",
    "value": 5
  },
  "severity": "error"
}
```

---

## 5. 检查流程

### 5.1 整体流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        材料价格检查整体流程                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────┐                                                    │
│  │   输入造价文件   │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                             │
│           ▼                                                             │
│  ┌─────────────────┐                                                    │
│  │   提取材料清单   │  从分部分项/措施项目中提取所有材料                │
│  └────────┬────────┘                                                    │
│           │                                                             │
│           ▼                                                             │
│  ┌─────────────────┐                                                    │
│  │   材料标准化    │  名称 → SMLCode，提取规格/属性                    │
│  └────────┬────────┘                                                    │
│           │                                                             │
│           ├─────────────────────────────────────────┐                  │
│           │                                         │                  │
│           ▼                                         ▼                  │
│  ┌─────────────────┐                      ┌─────────────────┐          │
│  │ 合理性检查      │                      │ 一致性检查      │          │
│  │                 │                      │                 │          │
│  │ ① 匹配基准价格  │                      │ ① 按SMLCode分组 │          │
│  │ ② 计算偏离率    │                      │ ② 检查组内价格  │          │
│  │ ③ 判定是否超限  │                      │ ③ 标记不一致项  │          │
│  └────────┬────────┘                      └────────┬────────┘          │
│           │                                         │                  │
│           └─────────────────┬───────────────────────┘                  │
│                             │                                          │
│                             ▼                                          │
│                    ┌─────────────────┐                                 │
│                    │ 逻辑性检查      │                                 │
│                    │                 │                                 │
│                    │ ① 识别同类材料  │                                 │
│                    │ ② 提取比较属性  │                                 │
│                    │ ③ 检查价格关系  │                                 │
│                    └────────┬────────┘                                 │
│                             │                                          │
│                             ▼                                          │
│                    ┌─────────────────┐                                 │
│                    │  汇总检查结果   │                                 │
│                    │  生成Issue列表  │                                 │
│                    └─────────────────┘                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 检查优先级

| 优先级 | 检查类型 | 说明 |
|:------:|----------|------|
| 1 | 一致性检查 | 不依赖外部数据，最快完成 |
| 2 | 逻辑性检查 | 依赖材料属性，内部规则 |
| 3 | 合理性检查 | 依赖外部基准价，最慢 |

### 5.3 依赖数据

| 数据源 | 用途 | 必要性 |
|--------|------|:------:|
| 标准材料库（SML） | 材料归一化 | 必须 |
| 企业材价库 | 基准价格查询 | 推荐 |
| 信息价数据 | 基准价格查询 | 推荐 |
| 材料属性规则库 | 逻辑性检查 | 必须 |
| 浮动比例配置 | 合理性检查阈值 | 必须 |

---

## 6. 规则配置

### 6.1 规则数据结构

```typescript
interface MaterialPriceRule {
  // 基本信息
  ruleId: string;
  ruleName: string;
  ruleType: 'validity' | 'consistency' | 'logic';
  
  // 规则定义
  description: string;
  checkLogic: string;
  
  // 参数配置
  parameters: RuleParameter[];
  
  // 严重程度
  severity: 'error' | 'warning' | 'info';
  
  // 适用范围
  applicableMaterialCategories: string[];  // 适用材料类别，空为全部
  applicableFileTypes: FileType[];
  
  // 状态
  isEnabled: boolean;
  version: string;
}

interface RuleParameter {
  paramName: string;
  paramType: 'number' | 'percentage' | 'enum' | 'boolean';
  defaultValue: any;
  currentValue: any;
  description: string;
}
```

### 6.2 规则配置示例

**合理性检查规则**

```json
{
  "ruleId": "PRC-VAL-001",
  "ruleName": "价格偏高检查",
  "ruleType": "validity",
  "description": "材料价格高于基准价格允许的上浮比例",
  "checkLogic": "actualPrice > basePrice * (1 + upperLimit)",
  "parameters": [
    {
      "paramName": "upperLimit",
      "paramType": "percentage",
      "defaultValue": 15,
      "currentValue": 15,
      "description": "价格上浮比例限制（%）"
    },
    {
      "paramName": "basePriceSource",
      "paramType": "enum",
      "defaultValue": "infoPrice",
      "currentValue": "infoPrice",
      "description": "基准价格来源",
      "enumValues": ["contract", "infoPrice", "enterprise", "market"]
    }
  ],
  "severity": "warning",
  "applicableMaterialCategories": [],
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "isEnabled": true,
  "version": "1.0.0"
}
```

**一致性检查规则**

```json
{
  "ruleId": "PRC-CON-001",
  "ruleName": "价格不一致检查",
  "ruleType": "consistency",
  "description": "同一文件内相同材料的价格应保持一致",
  "checkLogic": "GROUP BY (smlCode, spec) HAVING COUNT(DISTINCT price) > 1",
  "parameters": [
    {
      "paramName": "strictMode",
      "paramType": "boolean",
      "defaultValue": true,
      "currentValue": true,
      "description": "是否启用严格模式（精确匹配价格）"
    },
    {
      "paramName": "tolerance",
      "paramType": "percentage",
      "defaultValue": 0,
      "currentValue": 0,
      "description": "允许的价格偏差（%），严格模式下为0"
    }
  ],
  "severity": "error",
  "applicableMaterialCategories": [],
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "isEnabled": true,
  "version": "1.0.0"
}
```

**逻辑性检查规则**

```json
{
  "ruleId": "PRC-LOG-001",
  "ruleName": "混凝土强度价格倒挂",
  "ruleType": "logic",
  "description": "高强度等级混凝土价格应高于低强度等级",
  "checkLogic": "IF strengthGrade(A) > strengthGrade(B) THEN price(A) >= price(B) * (1 - tolerance)",
  "parameters": [
    {
      "paramName": "tolerance",
      "paramType": "percentage",
      "defaultValue": 5,
      "currentValue": 5,
      "description": "允许的价格倒挂容差（%）"
    }
  ],
  "severity": "error",
  "applicableMaterialCategories": ["混凝土"],
  "applicableFileTypes": ["bidControl", "bid", "contract", "settlement"],
  "isEnabled": true,
  "version": "1.0.0"
}
```

### 6.3 规则汇总

| 类别 | 规则数量 | 严重级别分布 |
|------|:--------:|-------------|
| 合理性检查 | 7条 | 🔴×3 🟡×2 🔵×2 |
| 一致性检查 | 4条 | 🔴×2 🟡×1 🔵×1 |
| 逻辑性检查 | 8条 | 🔴×3 🟡×3 🔵×2 |
| **合计** | **19条** | 🔴×8 🟡×6 🔵×5 |

---

## 7. Issue 生成

### 7.1 Issue 模板

**合理性检查Issue**

```json
{
  "title": "材料价格{偏高/偏低}",
  "description": "材料【{材料名称}】单价{实际价格}元/{单位}，{高于/低于}基准价{基准价格}元/{单位}，偏离{偏离率}%",
  "suggestion": "请核实材料价格，参考{基准来源}（{材价期}）价格为{基准价格}元/{单位}",
  "locationType": "material",
  "locationPath": "{分部}/{清单项}/{材料名称}",
  "lineNumber": "{行号}",
  "actualValue": "{实际价格}",
  "expectedValue": "{基准价格}",
  "deviation": "{偏离率}%",
  "metadata": {
    "smlCode": "{SMLCode}",
    "basePrice": "{基准价格}",
    "basePriceSource": "{基准来源}",
    "basePricePeriod": "{材价期}",
    "matchConfidence": "{匹配置信度}"
  }
}
```

**示例**：
```json
{
  "title": "材料价格严重偏低",
  "description": "材料【螺纹钢Φ12】单价3200元/t，低于基准价4580元/t，偏离-30.1%",
  "suggestion": "请核实材料价格，参考省造价站信息价（2026年1月）价格为4580元/t",
  "locationType": "material",
  "locationPath": "土建工程/钢筋工程/螺纹钢Φ12",
  "lineNumber": 35,
  "actualValue": "3200",
  "expectedValue": "4580",
  "deviation": "-30.1%",
  "metadata": {
    "smlCode": "02-01-0012",
    "basePrice": 4580,
    "basePriceSource": "infoPrice",
    "basePricePeriod": "2026-01",
    "matchConfidence": "100%"
  }
}
```

**一致性检查Issue**

```json
{
  "title": "材料价格不一致",
  "description": "材料【{材料名称}】在文件中出现{出现次数}次，存在{价格数量}种不同价格：{价格列表}",
  "suggestion": "请统一材料价格，建议采用{建议价格}元/{单位}",
  "locationType": "material",
  "locationPath": "多处",
  "lineNumber": null,
  "actualValue": "{价格列表}",
  "expectedValue": "统一价格",
  "metadata": {
    "smlCode": "{SMLCode}",
    "occurrences": [
      { "location": "{位置1}", "lineNumber": "{行号1}", "price": "{价格1}" },
      { "location": "{位置2}", "lineNumber": "{行号2}", "price": "{价格2}" }
    ]
  }
}
```

**示例**：
```json
{
  "title": "材料价格不一致",
  "description": "材料【C30混凝土】在文件中出现3次，存在2种不同价格：420元/m³、380元/m³",
  "suggestion": "请统一材料价格，建议采用420元/m³（首次出现价格）",
  "locationType": "material",
  "locationPath": "多处",
  "lineNumber": null,
  "actualValue": "420, 380",
  "expectedValue": "统一价格",
  "metadata": {
    "smlCode": "04-01-0030",
    "occurrences": [
      { "location": "土建工程/混凝土工程/矩形柱", "lineNumber": 5, "price": 420 },
      { "location": "土建工程/混凝土工程/矩形梁", "lineNumber": 12, "price": 420 },
      { "location": "土建工程/混凝土工程/现浇板", "lineNumber": 28, "price": 380 }
    ]
  }
}
```

**逻辑性检查Issue**

```json
{
  "title": "{材料类别}价格逻辑倒挂",
  "description": "【{材料A}】单价{价格A}元/{单位}，【{材料B}】单价{价格B}元/{单位}，{属性描述}但价格关系异常",
  "suggestion": "请检查价格，通常{逻辑说明}",
  "locationType": "material",
  "locationPath": "多处",
  "lineNumber": null,
  "actualValue": "{材料A}:{价格A}, {材料B}:{价格B}",
  "expectedValue": "{材料A}价格应{高于/低于}{材料B}",
  "metadata": {
    "materialA": { "name": "{材料A}", "smlCode": "{SMLCodeA}", "price": "{价格A}", "attribute": "{属性A}" },
    "materialB": { "name": "{材料B}", "smlCode": "{SMLCodeB}", "price": "{价格B}", "attribute": "{属性B}" }
  }
}
```

**示例**：
```json
{
  "title": "混凝土价格逻辑倒挂",
  "description": "【C40混凝土】单价380元/m³，【C30混凝土】单价420元/m³，C40强度等级高于C30但价格更低",
  "suggestion": "请检查价格，通常高强度等级混凝土价格应高于低强度等级",
  "locationType": "material",
  "locationPath": "多处",
  "lineNumber": null,
  "actualValue": "C40:380, C30:420",
  "expectedValue": "C40价格应高于C30",
  "metadata": {
    "materialA": { "name": "C40混凝土", "smlCode": "04-01-0040", "price": 380, "attribute": "C40" },
    "materialB": { "name": "C30混凝土", "smlCode": "04-01-0030", "price": 420, "attribute": "C30" }
  }
}
```

### 7.2 Issue 严重程度判定

| 问题类型 | 严重程度 | 判定依据 |
|----------|:--------:|----------|
| 价格严重偏高（>100%） | 🔴 严重 | 可能导致重大经济损失 |
| 价格严重偏低（<50%） | 🔴 严重 | 可能存在恶意低价或错误 |
| 价格为零或为负 | 🔴 严重 | 明显错误 |
| 主材价格不一致 | 🔴 严重 | 影响造价准确性 |
| 混凝土/砂浆强度价格倒挂 | 🔴 严重 | 明显逻辑错误 |
| 价格偏高（15%-100%） | 🟡 一般 | 需要核实 |
| 价格偏低（50%-85%） | 🟡 一般 | 需要核实 |
| 辅材价格不一致 | 🟡 一般 | 影响较小 |
| 管材/电缆规格价格倒挂 | 🟡 一般 | 需要确认 |
| 无基准价格 | 🔵 提示 | 无法检查合理性 |
| 价格微小偏差 | 🔵 提示 | 可能是四舍五入差异 |
| 同系列价格梯度异常 | 🔵 提示 | 供参考 |

---

## 8. 界面设计

### 8.1 检查结果展示

```
┌─ 材料价格检查结果 ───────────────────────────────────────────────────────┐
│                                                                          │
│  检查概况                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                    │ │
│  │   材料总数     检查材料     问题材料     问题分布                   │ │
│  │   ┌─────┐     ┌─────┐     ┌─────┐     ┌─────────────────────┐    │ │
│  │   │ 256 │     │ 198 │     │  18 │     │ 🔴 严重    6 (33%)  │    │ │
│  │   │  种 │     │  种 │     │  种 │     │ 🟡 一般    8 (45%)  │    │ │
│  │   └─────┘     └─────┘     └─────┘     │ 🔵 提示    4 (22%)  │    │ │
│  │   (文件中)    (有基准)    (有问题)     └─────────────────────┘    │ │
│  │                                                                    │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  分类统计                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ 检查类型           检查数    问题数    通过率     操作               │ │
│  │ ─────────────────────────────────────────────────────────────────  │ │
│  │ 合理性检查          198         8       96%      [查看详情]          │ │
│  │ 一致性检查          256         6       98%      [查看详情]          │ │
│  │ 逻辑性检查           45         4       91%      [查看详情]          │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  问题清单                           [全部] [合理性] [一致性] [逻辑性]    │
│  ┌────────┬─────────────────────────────────┬─────────┬───────────────┐ │
│  │ 级别   │ 问题描述                         │ 偏离    │ 操作          │ │
│  ├────────┼─────────────────────────────────┼─────────┼───────────────┤ │
│  │ 🔴严重 │ 螺纹钢Φ12价格严重偏低            │ -30.1%  │ [定位] [处理] │ │
│  │        │ 3200元/t，基准价4580元/t         │         │               │ │
│  ├────────┼─────────────────────────────────┼─────────┼───────────────┤ │
│  │ 🔴严重 │ C40/C30混凝土价格逻辑倒挂        │ -       │ [定位] [处理] │ │
│  │        │ C40:380元 < C30:420元            │         │               │ │
│  ├────────┼─────────────────────────────────┼─────────┼───────────────┤ │
│  │ 🔴严重 │ C30混凝土价格不一致              │ -       │ [定位] [处理] │ │
│  │        │ 出现2种价格：420元、380元         │         │               │ │
│  ├────────┼─────────────────────────────────┼─────────┼───────────────┤ │
│  │ 🟡一般 │ 水泥P.O42.5价格偏高              │ +18.5%  │ [定位] [处理] │ │
│  │        │ 520元/t，基准价439元/t           │         │               │ │
│  ├────────┼─────────────────────────────────┼─────────┼───────────────┤ │
│  │ 🔵提示 │ 装饰涂料无基准价格               │ -       │ [定位] [标记] │ │
│  │        │ 未能匹配到参考价格               │         │               │ │
│  └────────┴─────────────────────────────────┴─────────┴───────────────┘ │
│                                                                          │
│                                    [导出报告]  [批量处理]  [重新检查]    │
└──────────────────────────────────────────────────────────────────────────┘
```

### 8.2 材料价格详情

```
┌─ 材料价格详情 ───────────────────────────────────────────────────────────┐
│                                                                          │
│  材料信息                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ 材料名称：螺纹钢                                                   │ │
│  │ 规格型号：Φ12，HRB400                                              │ │
│  │ 标准编码：SML-02-01-0012                                           │ │
│  │ 计量单位：t                                                         │ │
│  │ 文件价格：3,200.00 元/t                                            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  基准价格对比                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ 来源           价格(元/t)    材价期      地区      匹配度   偏离   │ │
│  │ ────────────────────────────────────────────────────────────────── │ │
│  │ 省信息价         4,580       2026-01    本市      100%    -30.1%  │ │
│  │ 企业材价库       4,450       2026-01    本市       95%    -28.1%  │ │
│  │ 上月信息价       4,620       2025-12    本市       80%    -30.7%  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  价格趋势                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │     5000 ┤                                                         │ │
│  │          │    ╭──╮                                                │ │
│  │     4500 ┤───╯    ╰───●───●───●                                   │ │
│  │          │              信息价趋势                                 │ │
│  │     4000 ┤                                                         │ │
│  │          │                                                         │ │
│  │     3500 ┤                                                         │ │
│  │          │                         ◆ 文件价格 3200                │ │
│  │     3000 ┼────┬────┬────┬────┬────┬────                          │ │
│  │          9月  10月 11月 12月  1月  当前                            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  文件内出现位置                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ 序号    位置                              工程量    单价    合价   │ │
│  │ ────────────────────────────────────────────────────────────────── │ │
│  │ 1      土建/钢筋工程/柱钢筋/第35行         12.5t   3200   40,000  │ │
│  │ 2      土建/钢筋工程/梁钢筋/第48行         28.3t   3200   90,560  │ │
│  │ 3      土建/钢筋工程/板钢筋/第62行         18.7t   3200   59,840  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│                                              [修改价格]  [标记忽略]      │
└──────────────────────────────────────────────────────────────────────────┘
```

### 8.3 价格对比矩阵（逻辑性检查）

```
┌─ 混凝土价格逻辑对比 ─────────────────────────────────────────────────────┐
│                                                                          │
│  混凝土强度等级价格矩阵                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                    │ │
│  │  强度等级    文件价格    信息价参考    价格关系    状态            │ │
│  │  ──────────────────────────────────────────────────────────────── │ │
│  │  C30         420元/m³     415元/m³       -         ✓              │ │
│  │              ↓ 应递增                                              │ │
│  │  C35         445元/m³     440元/m³      +25元      ✓              │ │
│  │              ↓ 应递增                                              │ │
│  │  C40         380元/m³     470元/m³      -65元      ✗ 倒挂！       │ │
│  │              ↓ 应递增                                              │ │
│  │  C45         490元/m³     505元/m³      +110元     ✓              │ │
│  │                                                                    │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  问题说明：C40混凝土价格(380元)低于C30(420元)，价格关系倒挂             │
│  建议操作：检查C40混凝土价格是否录入错误，参考信息价470元/m³            │
│                                                                          │
│                                              [批量修正]  [忽略此组]      │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 9. API 接口

### 9.1 接口列表

| 接口名称 | 方法 | 路径 | 说明 |
|----------|------|------|------|
| 执行材料价格检查 | POST | `/api/qc/check/material-price` | 执行全部或指定类型的价格检查 |
| 获取检查结果 | GET | `/api/qc/check/material-price/{taskId}/result` | 获取材料价格检查结果 |
| 获取材料详情 | GET | `/api/qc/check/material-price/{taskId}/materials/{materialId}` | 获取单个材料的详细检查信息 |
| 获取基准价格 | GET | `/api/qc/base-price` | 查询材料基准价格 |
| 获取规则列表 | GET | `/api/qc/rules/material-price` | 获取材料价格检查规则列表 |
| 更新浮动配置 | PUT | `/api/qc/rules/material-price/fluctuation` | 更新材料浮动比例配置 |

### 9.2 接口详情

**执行材料价格检查**

```
POST /api/qc/check/material-price

Request:
{
  "fileId": "file-001",
  "checkTypes": ["validity", "consistency", "logic"],  // 可选，默认全部
  "basePriceSource": "infoPrice",                       // 基准价格来源
  "pricePeriod": "2026-01",                             // 材价期
  "region": "330100"                                    // 地区编码
}

Response:
{
  "code": 200,
  "data": {
    "taskId": "task-prc-001",
    "status": "completed",
    "statistics": {
      "totalMaterials": 256,
      "checkedMaterials": 198,
      "issueCount": 18,
      "errorCount": 6,
      "warningCount": 8,
      "infoCount": 4
    },
    "checkTypeStats": [
      { "type": "validity", "checked": 198, "issues": 8, "passRate": 0.96 },
      { "type": "consistency", "checked": 256, "issues": 6, "passRate": 0.98 },
      { "type": "logic", "checked": 45, "issues": 4, "passRate": 0.91 }
    ],
    "issues": [
      {
        "issueId": "issue-001",
        "ruleId": "PRC-VAL-004",
        "severity": "error",
        "title": "材料价格严重偏低",
        "description": "材料【螺纹钢Φ12】单价3200元/t，低于基准价4580元/t，偏离-30.1%",
        "suggestion": "请核实材料价格，参考省造价站信息价（2026年1月）价格为4580元/t",
        "locationPath": "土建工程/钢筋工程/螺纹钢Φ12",
        "lineNumber": 35,
        "actualValue": "3200",
        "expectedValue": "4580",
        "deviation": "-30.1%"
      }
      // ... more issues
    ]
  }
}
```

**获取基准价格**

```
GET /api/qc/base-price?smlCode=02-01-0012&region=330100&period=2026-01

Response:
{
  "code": 200,
  "data": {
    "smlCode": "02-01-0012",
    "materialName": "螺纹钢",
    "spec": "Φ12, HRB400",
    "unit": "t",
    "basePrices": [
      {
        "source": "infoPrice",
        "price": 4580,
        "period": "2026-01",
        "region": "330100",
        "regionName": "杭州市",
        "confidence": 100,
        "publishOrg": "浙江省造价站"
      },
      {
        "source": "enterprise",
        "price": 4450,
        "period": "2026-01",
        "region": "330100",
        "regionName": "杭州市",
        "confidence": 95,
        "dataSource": "企业采购记录"
      }
    ],
    "priceHistory": [
      { "period": "2025-09", "price": 4320 },
      { "period": "2025-10", "price": 4480 },
      { "period": "2025-11", "price": 4550 },
      { "period": "2025-12", "price": 4620 },
      { "period": "2026-01", "price": 4580 }
    ]
  }
}
```

---

## 10. 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2026-01-18 | 初稿，完成材料价格检查规格 | - |

---

## 附录 A：材料分类与浮动比例配置表

| 一级分类 | 二级分类 | SMLCode前缀 | 默认上浮 | 默认下浮 |
|----------|----------|:-----------:|:--------:|:--------:|
| 钢材 | 螺纹钢 | 02-01 | 15% | 15% |
| 钢材 | 线材 | 02-02 | 15% | 15% |
| 钢材 | 型钢 | 02-03 | 15% | 15% |
| 水泥 | 普通硅酸盐水泥 | 03-01 | 10% | 10% |
| 水泥 | 矿渣硅酸盐水泥 | 03-02 | 10% | 10% |
| 混凝土 | 商品混凝土 | 04-01 | 10% | 10% |
| 混凝土 | 预拌砂浆 | 04-02 | 10% | 10% |
| 砂石 | 河砂 | 05-01 | 20% | 20% |
| 砂石 | 碎石 | 05-02 | 20% | 20% |
| 砌体材料 | 烧结砖 | 06-01 | 15% | 15% |
| 砌体材料 | 加气块 | 06-02 | 15% | 15% |
| 防水材料 | 防水卷材 | 07-01 | 20% | 20% |
| 防水材料 | 防水涂料 | 07-02 | 25% | 25% |
| 保温材料 | 挤塑板 | 08-01 | 20% | 20% |
| 保温材料 | 岩棉板 | 08-02 | 20% | 20% |
| 装饰材料 | 瓷砖 | 09-01 | 30% | 30% |
| 装饰材料 | 石材 | 09-02 | 40% | 40% |
| 装饰材料 | 涂料 | 09-03 | 25% | 25% |
| 门窗 | 铝合金门窗 | 10-01 | 20% | 20% |
| 门窗 | 塑钢门窗 | 10-02 | 20% | 20% |
| 给排水材料 | PPR管 | 11-01 | 10% | 10% |
| 给排水材料 | PVC管 | 11-02 | 10% | 10% |
| 电气材料 | 电线电缆 | 12-01 | 15% | 15% |
| 电气材料 | 配电箱 | 12-02 | 20% | 20% |

---

## 附录 B：材料属性逻辑规则表

| 材料类别 | 比较属性 | 属性值序列 | 价格关系 |
|----------|----------|-----------|----------|
| 混凝土 | 强度等级 | C15<C20<C25<C30<C35<C40<C45<C50<C55<C60 | 递增 |
| 砂浆 | 强度等级 | M2.5<M5<M7.5<M10<M15<M20 | 递增 |
| 钢材 | 强度等级 | Q235<Q345<Q390<Q420<Q460 | 递增 |
| 螺纹钢 | 直径 | Φ6<Φ8<Φ10<Φ12<Φ14<Φ16<Φ18<Φ20<Φ22<Φ25<Φ28<Φ32 | 略递减 |
| 镀锌管 | 公称直径 | DN15<DN20<DN25<DN32<DN40<DN50<DN65<DN80<DN100 | 递增 |
| PPR管 | 公称直径 | DN20<DN25<DN32<DN40<DN50<DN63<DN75<DN90<DN110 | 递增 |
| 电缆 | 截面积 | 1.5<2.5<4<6<10<16<25<35<50<70<95<120<150<185<240 | 递增 |
| 保温板 | 厚度 | 20<30<40<50<60<80<100 | 递增 |

---

## 附录 C：相关文档索引

| 文档名称 | 路径 | 说明 |
|----------|------|------|
| 质控模块总览 | 00_QC_Overview_Spec.md | 上级文档 |
| 合规性检查 | 01_Compliance_Check_Spec.md | 前一检查类型 |
| 综合单价检查 | 03_Composite_Price_Check_Spec.md | 下一检查类型 |
| 标准材料库 | 02_Standard_Library/SML_Spec.md | 材料标准化依赖 |
| 企业材价库 | 08_Data_Asset/Enterprise_Material_Price_Spec.md | 基准价格数据源 |
| 信息价数据 | 08_Data_Asset/Market_Info_Price_Spec.md | 基准价格数据源 |